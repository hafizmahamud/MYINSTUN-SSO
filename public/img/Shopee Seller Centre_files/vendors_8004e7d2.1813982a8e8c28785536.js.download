(window.miniJsonp=window.miniJsonp||[]).push([[7],{tvxL:function(e,t,r){var n,a,o,s,c,u,i,d,f,l,p,v,h,_;e.exports=(n=r("6SzI"),a=r("5rFJ"),o=r("XnKn"),s=r("XiPH"),c=r("wNa6"),u=r("LpSC"),i=r("p46w"),d=r("rRWa"),f=r("Q0a1"),l=r("XzT5"),p=r("WSEr"),v=r("cv67"),h=r("B6+r"),_=r("LhCv"),function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=28)}([function(e,t){e.exports=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(29);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(34);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o=r(35);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}));var s=r(75);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})}));var c=r(87);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})}));var u=r(101);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})}));var i=r(105);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})}));var d=r(110);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}})}));var f=r(116);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})}));var l=r(129);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})}));var p=r(133);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}})}));var v=r(137);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}})}));var h=r(138);Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}})}));var _=r(143);Object.keys(_).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}})}));var g=r(146);Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}})}));var S=r(149);Object.keys(S).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}})}));var m=r(152);Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}})}));var b=r(153);Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}})}));var y=r(156);Object.keys(y).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}})}));var E=r(158);Object.keys(E).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}})}));var O=r(164);Object.keys(O).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return O[e]}})}));var R=r(167);Object.keys(R).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return R[e]}})}));var k=r(168);Object.keys(k).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return k[e]}})}));var x=r(24);Object.keys(x).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return x[e]}})}));var w=r(181);Object.keys(w).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}})}));var I=r(184);Object.keys(I).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return I[e]}})}));var T=r(187);Object.keys(T).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return T[e]}})}))},function(e,t){e.exports=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(39);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(56);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o=r(20);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}));var s=r(59);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})}));var c=r(60);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})}));var u=r(61);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})}));var i=r(62);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})}));var d=r(63);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}})}));var f=r(65);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})}));var l=r(66);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})}));var p=r(67);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}})}));var v=r(68);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}})}));var h=r(70);Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}})}));var _=r(19);Object.keys(_).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}})}));var g=r(73);Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}})}))},function(e,t){e.exports=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rateCardsSchema=t.messageShortcutsSchema=t.feedStorySchema=t.shopSchema=t.stickerSchema=t.productSchema=t.orderSchema=t.offerSchema=t.conversationSchema=t.messageSchema=t.userSchema=t.selectHydrated=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(7),o=function(e,t,r){return new a.schema.Entity(e,n({},t),n({},r))},s=o("users"),c=o("messages"),u=o("conversations"),i=o("orders"),d=o("products"),f=o("offers",{product:d}),l=o("stickers"),p=o("shops"),v=o("feedStories"),h=o("messageShortcuts"),_=o("rateCards"),g={users:s,messages:c,conversations:u,orders:i,offers:f,products:d,stickers:l,shops:p,feedStories:v,messageShortcuts:h,rateCards:_};t.default=function(e,t){var r=g[e]||o(e);return t instanceof Array?(0,a.normalize)(t,[r]):(0,a.normalize)(t,r)},t.selectHydrated=function(e,t,r){try{var n=g[e];return t instanceof Array?(0,a.denormalize)(t,[n],r.entityReducer):null==t?void 0:(0,a.denormalize)(t,n,r.entityReducer)}catch(e){return}},t.userSchema=s,t.messageSchema=c,t.conversationSchema=u,t.offerSchema=f,t.orderSchema=i,t.productSchema=d,t.stickerSchema=l,t.shopSchema=p,t.feedStorySchema=v,t.messageShortcutsSchema=h,t.rateCardsSchema=_},function(e,t,r){"use strict";function n(e,t){return e===t}function a(e,t,r){if(null===t||null===r||t.length!==r.length)return!1;for(var n=t.length,a=0;a<n;a++)if(!e(t[a],r[a]))return!1;return!0}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,r=null,o=null;return function(){return a(t,r,arguments)||(o=e.apply(null,arguments)),r=arguments,o}}function s(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every((function(e){return"function"==typeof e}))){var r=t.map((function(e){return typeof e})).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+r+"]")}return t}function c(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return function(){for(var t=arguments.length,n=Array(t),a=0;a<t;a++)n[a]=arguments[a];var c=0,u=n.pop(),i=s(n),d=e.apply(void 0,[function(){return c++,u.apply(null,arguments)}].concat(r)),f=o((function(){for(var e=[],t=i.length,r=0;r<t;r++)e.push(i[r].apply(null,arguments));return d.apply(null,e)}));return f.resultFunc=u,f.recomputations=function(){return c},f.resetRecomputations=function(){return c=0},f}}t.__esModule=!0,t.defaultMemoize=o,t.createSelectorCreator=c,t.createStructuredSelector=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;if("object"!=typeof e)throw new Error("createStructuredSelector expects first argument to be an object where each property is a selector, instead received a "+typeof e);var r=Object.keys(e);return t(r.map((function(t){return e[t]})),(function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t,n){return e[r[n]]=t,e}),{})}))};var u=t.createSelector=c(o)},function(e,t){e.exports=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.t=void 0;var n,a=(n=r(47))&&n.__esModule?n:{default:n};t.t=a.default.t.bind(a.default)},function(e,t,r){var n=r(71),a=r(72);e.exports=function(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var c=0;c<16;++c)t[o+c]=s[c];return t||a(s)}},function(e,t){e.exports=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnverifiedPhoneNumber=t.InternalServerError=t.CancelOrderWarning=t.Webview=t.Blacklist=t.CustomError=t.Limiting=t.UnprocessableEntity=t.NotFound=t.Forbidden=t.Unauthoried=t.BadRequest=t.HTTPError=t.isError=void 0;var n=h(r(40)),a=h(r(41)),o=h(r(42)),s=h(r(43)),c=h(r(44)),u=h(r(45)),i=h(r(46)),d=h(r(48)),f=h(r(49)),l=h(r(50)),p=h(r(51)),v=h(r(52));function h(e){return e&&e.__esModule?e:{default:e}}t.isError=function(e){return(""+e).startsWith("4")||(""+e).startsWith("5")},t.HTTPError=function(e){switch(e){case 400:return n.default;case 401:return a.default;case 403:return u.default;case 404:return o.default;case 422:return s.default;case 429:return l.default;case 491:return i.default;case 492:return d.default;case 493:return f.default;case 494:return p.default;case 495:return v.default;case 500:return c.default;default:return Error}},t.BadRequest=n.default,t.Unauthoried=a.default,t.Forbidden=u.default,t.NotFound=o.default,t.UnprocessableEntity=s.default,t.Limiting=l.default,t.CustomError=i.default,t.Blacklist=d.default,t.Webview=f.default,t.CancelOrderWarning=p.default,t.InternalServerError=c.default,t.UnverifiedPhoneNumber=v.default},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.hasTargetMessageOption=t.previewMessage=t.previewWebview=t.getCustomMessageText=t.areSameMessages=t.areDeepEqualMessageList=t.getLastReadMessageIndexFromList=t.makeMessagePayload=t.optimizePopulate=t.getChatBotParams=t.handleIds=void 0;var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var s,c=e[Symbol.iterator]();!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.populateMessageWithSourceAndContent=g,t.populateRoughMessage=S,t.populateWebviewContent=m,t.populateCartReminder=b,t.populateMessage=X,t.populateCartReminderMessage=Z;var o=d(r(5)),s=r(2),c=r(1),u=r(4),i=d(r(9));function d(e){return e&&e.__esModule?e:{default:e}}function f(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var l=regeneratorRuntime.mark(g),p=regeneratorRuntime.mark(S),v=regeneratorRuntime.mark(m),h=regeneratorRuntime.mark(b),_=["product","order","offer","voucher","feed_story","unrated_order_reminder","bundle_message"];function g(e,t,r){var n,a,o,c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return regeneratorRuntime.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,(0,s.select)((function(e){return e.entityReducer}));case 2:return n=u.sent,a=n.messages,u.next=6,(0,s.call)(z,a,e,t,r);case 6:if(o=u.sent,!c){u.next=12;break}return u.next=10,(0,s.call)(S,e,o);case 10:u.next=14;break;case 12:return u.next=14,(0,s.spawn)(S,e,o);case 14:case"end":return u.stop()}}),l,this)}function S(e,t){var r,a,u,i,d,l,v,h,_,g,S;return regeneratorRuntime.wrap((function(p){for(;;)switch(p.prev=p.next){case 0:if(r=t.merge,a=t.source,u=t.content,i=t.sourceShops,d=t.webviews,l=t.cartReminders,p.t0=Object.keys(d).length,!p.t0){p.next=5;break}return p.next=5,(0,s.fork)(m,d);case 5:return v=[],Object.entries(r).forEach((function(e){var t,r=n(e,2),a=r[0],o=r[1];(t=v).push.apply(t,f(o.map((function(e){return(0,s.call)(c.getPopulateContent,a,e)}))))})),h=Array.from(new Set(i)).map((function(e){return(0,s.call)(c.getPopulateContent,"shops",e)})),v=v.concat(h),p.next=11,(0,s.all)(v);case 11:if(_=p.sent,g=X(e,_,a,u),e.filter((function(e,t){return g.includes(t)})).forEach((function(e){e.fetchStatus="done"})),p.t1=Object.keys(l).length,!p.t1){p.next=18;break}return p.next=18,(0,s.call)(b,e,l);case 18:return e[0]&&window.clickedConversationId===e[0].conversation_id&&(window.populateMessageConversationId=window.clickedConversationId),S=(0,o.default)("messages",e),p.next=22,(0,s.put)((0,c.updateEntities)({name:"messages",entities:S.entities}));case 22:case"end":return p.stop()}}),p,this)}function m(e){var t,r;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t=[],r=[],Object.entries(e).forEach((function(e){var t=n(e,2),a=t[0],o=t[1];Array.isArray(o)?r.push((0,s.call)(c.getPopulateContent,a,[].concat(f(new Set(o))))):Object.entries(o).forEach((function(e){var t=n(e,2),o=t[0],u=t[1];r.push((0,s.call)(c.getPopulateContent,a,{shopId:o,id:[].concat(f(new Set(u)))}))}))})),a.next=5,(0,s.all)(r);case 5:return a.sent.forEach((function(e){var r=(0,o.default)("voucher_web"===e.type?"vouchers":(0,u.camelCase)(e.type),e.content);t.push((0,s.put)((0,c.updateEntities)({entities:r.entities})))})),a.next=9,(0,s.all)(t);case 9:case"end":return a.stop()}}),v,this)}function b(e,t){var r,a,o,u,i,d;return regeneratorRuntime.wrap((function(f){for(;;)switch(f.prev=f.next){case 0:return r=[],Object.entries(t).forEach((function(e){var t=n(e,2),a=t[0],o=t[1];r.push((0,s.call)(c.getPopulateContent,"shopping_cart",{id:a,cartItems:o}))})),f.next=4,(0,s.all)(r);case 4:a=f.sent,o=Z(e,a),u=n(o,2),i=u[0],d=u[1],e.forEach((function(e,t){i.includes(t)&&(e.fetchStatus="done"),d.includes(t)&&(e.fetchStatus="failed")}));case 7:case"end":return f.stop()}}),h,this)}t.handleIds=function(e,t,r,n){if(0===e.length)return t;var a=t.filter((function(t){return!e.includes(t)}));return r||"latest"===n?a.concat(e):e.concat(a)},t.getChatBotParams=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.updateMaxGeneralOptionHideTime,n=void 0===r||r,o=t.updateMessageOption,s=void 0===o||o,c=e.created_timestamp,u=e.message_option,i=n?{max_general_option_hide_time:c}:{},d=s?{last_message_option:u}:{};return a({},i,d)};var y=u.MessageTypes.MSG_TYPE_TEXT,E=u.MessageTypes.MSG_TYPE_IMAGE,O=u.MessageTypes.MSG_TYPE_OFFER,R=u.MessageTypes.MSG_TYPE_PRODUCT,k=u.MessageTypes.MSG_TYPE_ORDER,x=u.MessageTypes.MSG_TYPE_STICKER,w=u.MessageTypes.MSG_TYPE_NOTIFICATION,I=u.MessageTypes.MSG_TYPE_WEBVIEW,T=u.MessageTypes.MSG_TYPE_RATE_CARDS,C=u.MessageTypes.MSG_TYPE_VOUCHER_WEB,P=u.MessageTypes.MSG_TYPE_VOUCHER,M=u.MessageTypes.MSG_TYPE_CATEGORY,j=u.MessageTypes.MSG_TYPE_PRODUCT_LIST,A=u.MessageTypes.MSG_TYPE_FAQ,N=u.MessageTypes.MSG_TYPE_FAQ_QUESTION,D=u.MessageTypes.MSG_TYPE_FAQ_LIVEAGENT,U=u.MessageTypes.MSG_TYPE_FAQ_FEEDBACK,L=u.MessageTypes.MSG_TYPE_CART_REMINDER,q=u.MessageTypes.MSG_TYPE_FAQ_UNSUPPORTED,F=u.MessageTypes.MSG_TYPE_FAQ_FEEDBACK_PROMPT,G=u.MessageTypes.MSG_TYPE_FAQ_LIVEAGENT_PROMPT,H=u.MessageTypes.MSG_TYPE_ORDER_REVIEW_REMINDER,V=u.MessageTypes.MSG_TYPE_FAQ_HISTORY,B=u.MessageTypes.MSG_TYPE_BUNDEL_DEAL,W=u.MessageTypes.MSG_TYPE_FLASH_SALE,Q=u.MessageTypes.MSG_TYPE_POND,Y=u.MessageTypes.MSG_TYPE_POND_SELECTED,K=function(e,t,r){return e.some((function(e){return e[t]===r}))},J=function(e,t,r,n){!e[t][r]&&(e[t][r]={}),!e[t][r][n]&&(e[t][r][n]=[]),!e.merge[r]&&(e.merge[r]=[])},z=t.optimizePopulate=function(e,t,r,n){var o={source:{},content:{},merge:{},sourceShops:[],webviews:{},cartReminders:{}};return t.forEach((function(t,r){var s=t.id,c=t.source_type,i=t.source_content,d=void 0===i?{}:i,f=t.type,l=t.content,p=void 0===l?{}:l,v=t.hasPopulated,h=!e[s]||!e[s].fetchStatus;if(c&&d){var g=d[c+"_id"];if(g&&![-1,0].includes(g)){var S=d.shop_id;J(o,"source",c,g),n&&o.sourceShops.push(S),o.source[c][g].push(r),h&&(t.fetchStatus="pendingSource"),K(o.merge[c],"id",g)||o.merge[c].push({id:g,shopId:S})}}if(_.includes(f)&&p){h&&(t.fetchStatus="pendingSource"===t.fetchStatus?"pendingCardAndSource":"pendingCard");var m=p.shop_id,b=function(e){var t=e.type,r=e.content,n=e.id;return t===H?r.order_id:t===V?n:r[t+"_id"]}(t),y=p.creator_id,E=p.messages;J(o,"content",f,b),o.content[f][b].push(r),K(o.merge[f],"id",b)||o.merge[f].push({id:b,shopId:m,creatorId:y,faqMessageIds:E})}else if("webview"===f){var O=p.url,R=void 0===O?"":O,k=R.split("/"),x=k[k.length-2],w="rate_cards"===(x="voucher"===x?x+"_web":x)?(0,u.getUrlParam)("id",R):parseInt((0,u.getUrlParam)("id",R)),I=(0,u.getUrlParam)("shop_id",R);t.content=a({},p,{id:w,type:x}),v||(I&&(J(o,"webviews",x,I),o.webviews[x][I].push(w)),I||(J(o,"webviews",x,"0"),o.webviews[x][0].push(w)),t.content.fetchStatus="pendingCard")}else if("shopping_cart"===f){var T=t.content.cart_items,C=t.id;t.fetchStatus="pendingCard",o.cartReminders[C]=T}})),o};function X(e,t,r,a){var o=[],s={sourceInfo:r,contentInfo:a},c=t.filter((function(e){return"shops"===e.type}));return Object.keys(s).forEach((function(r){Object.entries(s[r]).forEach((function(a){var s=n(a,2),u=s[0],i=s[1];Object.entries(i).forEach((function(a){var s=n(a,2),i=s[0],d=s[1];o=o.concat(d);var f=t.find((function(e){return e.type===u&&e.content&&parseInt(e.content.id)===parseInt(i)}));d.forEach((function(t){switch(r){case"sourceInfo":if(e[t].sourceContent=f,f){var n=c.findIndex((function(e){return[f.content.shop_id,f.content.id].includes(e.content.id)}));e[t].shopContent=-1!==n?c[n]:{}}else e[t].shopContent={};break;case"contentInfo":e[t].textContent=f&&f.content||{}}}))}))}))})),[].concat(f(new Set(o)))}function Z(e,t){var r={},n=[],a=[],o=[];return t.forEach((function(e){var t=e.content,a=t.id,o=t.result,s=t.fetchStatus;r[a]=o,"failed"===s&&n.push(a)})),e.forEach((function(e,t){"shopping_cart"===e.type&&r[e.id]&&(e.textContent=r[e.id],a.push(t)),n.includes(e.id)&&o.push(t)})),[[].concat(f(new Set(a))),[].concat(f(new Set(o)))]}var $={1:"product_entry_point",2:"order_entry_point",3:"shop_entry_point",8:"product_inactive_seller",10:"lowest_price_guaranteed",11:"poor_fulfilment"},ee=(t.makeMessagePayload=function(e){var t=e.recipientID,r=e.message,n=e.isSubAccount,o=e.redirectInfo,s=e.conversationId,c=e.entryPoint,u=r.content,d=r.type,f=r.shopId,l=r.isFaking,p={content:u,to_id:t,type:d,request_id:(0,i.default)(),created_timestamp:Math.floor(Date.now()/1e3),isFaking:l,chat_send_option:{force_send_cancel_order_warning:!1,comply_cancel_order_warning:!1}};if(n&&(p.shop_id=f),c&&c.type&&c.conversationId===s?p.entry_point=$[c.type]:p.entry_point="direct_chat_entry_point",o){var v=o.orderId,h=o.productId,_=o.conversationId,g=o.shopId;if(parseInt(s)===parseInt(_)){if(v){var S=parseInt(v);p=a({},p,{order_id:S,source_content:{order_id:S,shop_id:g},source_type:"order"})}if(h){var m=parseInt(h);p=a({},p,{product_id:m,source_content:{product_id:m,shop_id:g},source_type:"product"})}}}return p},t.getLastReadMessageIndexFromList=function(e,t){for(var r=e.length-1;r>=0;){var n=e[r];if(!t.includes(n.id))return r;r--}},t.areDeepEqualMessageList=function(e,t){return e.length===t.length&&e.every((function(e,r){var n=t[r];return JSON.stringify(e)===JSON.stringify(n)}))},t.areSameMessages=function(e,t){return!(t.id!==e.id||e.type!==t.type||e.send_status!==t.send_status||e.translateStatus!==t.translateStatus||e.content&&t.content&&e.content.translation!==t.content.translation||e.type===O&&(e.textContent&&e.textContent.status)!==(t.textContent&&t.textContent.status)||e.type===k&&(e.order&&e.order.title)!==(t.order&&t.order.title)||!(0,u.simpleEqualCheck)(e.textContent,t.textContent))},t.getCustomMessageText=function(t){return e(u.customMessageTextKey[t]||"common.unsupported_message")}),te=t.previewWebview=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";switch(!0){case t.includes(T):return e("conversation_list.conversation_cell.new_evaluation_message");case t.includes(C):case t.includes(P):return e("conversation_list.conversation_cell.voucher_message")}};t.previewMessage=function(t){if(!t)return e("common.unsupported_message");var r=t.type,n=t.content;if(r){var a=n||{},o=a.url,s=a.text,c=a.title,u=a.type,i=void 0===u?"":u,d=a.opening,f=[q,F,G],l=[y,D,N,U,Y,Q];if(r===A)return d;if(r===I)return"["+te(i||o)+"]";if(l.includes(r))return s||c;if(f.includes(r))return ee(r);var p=[M,j],v="conversation_list.conversation_cell.new_"+r+"_message";return[E,O,R,k,x,w,P,L,H,B,W,V].includes(r)?"["+e(v)+"]":p.includes(r)?"["+e("conversation_list.conversation_cell.new_product_message")+"]":e("common.unsupported_message")}return e("common.unsupported_message")},t.hasTargetMessageOption=function(e,t){return(e&t)===t}}).call(this,r(8).t)},function(e,t){e.exports=u},function(e,t){e.exports=i},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.getToastInformation=function(t,r){var n={};if(r){switch(r.type){case"auto-reply":t?r.first&&"enabled"===r.action?(n.message=e("settings.enable_auto_reply_successfully"),n.show=!0):(n.message="",n.show=!1):(r.first&&"enabled"===r.action?n.message=e("settings.failed_to_enable_auto_reply"):n.message="enabled"===r.action?e("settings.failed_to_enable"):e("settings.failed_to_disable"),n.show=!0);break;case"message":n.message=t?"save"===r.action?e("settings.message.save_successfully"):"delete"===r.action?e("settings.message.delete_successfully"):e("settings.message.import_successfully"):"save"===r.action?e("settings.message.failed_to_save"):"delete"===r.action?e("settings.message.failed_to_delete"):e("settings.message.failed_to_import"),n.show=!0;break;case"message-tips":t?(n.message="",n.show=!1):(n.message="enabled"===r.action?e("settings.failed_to_enable"):e("settings.failed_to_disable"),n.show=!0);break;case"forward":t||(n.message=403===r.status?e("forward.exception",{forwardName:""}):e("forward.server_error"),n.show=!0);break;case"send-feedback":n.message=e("feedback_modal.error.failed_to_send"),n.show=!0;break;case"server-error-tips":n.message=e("common.server_error.warning_tips"),n.show=!0;break;case"conversation-closed-tip":n.message=e("conversation_detail.closed.warning_tips"),n.show=!0;break;case"permission-denied":n.message=e("common.permission_denied"),n.show=!0;break;case"claim-voucher":n.message=e(t?"voucher.claim.success":"voucher.claim.fail"),n.show=!0;break;case"private-image":n.message=e("common.image.expired"),n.show=!0;break;case"operation":"save"===r.action&&(n.message=e(t?"text.save_successfully":"text.save_failed")),n.show=!0;break;default:n.message=r.message,n.show=!0}n.type=t?"success":"fail"}return n}}).call(this,r(8).t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setToastInformationSucceeded=t.setToastInformation=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.watchSet=_;var a,o,s,c=r(0),u=r(2),i=r(1),d=regeneratorRuntime.mark(h),f=regeneratorRuntime.mark(_),l=(0,c.createActions)({SET_TOAST_INFORMATION:function(e){return{toast:e.toast}},SET_TOAST_INFORMATION_SUCCEEDED:function(e){return{toast:e.toast}}}),p=l.setToastInformation,v=l.setToastInformationSucceeded;function h(e){var t=e.payload.toast;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.select)(i.showConversationDetailSelector);case 2:if(!e.sent){e.next=6;break}return e.next=6,(0,u.put)(v({toast:t}));case 6:case"end":return e.stop()}}),d,this)}function _(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.takeEvery)(p,h);case 2:case"end":return e.stop()}}),f,this)}t.setToastInformation=p,t.setToastInformationSucceeded=v,t.default=(s=function(e,t){var r=t.payload.toast;return n({},e,{toast:r})},(o=v)in(a={})?Object.defineProperty(a,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[o]=s,a)},function(e,t,r){"use strict";(function(e){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.uploadImage=t.abortAllSendingMessages=t.sendMessagesFailed=t.sendMessagesToPending=t.sendingMessages=t.sendMessagesSucceeded=t.sendMessagesRequested=void 0;var a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var s,c=e[Symbol.iterator]();!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.sendMessages=J,t.handleSendSucceededMessages=z,t.watchSend=Z;var s=r(10),c=r(0),u=r(2),i=r(1),d=r(12),f=r(3),l=_(r(5)),p=r(11),v=r(4),h=_(r(9));function _(e){return e&&e.__esModule?e:{default:e}}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function S(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var m=regeneratorRuntime.mark(H),b=regeneratorRuntime.mark(V),y=regeneratorRuntime.mark(K),E=regeneratorRuntime.mark(J),O=regeneratorRuntime.mark(z),R=regeneratorRuntime.mark(X),k=regeneratorRuntime.mark(Z),x=29,w=43,I=44,T=v.MessageTypes.MSG_TYPE_IMAGE,C=v.MessageTypes.MSG_TYPE_TEXT,P=v.MessageTypes.MSG_TYPE_VOUCHER,M=v.MessageTypes.MSG_TYPE_VOUCHER_WEB,j=v.MessageTypes.MSG_TYPE_WEBVIEW,A=(0,c.createActions)({SEND_MESSAGES_REQUESTED:function(e){return{conversationId:e.conversationId,conversationUserId:e.conversationUserId,messages:e.messages,isFakingSource:e.isFakingSource}},SEND_MESSAGES_SUCCEEDED:function(e){return{conversationId:e.conversationId,requestIdToMessageId:e.requestIdToMessageId}},SENDING_MESSAGES:function(e){return{conversationId:e.conversationId,requestIds:e.requestIds}},SEND_MESSAGES_TO_PENDING:function(e){return{conversationId:e.conversationId,requestIds:e.requestIds}},SEND_MESSAGES_FAILED:function(e){return{conversationId:e.conversationId,requestIds:e.requestIds}},ABORT_ALL_SENDING_MESSAGES:function(){return{}}}),N=A.sendMessagesRequested,D=A.sendMessagesSucceeded,U=A.sendingMessages,L=A.sendMessagesToPending,q=A.sendMessagesFailed,F=A.abortAllSendingMessages;t.sendMessagesRequested=N,t.sendMessagesSucceeded=D,t.sendingMessages=U,t.sendMessagesToPending=L,t.sendMessagesFailed=q,t.abortAllSendingMessages=F;var G=t.uploadImage=function(e){var t=e.file,r=e.conversationId,n="string"==typeof t?(0,v.convertBase64ToBlob)(t):t,a=new window.FormData;return a.append("file",n),a.append("conversation_id",r),(0,f.fetch)({method:"POST",resource:"images",payload:a})};function H(e){var t,r,n,a,o,s,c,d,f,l,p;return regeneratorRuntime.wrap((function(v){for(;;)switch(v.prev=v.next){case 0:v.prev=0,t=!0,r=!1,n=void 0,v.prev=4,a=e[Symbol.iterator]();case 6:if(t=(o=a.next()).done){v.next=19;break}if(s=o.value,c=s.type,d=s.content,c!==T){v.next=16;break}return v.next=12,G(d);case 12:f=v.sent,l=f.url,p=f.file_server_id,s.content={url:l,file_server_id:p};case 16:t=!0,v.next=6;break;case 19:v.next=25;break;case 21:v.prev=21,v.t0=v.catch(4),r=!0,n=v.t0;case 25:v.prev=25,v.prev=26,!t&&a.return&&a.return();case 28:if(v.prev=28,!r){v.next=31;break}throw n;case 31:return v.finish(28);case 32:return v.finish(25);case 33:v.next=40;break;case 35:return v.prev=35,v.t1=v.catch(0),v.next=39,(0,u.put)((0,i.showOperationFailureToastRequested)({error:v.t1}));case 39:return v.abrupt("return",!1);case 40:case"end":return v.stop()}}),m,this,[[0,35],[4,21,25,33],[26,,28,32]])}function V(e){var t,r,n,a,s,c,f,p,h,_,g,S,m,y,E,O=e.payload,R=O.conversationId,k=O.conversationUserId,x=O.messages,w=O.isFakingSource;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.call)(H,x);case 2:if(void 0!==e.sent){e.next=48;break}return e.next=6,(0,u.select)(i.isSubAccountSelector);case 6:return t=e.sent,e.next=9,(0,u.select)(i.messagesWithSourceSelector);case 9:return r=e.sent,e.next=12,(0,u.select)(i.entryPointSelector);case 12:return n=e.sent,e.next=15,(0,u.call)(v.getItem,"mini-sc_redirect");case 15:return a=e.sent,s=x.map((function(e){return(0,d.makeMessagePayload)({recipientID:k,message:e,isSubAccount:t,redirectInfo:a,conversationId:R,entryPoint:n})})),e.next=19,(0,u.select)(i.currentUserIdSelector);case 19:return c=e.sent,e.t0=i.currentUserShopIdSelector,e.next=23,(0,u.select)((function(e){return e}));case 23:if(e.t1=e.sent,f=(0,e.t0)(e.t1),p=s.map((function(e){var t=o({},e);t.id=e.request_id,t.from_id=c;var r=t.type,n=t.content;if(["product","order","voucher"].includes(r)){var a=r+"_id",s=n[a];t.fetchStatus="done";var u=x.find((function(e){return e.content[a]===s}));u&&(t.textContent=u.textContent)}else r===C&&(t.translateStatus=v.TranslationStatus.PENDING);return t})),h=r.filter((function(e){return e.hasMessageSource&&!e.isFaking})),_=r.filter((function(e){return e.hasMessageSource&&e.isFaking})),g=_[_.length-1],!_.length){e.next=35;break}return S=[],w||(p[0].sourceContent=g.sourceContent),_.forEach((function(e){S.push((0,u.put)((0,i.deleteRecord)({name:"messages",id:e.id})))})),e.next=35,(0,u.all)(S);case 35:if(!w){e.next=43;break}if(m=p[0]||{},y=m.source_content||{},!h.filter((function(e){var t=e.source_content||{};return y.shop_id===t.shop_id&&y.product_id===t.product_id&&y.order_id===t.order_id})).length){e.next=41;break}return e.abrupt("return");case 41:return e.next=43,(0,u.call)(d.populateMessageWithSourceAndContent,p,f,t,!0);case 43:return E=(0,l.default)("messages",p),e.next=46,(0,u.put)((0,i.updateEntities)({entities:E.entities}));case 46:return e.next=48,J({conversationId:R,requestIds:E.result,messages:s,isRedirect:!!a,isFakingSource:w});case 48:case"end":return e.stop()}}),b,this)}function B(e){return e.content&&e.content.translation&&e.content.translation.text}function W(e,t){return delete e.errorCode,delete e.error,o({},e,{chat_send_option:{force_send_cancel_order_warning:t,comply_cancel_order_warning:!t}})}var Q=["request_id","to_id","type","content","shop_id","order_id","source","chat_send_option","source_content","source_type","entry_point"],Y=function(t,r,n){var a={};return Q.forEach((function(e){t[e]&&(a[e]=t[e])})),t.retryRequestId&&(a.request_id=t.retryRequestId),new Promise((function(s){(0,f.fetch)({method:"POST",resource:"messages",payload:JSON.stringify(o({},a,{source:n?"minichat":"pc_mall"}))}).then((function(e){s(e),r&&(0,v.removeItem)("mini-sc_redirect")})).catch((function(r){var n=void 0;switch(!0){case r instanceof p.Forbidden:n=28;break;case r instanceof p.Limiting:n=x;break;case r instanceof p.CustomError:n=42;break;case r instanceof p.Blacklist:n=w,t.content={text:e("common.blacklist.replaced_text")};break;case r instanceof p.CancelOrderWarning:n=I;break;case r instanceof p.UnverifiedPhoneNumber:n=45;break;default:n=-1}s(o({},t,{requestId:t.request_id,errorCode:n,error:r}))}))}))};function K(e,t){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,u.delay)(1e3);case 2:return r.next=4,(0,u.put)(L({conversationId:e,requestIds:t}));case 4:case"end":return r.stop()}}),y,this)}function J(e){var t,r,n,a,c,d,l,p,_,g,m,b,y,O,R,k,T,P,M,A,N,D,L,F,G,H=e.conversationId,V=e.requestIds,B=e.messages,Q=e.isRedirect,J=e.isFakingSource;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.select)(i.networkStatusSelector);case 2:return t=e.sent,e.next=5,(0,u.select)(i.isScChatSelector);case 5:return r=e.sent,n=B.length,e.next=9,(0,u.put)(U({conversationId:H,requestIds:V}));case 9:if(!J){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,(0,u.spawn)(K,H,V);case 13:if(a=B[n-1],c=a.type,d=a.content,c===j&&d&&d.type===MSG_TYPE_RATE_CARDS){e.next=18;break}return e.next=18,(0,u.put)((0,i.updateRecord)({name:"conversations",id:H,record:{latestMessageStatus:"sending",latestMessage:a}}));case 18:if(l=0,p=[],_=[],g=[],m={},"offline"!==t){e.next=30;break}b=B.map((function(e){return o({},e,{requestId:e.request_id})})),g.push.apply(g,S(b)),_.push.apply(_,S(b)),m=a,e.next=42;break;case 30:if(!(l<n)){e.next=42;break}return y=B[l],O=void 0,e.next=35,(0,u.call)(Y,y,Q,r);case 35:(O=e.sent).errorCode?(y.type,y.content,_.push(O)):p.push(O),O.error&&O.error.offlineError&&g.push(O),++l===n&&(m=O),e.next=30;break;case 42:if(!p.length){e.next=46;break}return p.forEach((function(e){e.send_status=v.MSG_STATUS.SUCCEED})),e.next=46,(0,u.call)(z,p,H);case 46:if(!_.length){e.next=79;break}return e.next=49,(0,u.select)((0,i.getConversation)(H));case 49:if(!(R=e.sent)||!R.faking){e.next=56;break}if(k=_.find((function(e){return[-1,42].includes(e.errorCode)})),e.t0=k,!e.t0){e.next=56;break}return e.next=56,(0,u.put)((0,i.showOperationFailureToastRequested)({error:k.error}));case 56:return T=[],_.forEach((function(e){var t=e.errorCode,r=e.error,n=e.request_id,a=e.type,o=e.content;t===x&&T.push((0,u.put)((0,i.showOperationFailureToastRequested)({error:r})));var s={errorCode:t,translateStatus:v.TranslationStatus.FAILED,retryRequestId:(0,h.default)()};a===C&&t===w&&(s.content=o),T.push((0,u.put)((0,i.updateRecord)({name:"messages",id:n,record:s})))})),e.next=60,(0,u.all)(T);case 60:return P=_.map((function(e){return e.requestId})),e.next=63,(0,u.put)((0,i.updateRecord)({name:"conversations",id:H,record:{latestMessage:m,latestMessageStatus:"failed"}}));case 63:return e.next=65,(0,u.put)(q({conversationId:H,requestIds:P}));case 65:if(!(M=_.find((function(e){return e.errorCode===I})))){e.next=79;break}return e.next=69,(0,u.select)((0,i.getMessageSelector)(M.request_id));case 69:return A=e.sent,e.next=72,(0,u.select)(i.currentConversationSelector);case 72:return N=e.sent,D=(N||{}).shop,L=(D=void 0===D?{}:D).country,F=L&&L.toLowerCase(),e.next=79,(0,u.put)((0,i.showModal)({type:"Cancel_ORDER_WARNING_MODAL",title:{key:"cancel_order.modal.title"},additions:{content:{key:"cancel_order.modal.content"},region:F||"sg"},actions:{cancel:{label:{key:"cancel_order.modal.send_it"},handler:function(){s.store.dispatch((0,i.closeModal)());var e=W(A,!0);s.store.dispatch((0,i.resendMessageRequested)({conversationId:H,message:e}))}},confirm:{label:{key:"cancel_order.modal.not_send"},handler:function(){s.store.dispatch((0,i.closeModal)());var e=W(A,!1);s.store.dispatch((0,i.resendMessageRequested)({conversationId:H,message:e}))}}}}));case 79:if(!g.length){e.next=84;break}return G=g.map((function(e){return e.requestId})),e.next=83,(0,u.put)((0,i.sendMessagesFailedByOffline)({conversationId:H,requestIds:G}));case 83:(0,f.networkJudge)();case 84:case"end":return e.stop()}}),E,this)}function z(e,t){var r,n,a,s,c,p,h,_,S,m,b,y,E,R,k;return regeneratorRuntime.wrap((function(O){for(;;)switch(O.prev=O.next){case 0:return r=[],n=[],O.next=4,(0,u.select)(i.currentConversationIdSelector);case 4:if((a=O.sent)===t){O.next=12;break}return O.next=8,(0,u.select)((0,i.conversationMessageIdsSelector)(t));case 8:return r=O.sent,O.next=11,(0,u.select)((0,i.getMessagesSelector)(r.all));case 11:n=O.sent;case 12:return O.next=14,(0,u.select)(i.messagesWithSourceSelector);case 14:if(s=O.sent,c=(0,l.default)("messages",s).entities.messages||{},p=[],(h=e.map((function(e){var r,d=e.request_id,f=e.id,l=e.content;if(e.type===j&&l&&l.type===P&&(l.type=M),c[d]){p.push((0,u.put)((0,i.deleteRecord)({name:"messages",id:d})));var h=o({},c[d],{translateStatus:B(e)?v.TranslationStatus.SHOW:v.TranslationStatus.FAILED});return c[f]?null:(0,v.deepMerge)(h,e)}if((r=a!==t?n.filter((function(e){return e&&e.retryRequestId===d})):s.filter((function(e){return e.retryRequestId===d}))).length){var _=r[0].request_id;p.push((0,u.put)((0,i.deleteRecord)({name:"messages",id:_})));var g=o({},c[_],{translateStatus:B(e)?v.TranslationStatus.SHOW:v.TranslationStatus.FAILED}),S=c[f]?null:(0,v.deepMerge)(g,e);return S&&S.retryRequestId&&(S.original_request_id=_),S}})).filter((function(e){return e}))).length){O.next=20;break}return O.abrupt("return");case 20:return O.next=22,(0,u.call)(f.updateOrReplaceAction,c,h,"messages");case 22:return O.next=24,(0,u.put)(D({conversationId:t,requestIdToMessageId:h.reduce((function(e,t){return t.original_request_id?o({},e,g({},t.original_request_id,t.id)):o({},e,g({},t.request_id,t.id))}),{})}));case 24:return h.sort((function(e,t){return t.id-e.id})),O.next=27,(0,u.all)(p);case 27:return _=h[0],S=_.id,m=_.content,b=_.created_at,y=_.created_timestamp,E=_.type,R=_.message_option,k=(0,d.hasTargetMessageOption)(R,66496),O.next=31,(0,u.put)((0,i.updateRecord)({name:"conversations",id:t,record:{latest_message_id:S,latest_message_type:E,latest_message_content:m,last_message_time:b,last_message_option:R,max_general_option_hide_time:y,crm_message_preview:{},unread_count:0,flag:"normal",latestMessage:k?{content:m,type:E}:{},latestMessageStatus:k?"failed":""}}));case 31:case"end":return O.stop()}}),O,this)}function X(){var e,t,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,u.select)((function(e){return e}));case 2:return e=n.sent,n.next=5,(0,u.select)(i.messageIdsHashSelector);case 5:return t=n.sent,r=[],Object.entries(t).forEach((function(t){var n=a(t,2),o=n[0],s=n[1].sending||[];if(s.length){r.push((0,u.put)(q({conversationId:o,requestIds:s})));var c=((0,i.getConversation)(o)(e)||{}).latestMessage,d=void 0===c?{}:c;d.id&&s.includes(d.id)&&r.push((0,u.put)((0,i.updateRecord)({name:"conversations",id:o,record:{latestMessageStatus:"failed"}})))}})),n.next=10,(0,u.all)(r);case 10:case"end":return n.stop()}}),R,this)}function Z(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.takeEvery)(N,V);case 2:return e.next=4,(0,u.takeLatest)(F,X);case 4:case"end":return e.stop()}}),k,this)}t.default=(g(n={},U,(function(e,t){var r=t.payload,n=r.conversationId,a=r.requestIds,s=e.messageIdsHash,c=s[n]||{},u=c.all||[],i=c.failed||[];return o({},e,{messageIdsHash:o({},s,g({},n,o({},c,{all:a.reverse().filter((function(e){return!u.includes(e)})).concat(u),failed:i.filter((function(e){return!a.includes(e)}))})))})})),g(n,L,(function(e,t){var r=t.payload,n=r.conversationId,a=r.requestIds,s=e.messageIdsHash,c=s[n]||{},u=c.sending||[],i=c.all||[],d=c.failed||[],f=a.filter((function(e){return i.includes(e)&&!d.includes(e)}));return o({},e,{messageIdsHash:o({},s,g({},n,o({},c,{sending:u.concat(f)})))})})),g(n,D,(function(e,t){var r=t.payload,n=r.conversationId,a=r.requestIdToMessageId,s=e.messageIdsHash,c=s[n]||{},u=(c.all||[]).map((function(e){return a[e]?a[e]:e})),i=c.sending||[];return o({},e,{messageIdsHash:o({},s,g({},n,o({},c,{all:u,offset:u[u.length-1],sending:i.filter((function(e){return!a.hasOwnProperty(e)}))})))})})),g(n,q,(function(e,t){var r=t.payload,n=r.conversationId,a=r.requestIds,s=e.messageIdsHash,c=s[n]||{},u=c.failed||[],i=c.sending||[];return o({},e,{messageIdsHash:o({},s,g({},n,o({},c,{sending:i.filter((function(e){return!a.includes(e)})),failed:u.concat(a)})))})})),n)}).call(this,r(8).t)},function(e,t){e.exports=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clearApiCache=void 0;var n,a,o,s=(n=r(13))&&n.__esModule?n:{default:n};function c(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}t.clearApiCache=function(){window.caches&&window.caches.delete("CHAT_API")},t.default=(a=regeneratorRuntime.mark((function e(t,r){var n,a,o,u,i,d,f,l,p,v,h,_,g,S,m,b,y,E,O;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=new URL(t),a=n.searchParams,o=a.get("need_cache"),u=a.get("force_update"),i=r.method&&"get"===r.method.toLowerCase(),d="&csrf_token="+encodeURIComponent(a.get("csrf_token")),f="&force_update="+String(u),l=t.replace(d,"").replace(f,""),!(i&&o&&window.caches)){e.next=43;break}return e.next=12,window.caches.open("CHAT_API");case 12:return p=e.sent,e.next=15,p.match(l);case 15:if(v=e.sent,h=Date.now(),!v){e.next=24;break}if(!(h<v.headers.get("cache-expires"))||u){e.next=22;break}return e.abrupt("return",v);case 22:return e.next=24,p.delete(l);case 24:return e.next=26,(0,s.default)(t,r);case 26:if(_=e.sent,g=_.clone(),200!==_.status){e.next=40;break}return S=[].concat(c(_.headers.entries())),m={},b=a.get("cache_expires")||3600,y=h+1e3*b,e.next=35,_.blob();case 35:E=e.sent,S.forEach((function(e){m[e[0]]=e[1]})),m["cache-expires"]=y,O=new Response(E,{headers:new Headers(m)});try{p.put(l,O)}catch(e){window.caches.delete("CHAT_API")}case 40:return e.abrupt("return",g);case 43:return e.abrupt("return",(0,s.default)(t,r));case 44:e.next=49;break;case 46:return e.prev=46,e.t0=e.catch(0),e.abrupt("return",(0,s.default)(t,r));case 49:case"end":return e.stop()}}),e,this,[[0,46]])})),o=function(){var e=a.apply(this,arguments);return new Promise((function(t,r){return function n(a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(c).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(c)}("next")}))},function(e,t){return o.apply(this,arguments)})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sentry=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.initSentry=function(){var e=(0,s.getRuntimeServer)(),r=(0,s.getRuntimeVersion)(),c={environment:e,sampleRate:.4};if(r&&(c.release=r),o.BrowserClient){var u=new o.BrowserClient(n({dsn:"https://"+a.dnsKey+"@wsa-sentry.shopeemobile.com/"+a.dnsNumber},c));t.Sentry=new o.Hub(u)}};var a,o=r(53),s=r(4);a={dnsKey:"2bb27851127c4ccf9913bf76b60fcc98",dnsNumber:"33",apiToken:""},t.Sentry=null},function(e,t){e.exports=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deleteConversationSucceeded=t.deleteConversationRequested=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.watchDelete=h;var a=r(0),o=r(2),s=r(3),c=r(1);function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=regeneratorRuntime.mark(v),d=regeneratorRuntime.mark(h),f=(0,a.createActions)({DELETE_CONVERSATION_REQUESTED:function(e){return{conversationId:e.conversationId,shopId:e.shopId}},DELETE_CONVERSATION_SUCCEEDED:function(e){return{conversationId:e.conversationId}}}),l=f.deleteConversationRequested,p=f.deleteConversationSucceeded;function v(e){var t=e.payload,r=t.conversationId,n=t.shopId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,o.call)(s.fetch,{method:"DELETE",resource:"conversations",id:r,params:{shop_id:n}});case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),e.next=9,(0,o.put)((0,c.showOperationFailureToastRequested)({error:e.t0}));case 9:case"end":return e.stop()}}),i,this,[[0,5]])}function h(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.takeEvery)(l,v);case 2:case"end":return e.stop()}}),d,this)}t.deleteConversationRequested=l,t.deleteConversationSucceeded=p,t.default=u({},p,(function(e,t){var r=t.payload.conversationId,a=n({},e.conversationIdsMap,u({},r,!1)),o=new Set(e.conversationIds);o.delete(r);var s=Array.from(o),c=e.currentConversationId;return n({},e,{currentConversationId:c===r?void 0:c,conversationIds:s,conversationIdsMap:a})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fakeConversationSucceeded=void 0;var n,a,o,s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=(0,r(0).createActions)({FAKE_CONVERSATION_SUCCEEDED:function(e){return{conversationId:e.conversationId}}}).fakeConversationSucceeded;t.fakeConversationSucceeded=c,t.default=(o=function(e,t){var r=t.payload.conversationId;return s({},e,{conversationIds:[r].concat(e.conversationIds.filter((function(e){return r!==e})))})},(a=c)in(n={})?Object.defineProperty(n,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[a]=o,n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(173);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(180);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})),Object.defineProperty(t,"socketReducer",{enumerable:!0,get:function(){return(e=n,e&&e.__esModule?e:{default:e}).default;var e}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateNoticesCount=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.watchChannel=h;var a=r(0),o=r(18),s=r(2),c=r(3),u=r(175),i=r(26),d=r(4),f=regeneratorRuntime.mark(v),l=regeneratorRuntime.mark(h),p=function(){return(0,o.eventChannel)((function(e){return c.isShared?c.socket.on("message",(function(t){var r=t.data,n=r.message_type,a=r.message_content,o=r.worker_event,s=r.payload;e(o?{event:o,payload:void 0===s?{}:s}:{pushedType:n,payload:JSON.parse(a)})})):(Object.values(d.network).forEach((function(t){c.socket.on(t,(function(){return e({event:t})}))})),c.socket.on("message",(function(t){if(t){var r=t.message_type,n=t.message_content;e({pushedType:r,payload:JSON.parse(n)})}}))),function(){}}))};function v(e){var t=e.event,r=e.pushedType,n=e.payload;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}return e.next=3,(0,s.call)(i.handleConnect,{event:t,payload:n});case 3:e.next=10;break;case 5:if(!r){e.next=10;break}return e.next=8,(0,s.put)(m());case 8:return e.next=10,(0,s.call)(u.handleSubscribe,{type:r,payload:n});case 10:case"end":return e.stop()}}),f,this)}function h(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,s.call)(p);case 2:return e=t.sent,t.next=5,(0,s.takeEvery)(e,v);case 5:case"end":return t.stop()}}),l,this)}var _,g,S,m=(0,a.createActions)({UPDATE_NOTICES_COUNT:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,r=void 0===t?"add":t;return{type:r}}}).updateNoticesCount;t.updateNoticesCount=m,t.default=(S=function(e,t){var r=t.payload.type;return n({},e,{noticesCount:"add"===r?e.noticesCount+1:0})},(g=m)in(_={})?Object.defineProperty(_,g,{value:S,enumerable:!0,configurable:!0,writable:!0}):_[g]=S,_)},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.handleConnect=t.updateReconnectFlag=void 0;var n,a,o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s=r(1),c=r(2),u=r(3),i=r(4),d=r(0),f=r(24),l=function(t){return(0,f.feedbackRequested)({feedback:{status:t,network:!0,content:e("common.toast."+t)}})};n=regeneratorRuntime.mark((function e(t){var r,n,a,o,u,i,d,f,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(201!==t.status){e.next=56;break}return e.next=4,(0,c.select)(s.isSubAccountSelector);case 4:return r=e.sent,e.next=7,(0,c.put)((0,s.updateSocketSuccessStatus)({socketSuccess:!0}));case 7:return e.next=9,(0,c.select)((function(e){return e.conversationReducer}));case 9:if(n=e.sent,a=n.latestTimestampNano,o=n.conversationIds,u=n.latestTimestamp,i=n.latestReceivedMessageId,r){e.next=28;break}if(-1!==u||a){e.next=20;break}return e.next=18,(0,c.spawn)(s.fetchConversationsRequestedSaga,{payload:{direction:"reset"}});case 18:e.next=26;break;case 20:if(-1===u&&!a||0===o.length){e.next=25;break}return e.next=23,(0,c.spawn)(s.fetchConversationsRequestedSaga,{payload:{direction:"latest"}});case 23:e.next=26;break;case 25:console.log("*** WebChat Exception Here ***");case 26:e.next=39;break;case 28:if(i){e.next=33;break}return e.next=31,(0,c.spawn)(s.fetchConversationsRequestedSaga,{payload:{direction:"reset"}});case 31:e.next=39;break;case 33:if(!i||0===o.length){e.next=38;break}return e.next=36,(0,c.spawn)(s.fetchConversationsRequestedSaga,{payload:{direction:"latest"}});case 36:e.next=39;break;case 38:console.log("*** WebChat Exception Here ***");case 39:return e.next=41,(0,c.select)(s.currentConversationSelector);case 41:return d=e.sent,e.next=44,(0,c.select)(s.conversationIdsSelector);case 44:if(f=e.sent,!(l=d&&f.includes(d.id))){e.next=51;break}return e.next=49,(0,c.put)((0,s.showConversationRequested)({conversation:d,refresh:!0,read:!0}));case 49:e.next=54;break;case 51:if(l){e.next=54;break}return e.next=54,(0,c.put)((0,s.resetConversationRequested)());case 54:e.next=58;break;case 56:return e.next=58,(0,c.put)((0,s.updateSocketSuccessStatus)({socketSuccess:!1}));case 58:case"end":return e.stop()}}),e,this)})),t.handleConnect=a=regeneratorRuntime.mark((function e(t){var r,a,o,d,p,v,h,g=t.event,S=t.payload;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=g,e.next=e.t0===i.network.CONNECT?3:e.t0===i.network.DISCONNECT?27:e.t0===i.network.RECONNECT_ERROR?32:e.t0===i.network.RECONNECTING?39:e.t0===i.network.RECONNECT?42:"emit"===e.t0?45:"close"===e.t0?50:53;break;case 3:return e.next=5,(0,c.select)(f.reconnectFlagSelector);case 5:if(!e.sent){e.next=10;break}return r=1e3*Math.floor(30*Math.random()+1),e.next=10,(0,c.delay)(r);case 10:return e.next=12,(0,c.put)((0,f.feedbackSucceeded)({feedback:void 0}));case 12:return e.next=14,(0,i.getItem)("mini-session");case 14:if(a=e.sent,o=a&&a.p_token,d=a&&a.user,!o||!d){e.next=24;break}return e.next=20,(0,c.call)(u.loginSocket,{token:o,account_id:d.uid});case 20:if(p=e.sent,u.isShared){e.next=24;break}return e.next=24,(0,c.call)(n,p);case 24:return e.next=26,(0,c.put)(_({flag:!1}));case 26:return e.abrupt("break",53);case 27:return e.next=29,(0,c.put)(_({flag:!0}));case 29:return e.next=31,(0,c.put)(l("error"));case 31:return e.abrupt("break",53);case 32:return e.next=34,(0,c.put)((0,s.abortAllSendingMessages)());case 34:return e.next=36,(0,c.put)(l("error"));case 36:return e.next=38,(0,c.put)((0,s.updateSocketSuccessStatus)({socketSuccess:!1}));case 38:return e.abrupt("break",53);case 39:return e.next=41,(0,c.put)(l("pending"));case 41:return e.abrupt("break",53);case 42:return e.next=44,(0,c.put)(l("resolved"));case 44:return e.abrupt("break",53);case 45:if(v=S.type,h=S.response,"login"!==v){e.next=49;break}return e.next=49,(0,c.call)(n,h);case 49:return e.abrupt("break",53);case 50:return e.next=52,(0,c.call)(s.logoutHandler,!1);case 52:return e.abrupt("break",53);case 53:case"end":return e.stop()}}),e,this)}));var p,v,h,_=(0,d.createActions)({UPDATE_RECONNECT_FLAG:function(e){return{flag:e.flag}}}).updateReconnectFlag;t.updateReconnectFlag=_,t.default=(h=function(e,t){var r=t.payload.flag;return o({},e,{reconnectFlag:r})},(v=_)in(p={})?Object.defineProperty(p,v,{value:h,enumerable:!0,configurable:!0,writable:!0}):p[v]=h,p),t.handleConnect=a}).call(this,r(8).t)},function(e){e.exports=JSON.parse('{"a":{"test":"test.","stable":"test-stable.","staging":"staging.","liveish":"live-test.","live":"","sandbox":"sandbox.","uat":"uat."}}')},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(1);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o=r(11);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}));var s=r(3);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})})),Object.defineProperty(t,"normalize",{enumerable:!0,get:function(){return(e=n,e&&e.__esModule?e:{default:e}).default;var e}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(30);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(31);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rateCardEntitiesSelector=t.feedStoryEntitiesSelector=t.messageShortcutGroupEntitiesSelector=t.voucherEntitiesSelector=t.productEntitiesSelector=t.orderEntitiesSelector=t.stickerEntitiesSelector=t.messageEntitiesSelector=t.conversationEntitiesSelector=t.userEntitiesSelector=t.entitiesSelector=void 0;var n=r(6),a=t.entitiesSelector=function(e){return e.entityReducer};t.userEntitiesSelector=(0,n.createSelector)(a,(function(e){return e.users})),t.conversationEntitiesSelector=(0,n.createSelector)(a,(function(e){return e.conversations})),t.messageEntitiesSelector=(0,n.createSelector)(a,(function(e){return e.messages})),t.stickerEntitiesSelector=(0,n.createSelector)(a,(function(e){return e.stickers})),t.orderEntitiesSelector=(0,n.createSelector)(a,(function(e){return e.orders})),t.productEntitiesSelector=(0,n.createSelector)(a,(function(e){return e.products})),t.voucherEntitiesSelector=(0,n.createSelector)(a,(function(e){return e.vouchers})),t.messageShortcutGroupEntitiesSelector=(0,n.createSelector)(a,(function(e){return e.messageShortcutsGroups})),t.feedStoryEntitiesSelector=(0,n.createSelector)(a,(function(e){return e.feedStories})),t.rateCardEntitiesSelector=(0,n.createSelector)(a,(function(e){return e.rateCards}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.entityReducer=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(32);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o=r(33);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}));var s=i(a),c=i(o),u=r(0);function i(e){return e&&e.__esModule?e:{default:e}}t.entityReducer=(0,u.handleActions)(n({},s.default,c.default),{users:{},messages:{},conversations:{},stickers:{},orders:{},offers:{},products:{},shops:{},rateCards:{},feedStories:{},persist:null,messageShortcuts:{}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateEntities=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var o=(0,r(0).createActions)({UPDATE_ENTITIES:function(e){return{entities:e.entities}}}).updateEntities;t.updateEntities=o,t.default=a({},o,(function(e,t){var r=t.payload.entities;return Object.entries(r).reduce((function(e,t){var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var s,c=e[Symbol.iterator]();!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(t,2),o=r[0],s=r[1];return n({},e,a({},o,"persist"!==o?n({},e[o],s):s))}),e)}))},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.batchUpdateRecord=t.deleteRecord=t.updateRecord=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.watchUpdateEntity=_;var o=r(0),s=r(2),c=r(1);function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=regeneratorRuntime.mark(h),d=regeneratorRuntime.mark(_),f=(0,o.createActions)({UPDATE_RECORD:function(e){return{name:e.name,id:e.id,record:e.record}},DELETE_RECORD:function(e){return{name:e.name,id:e.id}},BATCH_UPDATE_RECORD:function(e){return{name:e.name,records:e.records,checkProp:e.checkProp}}}),l=f.updateRecord,p=f.deleteRecord,v=f.batchUpdateRecord;function h(e){var t=e.payload,r=t.name,n=t.id,a=t.record;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("conversations"!==r){e.next=3;break}return e.next=3,(0,s.put)((0,c.updateConversationListsHash)());case 3:return e.next=5,(0,s.put)(l({name:r,id:n,record:a}));case 5:case"end":return e.stop()}}),i,this)}function _(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.takeEvery)(l,h);case 2:case"end":return e.stop()}}),d,this)}t.updateRecord=l,t.deleteRecord=p,t.batchUpdateRecord=v,t.default=(u(n={},l,(function(e,t){var r=t.payload,n=r.name,o=r.id,s=r.record;return a({},e,u({},n,a({},e[n],u({},o,a({},e[n][o],s)))))})),u(n,p,(function(e,t){var r=t.payload,n=r.name,o=r.id,s=e[n];return delete s[o],a({},e,u({},n,s))})),u(n,v,(function(e,t){var r=t.payload,n=r.name,o=r.records,s=r.checkProp,c=a({},e[n]);return Object.keys(o).forEach((function(e){(!s||s&&o[e][s]>c[e][s])&&(c[e]=a({},c[e],o[e]))})),a({},e,u({},n,c))})),n)},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.modalReducer=t.closeModal=t.showModal=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(0);function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var c=(0,o.createActions)({SHOW_MODAL:function(e){var t=e.type,r=e.title,n=void 0===r?"":r,a=e.content,o=e.actions,s=void 0===o?{}:o,c=e.additions;return{type:t,title:n,content:a,actions:s,additions:void 0===c?{}:c}},CLOSE_MODAL:function(){return{}}}),u=c.showModal,i=c.closeModal;t.showModal=u,t.closeModal=i,t.modalReducer=(0,o.handleActions)((s(n={},u,(function(e,t){var r=t.payload,n=r.type,a=r.title;return{show:!0,type:n,content:r.content,title:a,actions:r.actions,additions:r.additions}})),s(n,i,(function(e){return a({},e,{show:!1})})),n),{show:!1,type:"",title:"",content:"",actions:{}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(36);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(37);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})),Object.defineProperty(t,"unreadCountReducer",{enumerable:!0,get:function(){return(e=a,e&&e.__esModule?e:{default:e}).default;var e}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shopsUnreadConversationCountSelector=function(e){return e.unreadCountReducer.shopsUnreadConversationCount},t.totalUnreadConversationsCountSelector=function(e){return e.unreadCountReducer.totalUnreadConversationsCount}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.watchUnreadSagas=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(38);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o,s=r(0),c=(o=a)&&o.__esModule?o:{default:o};t.watchUnreadSagas=[a.watchUnreadCountChangeActionSagas],t.default=(0,s.handleActions)(n({},c.default),{totalUnreadConversationsCount:0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.refreshSingleShopUnreadConversationCount=t.updateShopsUnreadConversationsCount=t.updateSingleShopUnreadCount=t.refreshShopsUnreadConversationsCount=t.refreshTotalUnreadConversationsCount=t.updateTotalUnreadConversationsCount=t.updateUnreadCount=t.unreadCountActions=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.watchUnreadCountChangeActionSagas=k;var a,o=r(0),s=r(1),c=r(2),u=r(3);(a=r(5))&&a.__esModule;var i=regeneratorRuntime.mark(E),d=regeneratorRuntime.mark(O),f=regeneratorRuntime.mark(R),l=regeneratorRuntime.mark(k),p=t.unreadCountActions={MARK_AS_READ:"markAsRead",MARK_AS_UNREAD:"markASUnread",CLOSE_CONVERSATION:"closeConversation",RESTART_CONVERSATION:"restartConversation",DELETE_CONVERSATION:"deleteConversation",FORWARD_CONVERSATION:"forwardConversation",RECEIVE_UNREADABLE_MESSAGE:"receiveUnreadableMessage",REFRESH_TOTAL_UNREAD_CONVERSATION_COUNT:"refreshTotalUnreadConversationCount",REFRESH_SHOPS_UNREAD_CONVERSATIONS_COUNT:"refreshShopsUnreadConversationsCount",REFRESH_SINGLE_SHOP_UNREAD_CONVERSATION_COUNT:"refreshSingleShopUnreadConversationCount",UPDATE_CONVERSATION:"updateConversation",MESSAGE_QUEUE_UPDATE:"messageQueueUpdate",MASS_READ:"mass_read",MASS_UNREAD:"mass_unread",MASS_CLOSE:"mass_close",ACTIVE_CONVERSATION:"activeConversation"},v=(0,o.createActions)({UPDATE_UNREAD_COUNT:function(e){return{type:e.type,conversation:e.conversation,messageQueueUpdate:e.messageQueueUpdate,shopId:e.shopId,shopIds:e.shopIds,source:e.source,count:e.count}},UPDATE_TOTAL_UNREAD_CONVERSATIONS_COUNT:function(e){return{count:e.count}},REFRESH_TOTAL_UNREAD_CONVERSATIONS_COUNT:function(e){return{source:e.source}},REFRESH_SHOPS_UNREAD_CONVERSATIONS_COUNT:function(e){return{shopIds:e.shopIds}},UPDATE_SINGLE_SHOP_UNREAD_COUNT:function(e){return{shopId:e.shopId,num:e.num,action:e.action}},UPDATE_SHOPS_UNREAD_CONVERSATIONS_COUNT:function(e){return{shopUnreadCounts:e.shopUnreadCounts}},REFRESH_SINGLE_SHOP_UNREAD_CONVERSATION_COUNT:function(e){return{shopId:e.shopId,source:e.source}}}),h=v.updateUnreadCount,_=v.updateTotalUnreadConversationsCount,g=v.refreshTotalUnreadConversationsCount,S=v.refreshShopsUnreadConversationsCount,m=v.updateSingleShopUnreadCount,b=v.updateShopsUnreadConversationsCount,y=v.refreshSingleShopUnreadConversationCount;function E(e,t){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,c.put)((0,s.updateRecord)({name:"conversations",id:e,record:{unread_count:t}}));case 2:case"end":return r.stop()}}),i,this)}function O(e){var t,r,n,a=e.payload.source;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=a?{_s:a}:{},e.next=4,(0,c.call)(u.fetch,{parent:"conversation",resource:"unread-count",params:t});case 4:return r=e.sent,n=r.total_unread_count,e.next=8,(0,c.put)(_({count:n}));case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(0);case 12:case"end":return e.stop()}}),d,this,[[0,10]])}function R(e){var t,r,n,a,o=e.payload,u=o.type,i=o.conversation,d=void 0===i?{}:i,l=(o.shopId,o.shopIds,o.messageQueueUpdate),v=o.source,h=o.count;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.id,r=d.unread_count,d.shop_id,e.next=3,(0,c.select)(s.totalUnreadConversationsCountSelector);case 3:n=e.sent,e.t0=u,e.next=e.t0===p.FORWARD_CONVERSATION||e.t0===p.CLOSE_CONVERSATION||e.t0===p.DELETE_CONVERSATION||e.t0===p.UPDATE_CONVERSATION?7:e.t0===p.MARK_AS_READ?13:e.t0===p.ACTIVE_CONVERSATION?19:e.t0===p.MARK_AS_UNREAD?22:e.t0===p.RECEIVE_UNREADABLE_MESSAGE?27:e.t0===p.RESTART_CONVERSATION||e.t0===p.REFRESH_TOTAL_UNREAD_CONVERSATION_COUNT?33:e.t0===p.MESSAGE_QUEUE_UPDATE?36:e.t0===p.MASS_READ?40:e.t0===p.MASS_UNREAD?43:e.t0===p.MASS_CLOSE?46:49;break;case 7:if(0===r){e.next=12;break}return e.next=10,(0,c.put)(_({count:n-1}));case 10:return e.next=12,(0,c.call)(E,t,0);case 12:return e.abrupt("break",50);case 13:if(!(r>0)){e.next=18;break}return e.next=16,(0,c.put)(_({count:n-1}));case 16:return e.next=18,(0,c.call)(E,t,0);case 18:return e.abrupt("break",50);case 19:return e.next=21,(0,c.put)(_({count:n+1}));case 21:return e.abrupt("break",50);case 22:return e.next=24,(0,c.put)(_({count:n+1}));case 24:return e.next=26,(0,c.call)(E,t,r+1);case 26:return e.abrupt("break",50);case 27:if(0!==r){e.next=30;break}return e.next=30,(0,c.put)(_({count:n+1}));case 30:return e.next=32,(0,c.call)(E,t,r+1);case 32:return e.abrupt("break",50);case 33:return e.next=35,(0,c.put)(g({source:v}));case 35:return e.abrupt("break",50);case 36:return a=l.totalIncrease,l.shopsIncrease,e.next=39,(0,c.put)(_({count:n+a}));case 39:return e.abrupt("break",50);case 40:return e.next=42,(0,c.put)(_({count:n-h}));case 42:return e.abrupt("break",50);case 43:return e.next=45,(0,c.put)(_({count:n+h}));case 45:return e.abrupt("break",50);case 46:return e.next=48,(0,c.put)(_({count:n-h}));case 48:case 49:return e.abrupt("break",50);case 50:case"end":return e.stop()}}),f,this)}function k(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.takeEvery)(h,R);case 2:return e.next=4,(0,c.takeEvery)(g,O);case 4:case"end":return e.stop()}}),l,this)}t.updateUnreadCount=h,t.updateTotalUnreadConversationsCount=_,t.refreshTotalUnreadConversationsCount=g,t.refreshShopsUnreadConversationsCount=S,t.updateSingleShopUnreadCount=m,t.updateShopsUnreadConversationsCount=b,t.refreshSingleShopUnreadConversationCount=y,t.default=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},_,(function(e,t){var r=t.payload.count;return n({},e,{totalUnreadConversationsCount:r<0?0:r})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetch=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var s,c=e[Symbol.iterator]();!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=v(r(19)),s=r(10),c=r(11),u=r(1),i=r(3),d=r(4),f=v(r(14)),l=r(20),p=r(54);function v(e){return e&&e.__esModule?e:{default:e}}var h=(0,d.getChatSource)();t.fetch=function(e){var t=e.url,r=e.ssl,v=void 0===r||r,_=e.server,g=void 0===_?(0,d.getApiServer)():_,S=e.subServer,m=e.version,b=void 0===m?"v1.2":m,y=e.parent,E=e.parentId,O=e.resource,R=e.id,k=e.suffix,x=e.method,w=void 0===x?"GET":x,I=e.credentials,T=void 0===I?"include":I,C=e.extension,P=e.params,M=void 0===P?{}:P,j=e.payload,A=e.namespace,N=void 0===A?"mini":A,D=e.cleaner,U=void 0===D?function(e){return e}:D;return(0,d.getItem)("mini-session").then((function(e){var r=f.default.get("CTOKEN"),_=e||{},m=_.token,x=_.version,I=m&&"include"===T?{Authorization:"Bearer "+m}:{},P=0,A=0,D=0,L=new Date,q=void 0,F=void 0,G=void 0,H=void 0,V={};if(t)F=t;else{var B=[v?"https:/":"http:/",g,S,b,N,y,E,O,R,k].filter((function(e){return e})).join("/"),W=C?B+"."+C:B,Q=e&&e.user&&e.user.uid;Q&&(M._uid=Q);var Y=(0,d.getRuntimeVersion)();Y&&(M._v=Y),r&&(M.csrf_token=r),M._api_source=h?"sc":"pcmall",G=Object.entries(M).filter((function(e){var t=a(e,2),r=(t[0],t[1]);return r||0===r})).map((function(e){var t=a(e,2),r=t[0],n=t[1];return r+"="+encodeURIComponent(n)})).join("&"),F=[W,G].filter((function(e){return e})).join("?");var K=[N,y,E,O,R,k].filter((function(e){return e})).join("/");K="/"+K;var J=C?K+"."+C:K;V._uid=Q||"",V._v=Y||"";var z=Object.entries(V).map((function(e){var t=a(e,2),r=t[0],n=t[1];return r+"="+encodeURIComponent(n)})).join("&");H=[J,z].join("?")}return new Promise((function(e,a){if(void 0!==R&&parseInt(R)<=0||void 0!==E&&parseInt(E)<=0){var f=[y,E,O,R,k].filter((function(e){return e})).join("/");return l.Sentry&&l.Sentry.withScope((function(){l.Sentry.captureMessage(f+" parameter exception: "+E+"/"+R)})),void a(new Error)}var v=F.includes("/webchat/api")?{"x-v":x||"","x-s":(0,p.getSecurityHash)(x,{url:H,method:w,token:I.Authorization,ctoken:r||""})}:{},_={method:w,headers:n({},I,v),body:j};T&&(_.credentials=T),(0,o.default)(F,_).then((function(e){switch(200===(P=e.status)&&(A=parseInt(e.headers.get("total")),D=parseInt(e.headers.get("per-page"))),P){case 204:return null;case 404:return{message:"Resource not found"};case 500:return{message:"Internal server error."};case 502:return{message:"Bad Gateway"};default:return e.json()}})).then((function(r){var n,o,f,p=Date.now()-L;if("read"===O&&(0,i.collectAsyncTask)(i.ReportPoint.READ_API,p),void 0===R&&void 0!==O&&("messages"===O&&G.indexOf("shop_id")<0?(q=JSON.parse(j).request_id,(0,d.setItem)(q,L),(0,i.collectAsyncTask)(i.ReportPoint.MESSAGE_API,p)):i.ReportPoint[O.toUpperCase()]&&(0,i.collectAsyncTask)(i.ReportPoint[O.toUpperCase()],p)),200===P?e(r instanceof Array?(n={total:A,perPage:D},o=O,f=r.map((function(e){return U(e,h)})),o in n?Object.defineProperty(n,o,{value:f,enumerable:!0,configurable:!0,writable:!0}):n[o]=f,n):U(r,h)):204===P&&e(),(0,c.isError)(P)){var v=t||[y,E,O,R,k].filter((function(e){return e})).join("/");if(400!==P&&404!==P||l.Sentry&&l.Sentry.withScope((function(e){e.setTags({api:v,type:"API Request Error"}),e.setExtras({params:G,status:P,message:r.message,errorCode:r.errors||r.error_code,errorData:r.data}),l.Sentry.captureException(new((0,c.HTTPError)(P))(r))})),[429,491,493].includes(P)){var _=new((0,c.HTTPError)(P))(r);a(_)}else if(401===P)s.store.dispatch((0,u.handle401ErrorRequested)({resource:O}));else{var g=new((0,c.HTTPError)(P))(r.message,r.errors||r.error_code||r.errcode,r.data);a(g)}}})).catch((function(e){var t=[y,E,O,R,k].filter((function(e){return e})).join("/");l.Sentry&&l.Sentry.withScope((function(r){r.setTags({api:t,type:"Uncaught Error"}),r.setExtras({params:G,status:P}),l.Sentry.captureException(e)})),P||(e.offlineError=!0),a(e)}))}))}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.name=r.constructor.name,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"handler",value:function(){}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error));t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(4),o=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name=n.constructor.name,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"handler",value:function(){(0,a.removeItem)("mini-session")}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error));t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.name=r.constructor.name,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"handler",value:function(){}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error));t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name=n.constructor.name,n.errors=r,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"handler",value:function(){}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error));t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.name=r.constructor.name,r.handler=r.handler.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"handler",value:function(){}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error));t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.name=n.constructor.name,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"handler",value:function(){}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error));t.default=a},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(t){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.name=t.constructor.name,t.message=e,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,t),r(n,[{key:"handler",value:function(){var t=void 0;switch(this.message.error_code){case"unauthorized_for_shop":t="forward.error.unauthorized_for_shop";break;case"target_subaccount_unauthorized_for_shop":t="forward.error.target_subaccount_unauthorized_for_shop";break;case"target_group_unauthorized_for_shop":t="forward.error.target_group_unauthorized_for_shop";break;case"conversation_not_belong_to_you":t="forward.error.conversation_not_belong_to_you";break;case"conversation_not_dispatch":t="forward.error.conversation_not_dispatch";break;case"cannot_move_conversation_to_yourself":t="forward.error.cannot_move_conversation_to_yourself";break;case"target_subaccount_not_online":t="forward.error.target_subaccount_not_online";break;case"subaccount_conversation_not_found":t="forward.error.subaccount_conversation_not_found";break;case"conversation_closed":t="forward.error.conversation_closed"}return{show:!0,type:"fail",message:e(t)}}}]),n}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error));t.default=n}).call(this,r(8).t)},function(e,t){e.exports=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(e){function t(e,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.name=a.constructor.name,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"handler",value:function(){}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error));t.default=a},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(t){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.name=t.constructor.name,t.message=e,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,t),r(n,[{key:"handler",value:function(){var t=void 0;switch(this.message.error_code){case"send_rating_card_too_frequently":t="conversation_detail.message_list.rating_card_duplicate";break;case"rating_card_rated":case"rating_card_expired":default:t="common.server_error.warning_tips"}return{message:e(t),show:!0,type:"fail"}}}]),n}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error));t.default=n}).call(this,r(8).t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.name=r.constructor.name,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"handler",value:function(){}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error));t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.name=r.constructor.name,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"handler",value:function(){}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error));t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(e){function t(e,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.name=a.constructor.name,a.errors=r,a.data=n,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"handler",value:function(){}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error));t.default=a},function(e,t){e.exports=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSecurityHash=function(e,t){var r=t.url,n=t.method,u=t.token,i=t.ctoken,d=function(e){return"live"===(0,o.getRuntimeServer)()?c[e]:s[e]}(e);switch(e){case 1:return function(e,t){return(0,a.default)(e+t).toString()}(r,d);case 2:return function(e,t,r){return(0,a.default)(e+t+r).toString()}(r,d,n);case 3:return function(e,t,r){return(0,a.default)(e+t+r).toString()}(r,d,u);case 4:return function(e,t,r){return(0,a.default)(e+t+r).toString()}(r,d,i);default:return""}};var n,a=(n=r(55))&&n.__esModule?n:{default:n},o=r(4),s={1:"70c74f4e-dcda-483e-826b-19dd2c42e799",2:"29ffec18-c614-4645-8f1c-686e22d2e26a",3:"04229e76-1ba3-4ac9-8a4e-68d46a3881a2",4:"a3769a87-35cf-45e9-a5a7-2b4016c52e92"},c={1:"396c15ad-6d3e-4018-98be-cef58cb45cd0",2:"607c871d-b766-4c6f-ba89-b6c6ca32b156",3:"42990074-9a73-4459-b749-f3110d222a72",4:"5702b6f3-62a3-44d2-abe8-fece100a8bf4"}},function(e,t){e.exports=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reportApiTime=t.papConfig=t.initPapSdk=t.collectAsyncTask=t.collectComponentTask=t.collectLoadTask=t.ReportPoint=t.MarkName=t.ReportComponent=void 0;var n,a,o=r(57),s=(n=o)&&n.__esModule?n:{default:n},c=r(4),u=r(58),i=void 0,d=t.ReportComponent={WELCOME_PAGE:"WELCOME_PAGE",MESSAGE_LIST:"MESSAGE_LIST",CONVERSATION_LIST:"CONVERSATION_LIST",APP:"APP"},f=t.MarkName={HTML_LOADED:"HTML_LOADED",STATIC_LOADED:"STATIC_LOADED",APP_PREPARED:"APP_PREPARED",LOGIN_API_RESPONSED:"LOGIN_API_RESPONSED",APP_RENDERING:"APP_RENDERING",RENDER_CONVERSATION_LIST:"RENDER_CONVERSATION_LIST",RENDER_MESSAGE_LIST:"RENDER_MESSAGE_LIST",RENDER_WELCOME_PAGE:"RENDER_WELCOME_PAGE"};t.ReportPoint=a={CONVERSATIONS:100372,MESSAGES:100373,ORDERS:100374,SHOPS:100375,ITEMS:100376,OFFER:100377,MESSAGE_SOCKET:100378,MESSAGE_API:100379,READ_API:100662,READ_SOCKET:100663},t.ReportPoint=a;var l=void 0,p=!1,v=location.host.includes("shopee.cn"),h=[],_=(t.collectLoadTask=function(){var e=performance.getEntriesByName(f.HTML_LOADED,"mark")[0].startTime,t=performance.getEntriesByName(f.STATIC_LOADED,"mark")[0].startTime,r=performance.getEntriesByName(f.APP_PREPARED,"mark")[0].startTime,n=performance.getEntriesByName(f.LOGIN_API_RESPONSED,"mark")[0].startTime,o=performance.getEntriesByName(f.APP_RENDERING,"mark")[0].startTime;h.push({id:a.LOAD_HTML,duration:window.__INDEX_HTML_LOADED__},{id:a.LOAD_STATIC,duration:Number.parseInt(t-e)},{id:a.APP_PREPARE,duration:Number.parseInt(r-t)},{id:a.LOGIN_API,duration:Number.parseInt(n-r)},{id:a.LOGIN_SUCCEEDED,duration:Number.parseInt(o-n)})},t.collectComponentTask=function(e,t){var r=null,n=performance.getEntriesByName(f.APP_RENDERING,"mark")[0].startTime;switch(e){case d.WELCOME_PAGE:r=performance.getEntriesByName(f.RENDER_WELCOME_PAGE,"mark")[0].startTime,h.push({id:a.RENDER_WELCOME_PAGE,duration:Number.parseInt(r-n)});break;case d.MESSAGE_LIST:r=performance.getEntriesByName(f.RENDER_MESSAGE_LIST,"mark")[0].startTime,h.push({id:a.RENDER_MESSAGE_LIST,duration:Number.parseInt(r-n)});break;case d.CONVERSATION_LIST:r=performance.getEntriesByName(f.RENDER_CONVERSATION_LIST,"mark")[0].startTime,h.push({id:a.RENDER_CONVERSATION_LIST,duration:Number.parseInt(r-n)})}h.push(t),(0,u.requestIdleCallback)(_,{timeout:2e3})},t.collectAsyncTask=function(e,t){h.push({id:e,duration:t}),(0,u.requestIdleCallback)(_,{timeout:2e3})},function e(t){for(;(t.timeRemaining()>5||t.didTimeout)&&h.length;){var r=h.shift(),n=r.id,a=r.duration;n&&S(n,a)}h.length&&(0,u.requestIdleCallback)(e,{timeout:2e3})}),g=t.initPapSdk=function(){if(!p){var e="live"===(0,c.getRuntimeServer)(),t=(0,c.getRuntimeRegion)();l=new s.default({project:41,environment:e?o.Environment.LIVE:o.Environment.TEST,interval:2e3,region:t,reportResource:!0,reportPerformance:!0,sample:e?.03:1}),p=!0}},S=(t.papConfig=function(e){i=e},t.reportApiTime=function(e,t){p||g(),l.send({point_id:e,value:t,type:"relative",category_id:i,category_id_1:v&&"CN"!==(0,c.getRuntimeRegion)().toUpperCase()?"cn":"local"})})},function(e,t){e.exports=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestIdleCallback=function(e){if(window.requestIdleCallback)return window.requestIdleCallback(e);var t=Date.now();return setTimeout((function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})}),1)},t.cancelIdleCallback=function e(t){return e?e(t):clearTimeout(t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTranslation=void 0;var n=r(4),a=r(3);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=function(e){var t,r=e.type,n=e.id,s=e.locale,c=e.isLive,u=void 0!==c&&c,i=(o(t={},r+"_id",n),o(t,"language",s),t),d=function(e){return e?"https://seller.shopee.sg/api/tsp/transify":"https://seller.shopee.sg/api/tsp/nonlive/transify"}(u)+"?"+function(e){return Object.keys(e).reduce((function(t,r){return t+"&"+r+"="+e[r]}),"")}(i);return(0,a.fetch)({url:d,credentials:""})},c=function(e){var t=e.type,r=e.id,o=e.locale,s={cn:"https://deo.shopeesz.com/shopee/shopee-seller-live-sg/tsp/api/",sea:"https://deo.shopeemobile.com/shopee/shopee-seller-live-sg/tsp/api/"}[(0,n.isVisitingShopeeCN)()?"cn":"sea"]+(t[0]+"_")+r+"_"+o+".json";return(0,a.fetch)({url:s,credentials:""})};t.getTranslation=function(e){var t=e.type,r=void 0===t?"collection":t,a=e.id,o=void 0===a?138:a,u=e.locale,i=e.timeout,d=void 0===i?3e3:i,f="live"===(0,n.getRuntimeServer)()||"live-test"===(0,n.getRuntimeServer)(),l=u.toLowerCase();return"th-th"===l&&(l="th"),"vi-vn"===l&&(l="vi"),"id-id"===l&&(l="id"),0===d?s({type:r,id:o,locale:l,isLive:f}):new Promise((function(e){var t=void 0;s({type:r,id:o,locale:l,isLive:f}).then((function(r){t&&clearTimeout(t),e(r)})),t=setTimeout((function(){try{c({type:r,id:o,locale:l}).then((function(t){e(t)}))}catch(t){s({type:r,id:o,locale:l,isLive:f}).then((function(t){e(t)}))}}),d)}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.updateOrReplaceAction=i;var a,o=(a=r(5))&&a.__esModule?a:{default:a},s=r(2),c=r(1),u=regeneratorRuntime.mark(i);function i(e,t,r){var a,i,d;return regeneratorRuntime.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return a=e,i=[],d=[],Array.isArray(e)&&(a=((0,o.default)(r,e).entities||{})[r]||{}),t.forEach((function(e){var t=e.id,o=a[t];o?"conversations"!==r||void 0===o.faking&&!o.latestMessageStatus?i.push((0,s.put)((0,c.updateRecord)({name:r,id:t,record:n({},e)}))):(delete(e=n({},o,e)).faking,delete e.latestMessageStatus,d.push(e)):d.push(e)})),d.length&&i.push((0,s.put)((0,c.updateEntities)({entities:(0,o.default)(r,d).entities}))),u.next=8,(0,s.all)(i);case 8:case"end":return u.stop()}}),u,this)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getConversationIds=function(e,t,r,n){switch(r){case"reset":if(n){var a=Array.isArray(t)?[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(t)):[];return a.unshift(n),a}return t;case"latest":return t.concat(e.filter((function(e){return!t.includes(e)})));case"older":return e.concat(t.filter((function(t){return!e.includes(t)})))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldPersistItem=t.generatePersist=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(4);t.generatePersist=function(e,t,r){if(e){var o={};return e.forEach((function(e){o[e]=!0})),(0,a.simpleEqualCheck)(r.slice(0,a.persistLimit),e)?n({},t,{changed:!1}):{changed:!0,conversationIds:e,conversationIdsMap:o,lastConversationId:e[e.length-1]}}return null},t.shouldPersistItem=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e||"number"!=typeof e.storedTimestamp)return!1;var r=18e4,n=18e5;return Date.now()<e.storedTimestamp+(t?r:n)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventBus=void 0;var n=r(64);t.EventBus=new n.EventEmitter},function(e,t,r){"use strict";var n,a="object"==typeof Reflect?Reflect:null,o=a&&"function"==typeof a.apply?a.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=a&&"function"==typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function c(){c.init.call(this)}e.exports=c,e.exports.once=function(e,t){return new Promise((function(r,n){function a(){void 0!==o&&e.removeListener("error",o),r([].slice.call(arguments))}var o;"error"!==t&&(o=function(r){e.removeListener(t,a),n(r)},e.once("error",o)),e.once(t,a)}))},c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var u=10;function i(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function f(e,t,r,n){var a,o,s,c;if(i(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(a=d(e))>0&&s.length>a&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,c=u,console&&console.warn&&console.warn(c)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},a=l.bind(n);return a.listener=r,n.wrapFn=a,a}function v(e,t,r){var n=e._events;if(void 0===n)return[];var a=n[t];return void 0===a?[]:"function"==typeof a?r?[a.listener||a]:[a]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(a):_(a,a.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function _(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return d(this)},c.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,a=this._events;if(void 0!==a)n=n&&void 0===a.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var c=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw c.context=s,c}var u=a[e];if(void 0===u)return!1;if("function"==typeof u)o(u,this,t);else{var i=u.length,d=_(u,i);for(r=0;r<i;++r)o(d[r],this,t)}return!0},c.prototype.addListener=function(e,t){return f(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return f(this,e,t,!0)},c.prototype.once=function(e,t){return i(t),this.on(e,p(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){return i(t),this.prependListener(e,p(this,e,t)),this},c.prototype.removeListener=function(e,t){var r,n,a,o,s;if(i(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(a=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,a=o;break}if(a<0)return this;0===a?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,a),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var a,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(a=o[n])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},c.prototype.listeners=function(e){return v(this,e,!0)},c.prototype.rawListeners=function(e){return v(this,e,!1)},c.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},c.prototype.listenerCount=h,c.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.networkJudge=function(){if(o)return null;o=!0,function e(){var t="t="+Date.now(),r=[u,t].join("?");s=setTimeout((function(){(0,a.default)(r,{method:"GET"}).then((function(){clearTimeout(s),o=!1,window.dispatchEvent(new Event("judge-online"))})).catch((function(){e()}))}),5e3)}()};var n,a=(n=r(13))&&n.__esModule?n:{default:n},o=!1,s=null,c=document.location,u=c.protocol+"//"+c.host+"/favicon.ico"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.heartbeat=t.loginSocket=t.socket=t.isShared=void 0;var n,a,o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s=(n=r(21))&&n.__esModule?n:{default:n},c=r(4),u=(0,c.getChatSource)();a=u?"scminichat":"pmminichat";var i=new s.default({shouldShared:u,name:(0,c.getRuntimeRegion)()+"_"+(0,c.getRuntimeServer)()+"_seller-push-ws"}),d=i.isShared,f=i.socket;t.isShared=d,t.socket=f,t.loginSocket=function(e){return d?f.emit("login",o({},e,{app_id:a}),!0):new Promise((function(t){f.emit("login",o({},e,{app_id:a}),(function(e){return t(JSON.parse(e))}))}))},t.heartbeat=function(e){var t,r,n=e.noticesCount,o=e.readMissedCount;return t={app_id:a,noticesCount:n,readMissedCount:o},r=a+"|"+n+"|"+o,d?f.heartbeat({emitEvent:"heartbeat",args:t,pollingTime:6e4,remedyTime:9e4,separator:"|"}):f.emit("heartbeat",r)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loginCSSocket=t.csSocket=t.isCSSocketShared=void 0;var n,a=(n=r(21))&&n.__esModule?n:{default:n},o=r(4),s=(0,o.getChatSource)(),c=new a.default({name:(0,o.getRuntimeRegion)()+"_"+(0,o.getRuntimeServer)()+"_chat-ws",shouldShared:s}),u=c.isShared,i=c.socket;t.isCSSocketShared=u,t.csSocket=i,t.loginCSSocket=function(){return i.emit("message","13"+JSON.stringify({country:((0,o.getRuntimeRegion)()||"").toLocaleUpperCase(),source:"newwebchat"}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRouterPath=t.history=void 0;var n=r(69),a=t.history=(0,n.createBrowserHistory)({basename:"/chateasy"});t.getRouterPath=function(){var e=a.location,t=e&&e.pathname;return t&&t.startsWith("/")?t.split("/")[1]:t}},function(e,t){e.exports=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tracker=t.configTrackerUser=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=u(r(14)),o=u(r(13)),s=r(190),c=r(4);function u(e){return e&&e.__esModule?e:{default:e}}var i=null,d=void(t.configTrackerUser=function(e){e&&(i=e)}),f=null;t.tracker=function(e,t,r){var u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"click",l=arguments[4];if(!f)if(window.BITrack)f=window.BITrack;else{var p=function(){return navigator?navigator.userAgent||navigator.vendor:""},v={appId:1,fetch:o.default,source:"pc",platform:"pc",ua:p(),getCookies:a.default.get,sendEventByInterval:!0,enableAutoTrack:!1,storage:c.storage};d=(0,s.createTrackingV3Sdk)(n({locale:(0,c.getRuntimeRegion)(),env:(0,c.getRuntimeServer)()},v)),f=d.sync.bind(d)}var h=i||{},_=h.shop_id,g=void 0===_?"":_,S=h.type,m=void 0===S?"":S,b=h.id,y=void 0===b?"":b,E=void 0;E="minichat_page";var O=(0,c.getChatSource)(),R=Object.assign({},{shopid:g,account_type:m,account_id:y,platform:O?"minichat":"pc_mall"},r);f({data:{type:"v3",timestamp:Date.now(),info:{page_section:e,target_type:t,page_type:l||E,operation:u,data:R}}})}},function(e,t){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var n=new Uint8Array(16);e.exports=function(){return r(n),n}}else{var a=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}},function(e,t){for(var r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,a=r;return[a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]]].join("")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncWorker=void 0;var n,a=(n=r(74))&&n.__esModule?n:{default:n},o=null;(0,r(4).getChatSource)()&&window.SharedWorker&&(o=new a.default).port.start(),t.syncWorker=o&&o.port},function(e,t){e.exports=function(e){return new SharedWorker("/chateasy/sync.worker.js",e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(76);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(77);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})),Object.defineProperty(t,"userReducer",{enumerable:!0,get:function(){return(e=a,e&&e.__esModule?e:{default:e}).default;var e}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showEntrySelector=t.socketSuccessSelector=t.loginSuccessSelector=t.isScChatSelector=t.openedMenuSelector=t.showChatWindowSelector=t.showConversationDetailSelector=t.currentUserRoleSelector=t.currentUserShopIdSelector=t.isSubAccountSelector=t.localeSelector=t.currentUserSelector=t.userSelector=t.networkStatusSelector=t.tipsSelector=t.newbieSelector=t.currentUserIdSelector=void 0;var n=r(7),a=r(6),o=r(1),s=r(5),c=t.currentUserIdSelector=function(e){return e.userReducer.currentUserId},u=(t.newbieSelector=function(e){return e.userReducer.newbie},t.tipsSelector=function(e){return e.userReducer.translateTips},t.networkStatusSelector=function(e){return e.userReducer.networkStatus},t.userSelector=function(e){return(0,a.createSelector)(o.entitiesSelector,(function(t){return(0,n.denormalize)(e,s.userSchema,{users:t})}))},t.currentUserSelector=(0,a.createSelector)(o.entitiesSelector,c,(function(e,t){return(0,n.denormalize)(t,s.userSchema,e)||{}}))),i=(t.localeSelector=(0,a.createSelector)(u,(function(e){return e&&e.locale})),t.isSubAccountSelector=(0,a.createSelector)(u,(function(e){return!!e&&"subaccount"===e.type})));t.currentUserShopIdSelector=(0,a.createSelector)(u,i,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];return t?void 0:e.shop_id})),t.currentUserRoleSelector=(0,a.createSelector)(u,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.role||""})),t.showConversationDetailSelector=function(e){return e.userReducer.showConversationDetail},t.showChatWindowSelector=function(e){return e.userReducer.showChatWindow},t.openedMenuSelector=function(e){return e.userReducer.openedMenu},t.isScChatSelector=function(e){return e.userReducer.isScChat},t.loginSuccessSelector=function(e){return e.userReducer.loginSuccess},t.socketSuccessSelector=function(e){return e.userReducer.socketSuccess},t.showEntrySelector=function(e){return e.userReducer.showEntry}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.watchUserSagas=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(78);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o=r(79);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}));var s=r(80);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})}));var c=r(81);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})}));var u=r(82);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})}));var i=r(83);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})}));var d=r(84);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}})}));var f=r(85);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})}));var l=r(86);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})}));var p=r(0),v=b(a),h=b(o),_=b(s),g=b(c),S=b(f),m=b(d);function b(e){return e&&e.__esModule?e:{default:e}}t.watchUserSagas=[a.watchBlock,o.watchGuides,s.watchUpdateGuides,c.watchUpdate,f.watchLogin,u.watchShow,i.watchSync],t.default=(0,p.handleActions)(n({},v.default,h.default,_.default,g.default,S.default,m.default),{newbie:[],networkStatus:"online",translateTips:{},isScChat:!0,openedMenus:"",loginSuccess:!0,socketSuccess:!0,showChatWindow:!1,showConversationDetail:!0,showEntry:!0})},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.blockUserRequested=void 0,t.watchBlock=l;var n=r(0),a=r(2),o=r(1),s=r(3),c=r(11),u=regeneratorRuntime.mark(f),i=regeneratorRuntime.mark(l),d=(0,n.createActions)({BLOCK_USER_REQUESTED:function(e){var t=e.buyerName,r=e.buyerId,n=e.block;return{buyerName:t,buyerId:r,block:void 0===n||n,shopId:e.shopId,conversationId:e.conversationId}}}).blockUserRequested;function f(t){var r,n,i=t.payload,d=i.buyerName,f=i.buyerId,l=i.block,p=i.shopId,v=i.conversationId;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=l?"PUT":"DELETE",t.next=4,(0,a.call)(s.fetch,{method:r,parent:"user",resource:"blocks",id:f,params:{shop_id:p}});case 4:return t.next=6,(0,a.put)((0,o.updateRecord)({name:"users",id:f,record:{is_blocked:l}}));case 6:return t.next=8,(0,a.put)((0,o.updateRecord)({name:"conversations",id:v,record:{is_blocked:l}}));case 8:t.next=21;break;case 10:if(t.prev=10,t.t0=t.catch(0),!(t.t0 instanceof c.Forbidden)){t.next=19;break}return(n={type:"CONFIRM_MODAL",title:{key:l?"conversation_detail.workstation.block_fail_modal.title":"conversation_detail.workstation.unblock_fail_modal.title",vars:{username:d}},actions:{confirm:{label:{key:"common.confirm"}}}}).content={key:l?"conversation_detail.workstation.block_fail_modal.content":"conversation_detail.workstation.unblock_fail_modal.content"},t.next=17,(0,a.put)((0,o.showModal)(n));case 17:t.next=21;break;case 19:return t.next=21,(0,a.put)((0,o.setToastInformation)({toast:{show:!0,type:"fail",message:e("common.server_error.warning_tips")}}));case 21:case"end":return t.stop()}}),u,this,[[0,10]])}function l(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.takeEvery)(d,f);case 2:case"end":return e.stop()}}),i,this)}t.blockUserRequested=d,t.default={}}).call(this,r(8).t)},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.getGuideFailed=t.getGuideSucceeded=t.getGuideRequested=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.getGuide=_,t.watchGuides=g;var o=r(0),s=r(2),c=r(3),u=r(4);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var d=regeneratorRuntime.mark(_),f=regeneratorRuntime.mark(g),l=(0,o.createActions)({GET_GUIDE_REQUESTED:function(e){var t=e.userId,r=void 0===t?null:t,n=e.version;return{userId:r,version:void 0===n?null:n}},GET_GUIDE_SUCCEEDED:function(e){return{newbie:e.newbie}},GET_GUIDE_FAILED:function(){return{}}}),p=l.getGuideRequested,v=l.getGuideSucceeded,h=l.getGuideFailed;function _(){var e,t,r,n,a=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).payload,o=(a=void 0===a?{}:a).userId,i=a.version;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,e="newbie-completed-info",a.next=4,(0,u.getItem)(e);case 4:if(a.sent!==o+"-"+i){a.next=7;break}return a.abrupt("return",[]);case 7:return a.next=9,(0,s.call)(c.fetch,{resource:"newbie",suffix:"uncompleted"});case 9:return t=a.sent,r=t.newbie,a.next=13,(0,s.put)(v({newbie:r}));case 13:if(!r.length){a.next=19;break}if(n=r.findIndex((function(e){return(e.name||"").toLocaleLowerCase().includes("mini")})),a.t0=n<0,!a.t0){a.next=19;break}return a.next=19,(0,u.setItem)(e,o+"-"+i);case 19:return a.abrupt("return",r);case 22:return a.prev=22,a.t1=a.catch(0),a.next=26,(0,s.put)(h());case 26:return a.abrupt("return",[]);case 27:case"end":return a.stop()}}),d,this,[[0,22]])}function g(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.takeEvery)(p,_);case 2:case"end":return e.stop()}}),f,this)}t.getGuideRequested=p,t.getGuideSucceeded=v,t.getGuideFailed=h,t.default=(i(n={},v,(function(e,t){var r=t.payload.newbie;return a({},e,{newbie:r})})),i(n,h,(function(e){return a({},e,{newbie:[]})})),n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateGuideSucceeded=t.updateGuideRequested=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.updateGuide=g,t.watchUpdateGuides=S;var a,o,s,c=r(0),u=r(2),i=r(3),d=r(1),f=regeneratorRuntime.mark(g),l=regeneratorRuntime.mark(S),p=(0,c.createActions)({UPDATE_GUIDE_REQUESTED:function(e){return{newbieId:e.newbieId}},UPDATE_GUIDE_SUCCEEDED:function(e){return{newbie:e.newbie}}}),v=p.updateGuideRequested,h=p.updateGuideSucceeded;function _(e,t){var r=[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(e)),n=!0,a=!1,o=void 0;try{for(var s,c=r[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var u=s.value,i=u.children.findIndex((function(e){return e.id===t}));if(-1!==i){u.children.splice(i,1);break}}}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}return r}function g(e){var t,r,n=e.payload.newbieId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.select)(d.newbieSelector);case 2:return t=e.sent,r=_(t,n),e.next=6,(0,u.put)(h({newbie:r}));case 6:return e.prev=6,e.next=9,(0,u.call)(i.fetch,{method:"PUT",resource:"newbie",id:n});case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(6);case 13:case"end":return e.stop()}}),f,this,[[6,11]])}function S(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.takeEvery)(v,g);case 2:case"end":return e.stop()}}),l,this)}t.updateGuideRequested=v,t.updateGuideSucceeded=h,t.default=(s=function(e,t){var r=t.payload.newbie;return n({},e,{newbie:r})},(o=h)in(a={})?Object.defineProperty(a,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[o]=s,a)},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.updateChatEntryStatus=t.updateSocketSuccessStatus=t.updateLoginSuccessStatus=t.setChatSource=t.updateOpenedMenu=t.updateConversationDetailStatusSucceeded=t.updateConversationDetailStatus=t.updateChatWindowStatusSucceeded=t.updateChatWindowStatus=t.updateNetworkStatus=t.updateUserRequested=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.updateUser=I,t.readMessage=T,t.updateChatWindowStatusSaga=C,t.updateConversationDetailStatusSaga=P,t.watchUpdate=M;var o=r(0),s=r(2),c=r(1),u=r(3),i=r(4);function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var f=regeneratorRuntime.mark(I),l=regeneratorRuntime.mark(T),p=regeneratorRuntime.mark(C),v=regeneratorRuntime.mark(P),h=regeneratorRuntime.mark(M),_=(0,o.createActions)({UPDATE_USER_REQUESTED:function(e){return{status:e.status}},UPDATE_NETWORK_STATUS:function(e){return{networkStatus:e.networkStatus}},UPDATE_CHAT_WINDOW_STATUS:function(e){return{shouldShowWindow:e.shouldShowWindow}},UPDATE_CHAT_WINDOW_STATUS_SUCCEEDED:function(e){return{shouldShowWindow:e.shouldShowWindow}},UPDATE_CONVERSATION_DETAIL_STATUS:function(e){var t=e.shouldShowConversationDetail,r=e.needMark;return{shouldShowConversationDetail:t,needMark:void 0!==r&&r}},UPDATE_CONVERSATION_DETAIL_STATUS_SUCCEEDED:function(e){return{shouldShowConversationDetail:e.shouldShowConversationDetail}},UPDATE_OPENED_MENU:function(e){return{openedMenu:e}},SET_CHAT_SOURCE:function(e){return{isScChat:e.isScChat}},UPDATE_LOGIN_SUCCESS_STATUS:function(e){return{loginSuccess:e.loginSuccess}},UPDATE_SOCKET_SUCCESS_STATUS:function(e){return{socketSuccess:e.socketSuccess}},UPDATE_CHAT_ENTRY_STATUS:function(e){return{showEntry:e.showEntry}}}),g=_.updateUserRequested,S=_.updateNetworkStatus,m=_.updateChatWindowStatus,b=_.updateChatWindowStatusSucceeded,y=_.updateConversationDetailStatus,E=_.updateConversationDetailStatusSucceeded,O=_.updateOpenedMenu,R=_.setChatSource,k=_.updateLoginSuccessStatus,x=_.updateSocketSuccessStatus,w=_.updateChatEntryStatus;function I(e){var t=e.payload.status;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,s.call)(u.fetch,{method:"PUT",resource:"user",payload:JSON.stringify({distribution_status:t})});case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),e.next=9,(0,s.put)((0,c.showOperationFailureToastRequested)({error:e.t0}));case 9:case"end":return e.stop()}}),f,this,[[0,5]])}function T(){var e,t,r,n,a,o;return regeneratorRuntime.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,(0,s.select)(c.currentConversationSelector);case 2:if(!(e=u.sent)){u.next=8;break}if(t=e.status,r=e.shop_id,n=e.id,a=e.unread_count,o=e.latest_message_id,!("closed"!==t&&a>0)){u.next=8;break}return u.next=8,(0,s.put)((0,c.markMessagesRequested)({conversationId:n,isRead:!0,latestMessageId:o,shopId:r}));case 8:case"end":return u.stop()}}),l,this)}function C(e){var t=e.payload.shouldShowWindow;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=10;break}return e.next=3,(0,s.call)(T);case 3:return window.CsChat&&window.CsChat.minimizeCsChatWindow&&window.CsChat.minimizeCsChatWindow(),e.next=6,(0,s.select)(c.settingsFetchStatusSelector);case 6:if(e.sent===i.HttpStatus.SUCCEED){e.next=10;break}return e.next=10,(0,s.spawn)(c.fetchSettings);case 10:return e.next=12,(0,s.put)(b({shouldShowWindow:t}));case 12:case"end":return e.stop()}}),p,this)}function P(e){var t=e.payload,r=t.shouldShowConversationDetail,n=t.needMark;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.put)(E({shouldShowConversationDetail:r}));case 2:if(e.t0=n&&r,!e.t0){e.next=6;break}return e.next=6,(0,s.call)(T);case 6:case"end":return e.stop()}}),v,this)}function M(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.takeEvery)(g,I);case 2:return e.next=4,(0,s.takeEvery)(m,C);case 4:return e.next=6,(0,s.takeEvery)(y,P);case 6:case"end":return e.stop()}}),h,this)}t.updateUserRequested=g,t.updateNetworkStatus=S,t.updateChatWindowStatus=m,t.updateChatWindowStatusSucceeded=b,t.updateConversationDetailStatus=y,t.updateConversationDetailStatusSucceeded=E,t.updateOpenedMenu=O,t.setChatSource=R,t.updateLoginSuccessStatus=k,t.updateSocketSuccessStatus=x,t.updateChatEntryStatus=w,t.default=(d(n={},S,(function(e,t){var r=t.payload.networkStatus;return a({},e,{networkStatus:r})})),d(n,b,(function(e,t){var r=t.payload.shouldShowWindow;return a({},e,{showChatWindow:r})})),d(n,E,(function(e,t){var r=t.payload.shouldShowConversationDetail;return a({},e,{showConversationDetail:r})})),d(n,O,(function(e,t){var r=t.payload.openedMenu;return a({},e,{openedMenu:r})})),d(n,R,(function(e,t){var r=t.payload.isScChat;return a({},e,{isScChat:r})})),d(n,k,(function(e,t){var r=t.payload.loginSuccess;return a({},e,{loginSuccess:r})})),d(n,x,(function(e,t){var r=t.payload.socketSuccess;return a({},e,{socketSuccess:r})})),d(n,w,(function(e,t){var r=t.payload.showEntry;return a({},e,{showEntry:r})})),n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showUserRequested=void 0,t.watchShow=d,t.fetchUserOrderDetail=f,t.showUser=l;var n=r(2),a=r(3),o=r(0),s=regeneratorRuntime.mark(d),c=regeneratorRuntime.mark(f),u=regeneratorRuntime.mark(l),i=(0,o.createActions)({SHOW_USER_REQUESTED:function(e){return{userId:e.userId,shopId:e.shopId,toStatus:e.toStatus}}}).showUserRequested;function d(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,n.takeEvery)(i,l);case 2:case"end":return e.stop()}}),s,this)}function f(e){var t,r,o,s;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return r=(t=e).userId,o=t.shopId,c.prev=3,c.next=6,(0,n.call)(a.fetch,{parent:"users",parentId:r,resource:"get_user_shop_statistics_info",params:{shop_id:o}});case 6:return s=c.sent,c.abrupt("return",s);case 10:return c.prev=10,c.t0=c.catch(3),c.abrupt("return",{});case 13:case"end":return c.stop()}}),c,this,[[3,10]])}function l(e){var t,r,o,s,c,i,d=e.payload,l=d.userId,p=d.shopId,v=d.buyerShopId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0,e.prev=1,e.next=4,(0,n.call)(a.fetch,{resource:"users",id:l,params:{need_cache:1,cache_expires:1800}});case 4:t=e.sent,e.next=12;break;case 7:e.prev=7,e.t0=e.catch(1),t={id:l,shop_id:v};case 12:return r={userId:l,shopId:p},e.next=16,(0,n.call)(f,r);case 16:return o=e.sent,e.next=19,(0,n.select)((function(e){return e.entityReducer}));case 19:return s=e.sent,c=s.users,i=Object.assign({},t,o),e.next=24,(0,n.call)(a.updateOrReplaceAction,c,[i],"users");case 24:case"end":return e.stop()}}),u,this,[[1,7]])}t.showUserRequested=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.watchSync=d;var n=r(4),a=r(2),o=r(3),s=r(1),c=regeneratorRuntime.mark(d),u=6e4,i=!1;function d(){var e,t,r,d,f,l,p,v,h,_,g,S,m,b,y,E,O,R,k;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=3,(0,a.delay)(u);case 3:return e=void 0,e="mini-session",c.next=7,(0,n.getItem)(e);case 7:if(!(t=c.sent)||!t.token){c.next=59;break}return c.prev=9,c.next=12,(0,a.select)((function(e){return e.conversationReducer}));case 12:return r=c.sent,d=r.maxLatestReceivedMessageId,f=r.maxLatestTimestampNano,c.next=17,(0,a.select)(s.isSubAccountSelector);case 17:return l=c.sent,c.next=20,(0,a.select)(s.filterSelector);case 20:return p=c.sent.toLowerCase(),v=!l&&["all","unread"].includes(p),h=["pinned","unread"].includes(p),_={},v?_.last_timestamp_nano=f:_.last_message_id=d,_.last_unread_count_sync=i,c.next=28,(0,a.fork)(o.fetch,{method:"POST",resource:"user",suffix:"sync",params:_});case 28:return g=c.sent,c.next=31,(0,a.join)(g);case 31:if(S=c.sent,m=S.have_new_msg,b=S.unread_count,y=S.current_version,i=!1,!m){c.next=45;break}return c.next=39,(0,a.select)((function(e){return e.conversationReducer}));case 39:if(E=c.sent,O=E.syncFetchException,c.t0=O<3&&!h,!c.t0){c.next=45;break}return c.next=45,(0,a.put)((0,s.fetchConversationsRequested)({direction:"latest",triggerBySync:!0}));case 45:if(!(b>-1)){c.next=54;break}return c.next=48,(0,a.select)(s.totalUnreadConversationsCountSelector);case 48:if((R=c.sent)===b){c.next=53;break}return c.next=52,(0,a.put)((0,s.updateTotalUnreadConversationsCount)({count:b}));case 52:i=!0;case 53:l||(u=R!==b||m?6e4:u>=48e4?48e4:2*u);case 54:y&&y!==t.version&&(k=Object.assign({},t,{version:y}),(0,n.setItem)(e,k)),c.next=59;break;case 57:c.prev=57,c.t1=c.catch(9);case 59:c.next=0;break;case 61:case"end":return c.stop()}}),c,this,[[9,57]])}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateTranslateTips=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var o=(0,r(0).createActions)({UPDATE_TRANSLATE_TIPS:function(e){return{shopId:e.shopId,flag:e.flag}}}).updateTranslateTips;t.updateTranslateTips=o,t.default=a({},o,(function(e,t){var r=t.payload,o=r.shopId,s=r.flag;return n({},e,{translateTips:n({},e.translateTips,a({},o,s))})}))},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.login=t.handleLoginSucceeded=t.connectSocket=t.forceLogoutRequested=t.logoutSucceeded=t.logoutRequested=t.loginSucceeded=t.loginRequested=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.reconnectSocket=k,t.watchLogin=I;var o,s=r(4),c=r(0),u=r(3),i=r(1),d=r(2),f=(o=r(5))&&o.__esModule?o:{default:o},l=r(10);function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var v,h,_=regeneratorRuntime.mark(k),g=regeneratorRuntime.mark(I),S=(0,c.createActions)({LOGIN_REQUESTED:function(){},LOGIN_SUCCEEDED:function(e){return{currentUserId:e.currentUserId,status:e.status}},LOGOUT_REQUESTED:function(){},LOGOUT_SUCCEEDED:function(){},FORCE_LOGOUT_REQUESTED:function(){},CONNECT_SOCKET:function(){return{}}}),m=S.loginRequested,b=S.loginSucceeded,y=S.logoutRequested,E=S.logoutSucceeded,O=S.forceLogoutRequested,R=S.connectSocket;function k(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u.socket.reconnect();case 1:case"end":return e.stop()}}),_,this)}t.loginRequested=m,t.loginSucceeded=b,t.logoutRequested=y,t.logoutSucceeded=E,t.forceLogoutRequested=O,t.connectSocket=R,t.login=h=regeneratorRuntime.mark((function e(){var t,r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,d.call)(u.getTranslation,{locale:(0,s.handleLocale)((0,s.getLanguage)())});case 3:return t=e.sent,e.next=6,(0,d.call)(s.changeLanguage,(0,s.handleLocale)((0,s.getLanguage)()),t);case 6:return e.next=8,(0,d.select)(i.isScChatSelector);case 8:return r=e.sent,n={method:"POST",resource:"login",params:{source:r?"sc":"pcmall"}},(0,s.isVisitingCNSC)()&&(n.parent="cnsc"),e.next=13,(0,d.call)(u.fetch,n);case 13:return a=e.sent,(0,u.papConfig)(a.user.type),(0,u.configTrackerUser)(a.user),e.next=18,(0,d.call)(s.setItem,"mini-session",a);case 18:return e.abrupt("return",a);case 21:return e.prev=21,e.t0=e.catch(0),console.error(e.t0),e.next=26,(0,d.put)((0,i.updateChatEntryStatus)({showEntry:!0}));case 26:case"end":return e.stop()}}),e,this,[[0,21]])})),t.handleLoginSucceeded=v=regeneratorRuntime.mark((function e(t){var r,n,a,o,c,p,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.user,t.token,e.next=3,(0,d.put)((0,i.updateNetworkStatus)({networkStatus:"online"}));case 3:return window.addEventListener("online",(function(){l.store.dispatch((0,i.updateNetworkStatus)({networkStatus:"online"}))})),window.addEventListener("offline",(function(){l.store.dispatch((0,i.updateNetworkStatus)({networkStatus:"offline"}))})),n=r.id,a=r.type,o=r.locale,!("subaccount"===a)&&u.csSocket.connect(),c=null,e.prev=9,e.next=12,(0,d.call)(u.getTranslation,{locale:(0,s.handleLocale)(o)});case 12:c=e.sent,e.next=20;break;case 15:return e.prev=15,e.t0=e.catch(9),e.next=19,(0,d.call)(u.getTranslation,{locale:(0,s.getRuntimeLocale)()});case 19:c=e.sent;case 20:return e.next=22,(0,d.put)((0,i.updateChatEntryStatus)({showEntry:!0}));case 22:return w(r),e.next=25,(0,d.call)(s.changeLanguage,(0,s.handleLocale)(o),c);case 25:return e.next=27,(0,d.call)(s.updateTimeLocale,(0,s.handleLocale)(o,!1));case 27:return p=(0,f.default)("users",r),v=p.entities,e.next=30,(0,d.put)((0,i.updateEntities)({entities:v}));case 30:return u.socket.connect(),e.next=33,(0,d.put)(b({currentUserId:n}));case 33:return e.next=35,(0,d.put)((0,i.getGuideRequested)({userId:n,version:(0,s.getRuntimeVersion)()}));case 35:(0,u.clearApiCache)();case 36:case"end":return e.stop()}}),e,this,[[9,15]])}));var x=(0,s.getBrowserInfo)(),w=function(e){var t=e.id,r=e.name;u.Sentry&&u.Sentry.configureScope((function(e){e.setUser({id:t,name:r,agent:x})}))};function I(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.takeLatest)(m,h);case 2:return e.next=4,(0,d.takeLatest)(y,i.logout);case 4:return e.next=6,(0,d.takeLatest)(O,i.logoutHandler);case 6:return e.next=8,(0,d.takeLatest)(R,k);case 8:case"end":return e.stop()}}),g,this)}t.handleLoginSucceeded=v,t.login=h,t.default=(p(n={},b,(function(e,t){var r=t.payload.currentUserId;return a({},e,{currentUserId:r})})),p(n,E,(function(e){return a({},e,{currentUserId:null,performance:{},closeHangupTips:!1})})),n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logout=t.logoutHandler=void 0;var n,a=r(2),o=r(3),s=((n=r(14))&&n.__esModule,r(1)),c=r(4),u=r(10),i=t.logoutHandler=regeneratorRuntime.mark((function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&o.socket.close(),e.next=3,(0,a.put)((0,s.logoutSucceeded)());case 3:return e.next=5,(0,a.put)((0,s.reduxReset)());case 5:return e.next=7,(0,a.put)((0,s.removeAllDraft)());case 7:(0,c.removeItem)("mini-session"),(0,c.removeItem)("mini-sc_redirect");case 9:case"end":return e.stop()}}),e,this)}));t.logout=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(){window.removeEventListener("online",(function(){u.store.dispatch((0,s.updateNetworkStatus)({networkStatus:"online"}))})),window.removeEventListener("offline",(function(){u.store.dispatch((0,s.updateNetworkStatus)({networkStatus:"offline"}))}))},e.prev=1,e.next=4,(0,a.call)(o.fetch,{method:"DELETE",resource:"session"});case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:return t(),e.next=11,(0,a.call)(i);case 11:case"end":return e.stop()}}),e,this,[[1,6]])}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(88);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(89);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o=r(90);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCrmPreviewParams=function(e){var t=e.crm_message_preview,r=void 0===t?{}:t;return r.text?{crm_message_preview:r}:{crm_message_preview:{}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.listsHashSelector=t.currentConversationTranslationAccessSelector=t.currentBuyerShopIdSelector=t.currentBuyerSelector=t.currentShopIdSelector=t.currentBuyerIdSelector=t.getConversations=t.getConversation=t.hasViewVoucherAccessSelector=t.currentConversationShopSelectors=t.currentConversationSelector=t.keywordSelector=t.sortedConversationsSelector=t.filteredConversationsSelector=t.filterSelector=t.closedConversationsSelector=t.pinnedConversationsSelector=t.unreadConversationsSelector=t.conversationsSelector=t.conversationDirectionSelector=t.searchConversationHttpStatusSelector=t.resultsSelector=t.conversationHttpStatusSelector=t.currentConversationCanReadSelector=t.missedReadNoticeCountSelector=t.readRequestIdsSelector=t.currentConversationIdSelector=t.conversationIdsMapSelector=t.conversationIdsSelector=void 0;var n=r(1),a=r(7),o=r(6),s=r(5),c=t.conversationIdsSelector=function(e){return e.conversationReducer.conversationIds},u=(t.conversationIdsMapSelector=function(e){return e.conversationReducer.conversationIdsMap},t.currentConversationIdSelector=function(e){return e.conversationReducer.currentConversationId}),i=(t.readRequestIdsSelector=function(e){return e.conversationReducer.readRequestIds},t.missedReadNoticeCountSelector=function(e){return e.conversationReducer.missedReadNoticeCount},t.currentConversationCanReadSelector=function(e){return e.conversationReducer.currentConversationCanRead},t.conversationHttpStatusSelector=function(e){return e.conversationReducer.status},t.resultsSelector=function(e){return e.conversationReducer.results},t.searchConversationHttpStatusSelector=function(e){return e.conversationReducer.searchStatus},t.conversationDirectionSelector=function(e){return e.conversationReducer.direction},t.conversationsSelector=(0,o.createSelector)(n.conversationEntitiesSelector,c,(function(e,t){return((0,a.denormalize)(t,[s.conversationSchema],{conversations:e})||[]).filter((function(e){return e}))}))),d=t.unreadConversationsSelector=(0,o.createSelector)(i,u,(function(e,t){return e.filter((function(e){var r=e.id,n=e.unread_count;return e&&(n>0||r===t)}))})),f=t.pinnedConversationsSelector=(0,o.createSelector)(i,(function(e){return e.filter((function(e){return e.pinned}))})),l=t.closedConversationsSelector=(0,o.createSelector)(i,(function(e){return e.filter((function(e){return e.status&&"closed"===e.status}))})),p=t.filterSelector=function(e){return e.conversationReducer.filter},v=t.filteredConversationsSelector=(0,o.createSelector)(p,i,d,f,l,(function(e,t,r,n,a){return{All:t,Unread:r,Pinned:n,Closed:a}[e]})),h=(t.sortedConversationsSelector=(0,o.createSelector)(v,(function(e){return e.sort((function(e,t){return t.latest_message_id-e.latest_message_id})).filter((function(e){return!e.faking}))})),t.keywordSelector=function(e){return e.conversationReducer.keyword},t.currentConversationSelector=(0,o.createSelector)(i,u,(function(e,t){return e.find((function(e){return e.id===t}))||{}})));t.currentConversationShopSelectors=(0,o.createSelector)(h,(function(e){return e.shop||{}})),t.hasViewVoucherAccessSelector=(0,o.createSelector)(h,(function(e){return e.hasViewVoucherAccess||!1})),t.getConversation=function(e){return(0,o.createSelector)(i,(function(t){return t.find((function(t){return t.id===e}))||{}}))},t.getConversations=function(e){return(0,o.createSelector)(i,(function(t){return e.map((function(e){return t.find((function(t){return t.id===e}))})).filter((function(e){return e}))}))},t.currentBuyerIdSelector=(0,o.createSelector)(h,(function(e){return(e||{}).to_id||null})),t.currentShopIdSelector=(0,o.createSelector)(h,(function(e){return(e||{}).shop_id||null})),t.currentBuyerSelector=(0,o.createSelector)(n.userEntitiesSelector,h,(function(e,t){return t?(0,a.denormalize)(t.to_id,s.userSchema,{users:e}):{}})),t.currentBuyerShopIdSelector=(0,o.createSelector)(h,(function(e){return(e||{}).to_shop_id||null})),t.currentConversationTranslationAccessSelector=(0,o.createSelector)(h,(function(e){return e.translationAccess})),t.listsHashSelector=function(e){return e.conversationReducer.listsHash}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.conversationReducer=t.watchConversationSagas=t.pinConversationRequested=t.updateConversationFilter=t.getConversationDetailRequested=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(22);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o=r(91);Object.defineProperty(t,"getConversationDetailRequested",{enumerable:!0,get:function(){return o.getConversationDetailRequested}});var s=r(92);Object.defineProperty(t,"updateConversationFilter",{enumerable:!0,get:function(){return s.updateConversationFilter}});var c=r(93);Object.defineProperty(t,"pinConversationRequested",{enumerable:!0,get:function(){return c.pinConversationRequested}});var u=r(94);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})}));var i=r(95);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})}));var d=r(96);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}})}));var f=r(97);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})}));var l=r(23);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})}));var p=r(98);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}})}));var v=r(99);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}})}));var h=r(100);Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}})}));var _=r(0),g=k(a),S=k(d),m=k(s),b=k(f),y=k(u),E=k(v),O=k(l),R=k(h);function k(e){return e&&e.__esModule?e:{default:e}}t.watchConversationSagas=[a.watchDelete,d.watchShowConversation,c.watchPin,v.watchMark,i.watchChangeStatus,f.watchFetchConversation,o.watchDetail,h.watchSearch],t.conversationReducer=(0,_.handleActions)(n({},g.default,S.default,m.default,y.default,b.default,O.default,E.default,R.default),{conversationIds:[],conversationIdsMap:{},latestTimestamp:-1,oldestTimestamp:-1,maxLatestTimestampNano:"",latestTimestampNano:"",oldestTimestampNano:"",oldestReceivedMessageId:"",latestReceivedMessageId:"",maxLatestReceivedMessageId:"",currentConversationId:null,currentConversationCanRead:!0,filter:"All",keyword:"",draftHash:{},status:"",hasMore:!0,persist:null,results:[],direction:"",listsHash:"",searchStatus:"",syncFetchException:0,conversationMark:{},readRequestIds:[],missedReadNoticeCount:0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getConversationDetailRequested=void 0,t.watchDetail=p;var n,a=r(0),o=r(2),s=(n=r(5))&&n.__esModule?n:{default:n},c=r(3),u=r(1),i=regeneratorRuntime.mark(l),d=regeneratorRuntime.mark(p),f=(0,a.createActions)({GET_CONVERSATION_DETAIL_REQUESTED:function(e){return{conversationId:e.conversationId,shopId:e.shopId,needRead:e.needRead}}}).getConversationDetailRequested;function l(e){var t,r,n,a,d,f,l,p,v,h,_,g=e.payload,S=g.conversationId,m=g.shopId,b=g.needRead;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,o.call)(c.fetch,{resource:"conversations",id:S,params:{shop_id:m}});case 3:return t=e.sent,e.next=6,(0,o.select)((0,u.getConversation)(S));case 6:if(r=e.sent,n=r.id,a=r.unread_count,d=t.flag,f=t.entry_point,l=t.unread_count,p=t.latest_message_id,v=t.shop_id,n){e.next=15;break}return h=(0,s.default)("conversations",t),_=h.entities,e.next=13,(0,o.put)((0,u.updateEntities)({entities:_}));case 13:e.next=17;break;case 15:return e.next=17,(0,o.put)((0,u.updateRecord)({name:"conversations",id:S,record:{flag:d,entry_point:f,unread_count:l}}));case 17:if(a||a===t.unread_count){e.next=20;break}return e.next=20,(0,o.put)((0,u.updateUnreadCount)({conversation:t,type:u.unreadCountActions.ACTIVE_CONVERSATION}));case 20:if(!b){e.next=24;break}if(!(l>0)){e.next=24;break}return e.next=24,(0,o.put)((0,u.markMessagesRequested)({conversationId:S,isRead:!0,latestMessageId:p,shopId:v}));case 24:return e.abrupt("return",t);case 27:return e.prev=27,e.t0=e.catch(0),e.abrupt("return",{});case 30:case"end":return e.stop()}}),i,this,[[0,27]])}function p(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.takeEvery)(f,l);case 2:case"end":return e.stop()}}),d,this)}t.getConversationDetailRequested=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateConversationFilter=void 0;var n,a,o,s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=(0,r(0).createActions)({UPDATE_CONVERSATION_FILTER:function(e){return{filter:e.filter}}}).updateConversationFilter;t.updateConversationFilter=c,t.default=(o=function(e,t){var r=t.payload.filter;return s({},e,{filter:r})},(a=c)in(n={})?Object.defineProperty(n,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[a]=o,n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pinConversationRequested=void 0,t.watchPin=f;var n=r(0),a=r(2),o=r(3),s=r(1),c=regeneratorRuntime.mark(d),u=regeneratorRuntime.mark(f),i=(0,n.createActions)({PIN_CONVERSATION_REQUESTED:function(e){return{conversationId:e.conversationId,shopId:e.shopId,isPinned:e.isPinned}}}).pinConversationRequested;function d(e){var t,r=e.payload,n=r.conversationId,u=r.shopId,i=r.isPinned;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={method:"PUT",parent:"conversations",parentId:n,resource:i?"unpin":"pin"},u&&(t.payload=JSON.stringify({shop_id:u})),e.next=5,(0,a.call)(o.fetch,t);case 5:e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(0),e.next=11,(0,a.put)((0,s.showOperationFailureToastRequested)({error:e.t0}));case 11:case"end":return e.stop()}}),c,this,[[0,7]])}function f(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.takeEvery)(i,d);case 2:case"end":return e.stop()}}),u,this)}t.pinConversationRequested=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setCurrentConversationCanRead=void 0;var n,a,o,s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=(0,r(0).createActions)({SET_CURRENT_CONVERSATION_CAN_READ:function(e){return{canRead:e.canRead}}}).setCurrentConversationCanRead;t.setCurrentConversationCanRead=c,t.default=(o=function(e,t){var r=t.payload.canRead;return s({},e,{currentConversationCanRead:r})},(a=c)in(n={})?Object.defineProperty(n,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[a]=o,n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changeConversationStatusRequested=void 0,t.watchChangeStatus=f,r(10);var n=r(0),a=r(2),o=r(3),s=(r(4),r(1)),c=regeneratorRuntime.mark(d),u=regeneratorRuntime.mark(f),i=(0,n.createActions)({CHANGE_CONVERSATION_STATUS_REQUESTED:function(e){return{conversationId:e.conversationId,shopId:e.shopId,status:e.status}}}).changeConversationStatusRequested;function d(e){var t=e.payload,r=t.conversationId,n=t.shopId,u=t.status;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,a.call)(o.fetch,{method:"PUT",resource:"conversations",id:r,suffix:"status",payload:JSON.stringify({shop_id:n,status:u})});case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),e.next=9,(0,a.put)((0,s.showOperationFailureToastRequested)({error:e.t0}));case 9:case"end":return e.stop()}}),c,this,[[0,5]])}function f(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.takeEvery)(i,d);case 2:case"end":return e.stop()}}),u,this)}t.changeConversationStatusRequested=i},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.resetConversationRequested=t.showConversationRequested=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.showConversationRequestedSaga=b,t.watchShowConversation=E;var o=r(0),s=r(1),c=r(2);function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=regeneratorRuntime.mark(b),d=regeneratorRuntime.mark(y),f=regeneratorRuntime.mark(E),l={hasSCAccess:"login_sellercenter",hasEditOrderAccess:"webchat_order_edit",hasViewOrderAccess:"access_my_sale",hasViewProductAccess:"access_my_product",hasEditVoucherAccess:"my_marketing_voucher_edit",hasViewVoucherAccess:"my_marketing_voucher_access"},p=function(e){var t={},r=e.length;return Object.keys(l).forEach((function(n){t[n]=!r||e.includes(l[n])})),t},v=(0,o.createActions)({SHOW_CONVERSATION_REQUESTED:function(e){return{conversation:e.conversation,refresh:e.refresh,read:e.read,previousId:e.previousId,messageId:e.messageId}},RESET_CONVERSATION_REQUESTED:function(){return{}}}),h=v.showConversationRequested,_=v.resetConversationRequested;t.showConversationRequested=h,t.resetConversationRequested=_;var g=(0,o.createActions)({SHOW_CONVERSATION_SUCCEEDED:function(e){var t=e.conversationId,r=e.previousId;return{conversationId:t,previousId:void 0===r?null:r}},RESET_CONVERSATION_SUCCEEDED:function(){return{}}}),S=g.showConversationSucceeded,m=g.resetConversationSucceeded;function b(e){var t,r,n,o,u,d,f,l,v,h,_,g,m,b,y,E,O,R,k,x,w=e.payload,I=w.conversation,T=w.refresh,C=w.read,P=w.previousId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,c.select)(s.isSubAccountSelector);case 3:return t=e.sent,r=I.faking,n=I.status,o=I.to_id,u=I.shop_id,d=I.id,f=I.latest_message_id,l=I.to_shop_id,v=I.unread_count,e.next=7,(0,c.put)((0,s.showUserRequested)({userId:o,shopId:u,buyerShopId:l}));case 7:return e.next=9,(0,c.put)(S({conversationId:d,previousId:P}));case 9:return e.next=11,(0,c.call)(s.handleCurrentConversationChange,d);case 11:if(h=e.sent,!T){e.next=17;break}return e.next=15,(0,c.put)((0,s.fetchMessagesRequested)({conversation:I,reset:!0}));case 15:e.next=25;break;case 17:return e.next=19,(0,c.select)((function(e){return e.messageReducer}));case 19:if(_=e.sent,g=_.messageIdsHash,m=g[d]||{},!((void 0===(b=m.all)?[]:b).length<20)){e.next=25;break}return e.next=25,(0,c.put)((0,s.fetchMessagesRequested)({conversation:I}));case 25:if(!(!r&&C&&"closed"!==n&&v>0||h)){e.next=30;break}return y=h||f,e.next=30,(0,c.put)((0,s.markMessagesRequested)({conversationId:d,isRead:!0,latestMessageId:y,shopId:u}));case 30:if(E={},O=null,!t){e.next=41;break}return e.next=35,(0,c.call)(s.fetchShopAuth,(0,s.fetchShopAuthRequested)({shopId:u}));case 35:R=e.sent,k=R.auth_names,O=p(void 0===k?[]:k),e.next=42;break;case 41:O=p([]);case 42:return e.next=44,(0,c.select)((0,s.shopSelector)(u));case 44:if(E=e.sent){e.next=49;break}return e.next=48,(0,c.call)(s.showShop,{payload:{shopId:u}});case 48:E=e.sent;case 49:return e.next=51,(0,c.put)((0,s.updateRecord)({name:"conversations",id:d,record:a({shop:E},O)}));case 51:if(!E){e.next=55;break}return x=(E.country||"").toLowerCase(),e.next=55,(0,c.spawn)(s.fetchStickersRequestedSaga,{payload:{region:x}});case 55:e.next=60;break;case 57:e.prev=57,e.t0=e.catch(0),console.log("*** Show Conversation Failed: ",e.t0);case 60:case"end":return e.stop()}}),i,this,[[0,57]])}function y(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.put)(m());case 2:case"end":return e.stop()}}),d,this)}function E(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.takeLatest)(h,b);case 2:return e.next=4,(0,c.takeLatest)(_,y);case 4:case"end":return e.stop()}}),f,this)}t.default=(u(n={},S,(function(e,t){var r=t.payload,n=r.conversationId;return r.previousId,a({},e,{currentConversationId:n})})),u(n,m,(function(e){return a({},e,{currentConversationId:null})})),n)},function(e,t,r){"use strict";(function(e){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.updateConversationTimestamp=t.updateFetchConversationsDirection=t.updateFetchConversationsStatus=t.fetchConversationsSucceeded=t.fetchConversationsRequested=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var s,c=e[Symbol.iterator]();!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};t.fetchConversationsRequestedSaga=k,t.watchFetchConversation=x;var s=r(3),c=r(4),u=r(0),i=r(2),d=r(1);function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var l=regeneratorRuntime.mark(k),p=regeneratorRuntime.mark(x);function v(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var h=(0,u.createActions)({FETCH_CONVERSATIONS_REQUESTED:function(e){var t=e.direction,r=void 0===t?"reset":t,n=e.noPending,a=void 0!==n&&n,o=e.triggerBySync,s=e.shopId;return{direction:r,noPending:a,triggerBySync:o,shopId:void 0===s?null:s}},FETCH_CONVERSATIONS_SUCCEEDED:function(e){var t=e.conversationIds,r=e.conversationIdsMap,n=e.oldestReceivedMessageId,a=e.latestReceivedMessageId,o=e.oldestTimestampNano,s=e.latestTimestampNano,c=e.direction;return{conversationIds:t,conversationIdsMap:r,oldestReceivedMessageId:n,latestReceivedMessageId:a,direction:void 0===c?"reset":c,status:e.status,hasMore:e.hasMore,latestTimestampNano:s,oldestTimestampNano:o,persist:e.persist,shouldFetchByTimestamp:e.shouldFetchByTimestamp,maxLatestTimestampNano:e.maxLatestTimestampNano,maxLatestReceivedMessageId:e.maxLatestReceivedMessageId,syncFetchException:e.syncFetchException}},UPDATE_FETCH_CONVERSATIONS_STATUS:function(e){return{status:e.status}},UPDATE_FETCH_CONVERSATIONS_DIRECTION:function(e){return{direction:e.direction}},UPDATE_CONVERSATION_TIMESTAMP:function(e){return{latestTimestampNano:e.latestTimestampNano,oldestTimestampNano:e.oldestTimestampNano}}}),_=h.fetchConversationsRequested,g=h.fetchConversationsSucceeded,S=h.updateFetchConversationsStatus,m=h.updateFetchConversationsDirection,b=h.updateConversationTimestamp;t.fetchConversationsRequested=_,t.fetchConversationsSucceeded=g,t.updateFetchConversationsStatus=S,t.updateFetchConversationsDirection=m,t.updateConversationTimestamp=b;var y=function(e,t,r,n,a){var o={},c="older"===e?t:"latest"===e?r:"";return o.resource="pinned"===n?"conversation/list":"conversations",o.params={next_timestamp_nano:c,direction:"latest"===e&&c?"latest":"older"},"unread"===n&&(o.params.unread_only=!0),"pinned"===n&&(o.params.type=n),new Promise((function(e,t){(0,s.fetch)(o).then((function(t){var r=t.conversations,n=void 0===r?[]:r,a=t.page_result;e([n,void 0===a?{}:a])})).catch((function(e){t(e)}))}))},E=function(e,t,r,n,a,o,c){var u="older"===t?r:"latest"===t?n:"",i={direction:"latest"===t?"latest":"older"};if(u&&(i.last_received_message_id=u),o)return e&&(i.shop_id=e),a&&["unread","pinned"].includes(a)&&(i.type=a),new Promise((function(e,t){(0,s.fetch)({parent:"subaccount",resource:"conversations",params:i}).then((function(t){var r=t.conversations;e(void 0===r?[]:r)})).catch((function(e){t(e)}))}))},O=function(e){return new Promise((function(t){(0,s.fetch)({parent:"setting",resource:"auto_translations",params:{shop_ids:JSON.stringify(e)}}).then((function(e){var r=e.auto_translations;t(void 0===r?[]:r)})).catch((function(){t([])}))}))},R=function(e,t){e.sort((function(e,t){return t.latest_message_id-e.latest_message_id}));var r=e[0],n=r.last_message_time_nano,a=r.next_timestamp_nano;return t&&!a&&(a=t.next_message_time_nano),{nextTimestampNano:a,oldestTimestampNano:a,latestTimestampNano:n}};function k(t){var r,n,s,u,f,p,h,m,b,k,x,w,I,T,C,P,M,j,A,N,D,U,L,q,F,G,H,V,B,W,Q,Y,K,J,z,X,Z,$,ee,te,re,ne,ae,oe,se,ce,ue,ie,de,fe,le,pe,ve=t.payload,he=ve.direction,_e=ve.noPending,ge=ve.triggerBySync,Se=ve.shopId;return ve.source,regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,i.select)(d.isScChatSelector);case 2:return r=t.sent,t.next=5,(0,i.select)(d.isSubAccountSelector);case 5:return n=t.sent,t.next=8,(0,i.select)(d.filterSelector);case 8:if(s=t.sent.toLowerCase(),u=!n,"reset"!==he){t.next=13;break}return t.next=13,(0,i.put)(g({conversationIds:[],oldestReceivedMessageId:"",latestReceivedMessageId:"",maxLatestReceivedMessageId:"",oldestTimestampNano:"",latestTimestampNano:"",maxLatestTimestampNano:"",direction:"reset",hasMore:!0,status:c.HttpStatus.SUCCEED,persist:null,shouldFetchByTimestamp:u}));case 13:return t.next=15,(0,i.select)((function(e){return e.conversationReducer}));case 15:if(f=t.sent,p=f.oldestTimestampNano,h=f.latestTimestampNano,m=f.maxLatestTimestampNano,b=f.oldestReceivedMessageId,k=f.latestReceivedMessageId,x=f.maxLatestReceivedMessageId,w=f.hasMore,I=f.persist,T=f.conversationIds,C=f.status,P=f.syncFetchException,M=f.currentConversationId,j="reset"===he||(u?!p:!b)&&"older"===he,t.prev=29,"older"===he&&(u?"0"===p:!w)){t.next=145;break}if(_e){t.next=34;break}return t.next=34,(0,i.put)(S({status:j?c.HttpStatus.INIT_PENDING:c.HttpStatus.PENDING}));case 34:if(A=[],N={},!u){t.next=45;break}return t.next=39,(0,i.call)(y,he,p,h,s);case 39:D=t.sent,U=o(D,2),A=U[0],N=U[1],t.next=48;break;case 45:return t.next=47,(0,i.call)(E,Se,he,b,k,s,n);case 47:A=t.sent;case 48:if(!(L=A.length)){t.next=141;break}if(A=A.map((function(t){return"censored_blacklist"===t.last_message_state?a({},t,{latestMessage:{type:"text",content:{text:e("common.blacklist.replaced_text")},created_at:t.last_message_time}}):t})),!("reset"!==he||u&&"pinned"!==s)){t.next=63;break}if(q=A[L-1],F="older"===he,G=void 0,H=void 0,u?(G=F?p:h,H=F?q.next_timestamp_nano:q.last_message_time_nano):(G=F?b:k,H=q.latest_message_id),!G||!H){t.next=63;break}if(F?H<G:H>G){t.next=63;break}return t.next=62,(0,i.put)(g({direction:he,status:c.HttpStatus.SUCCEED,hasMore:"latest"===he,persist:I,oldestReceivedMessageId:b,latestReceivedMessageId:k,maxLatestReceivedMessageId:k,conversationIds:T,oldestTimestampNano:p,latestTimestampNano:h,maxLatestTimestampNano:h,shouldFetchByTimestamp:u}));case 62:return t.abrupt("return");case 63:if(r||n){t.next=73;break}return t.next=66,(0,i.select)(d.autoTranslation);case 66:if("enabled"===t.sent){t.next=73;break}return V=Array.from(new Set(A.map((function(e){return e.to_shop_id})))),t.next=71,(0,i.call)(O,V);case 71:B=t.sent,A=A.map((function(e){var t=B.find((function(t){return t.shop_id===e.to_shop_id}));return a({},e,{translationAccess:!!t&&t.is_auto_translation})}));case 73:if(W={},A.forEach((function(e){W[e.id]=!0})),Q={status:c.HttpStatus.SUCCEED,direction:he,conversationIdsMap:W,shouldFetchByTimestamp:u},Y=R(A,N.next_cursor),!u){t.next=92;break}return K=Y.oldestTimestampNano,J=Y.latestTimestampNano,t.next=81,(0,i.select)((function(e){return e.conversationReducer}));case 81:return z=t.sent,X=z.conversationIds,Z=z.persist,t.next=86,(0,i.call)(d.saveToStore,A,X,Z,he);case 86:$=t.sent,ee=$.persistObj,te=$.resultConversationIds,Q=Object.assign({},Q,{oldestTimestampNano:K,latestTimestampNano:J,persist:ee,conversationIds:te,maxLatestTimestampNano:!m||m<J?J:m}),t.next=110;break;case 92:if(re=new Date(A[0].last_message_time).getTime()/1e3,ne=[],!n){t.next=104;break}return ae=[],t.next=98,(0,i.select)(d.fetchedShopIdsSelector);case 98:if(oe=t.sent,A.forEach((function(e){!oe.includes(e.shop_id)&&ae.push(e.shop_id)})),!ae.length){t.next=104;break}return t.next=103,(0,i.call)(d.fetchShopsByIds,{shopIds:[].concat(v(new Set(ae)))});case 103:ne=t.sent;case 104:return t.next=106,(0,i.call)(d.saveToStore,A,T,I,he,ne);case 106:se=t.sent,ce=A[0].latest_message_id,ue=A[L-1].latest_message_id,Q=Object.assign({},Q,{hasMore:!0,latestTimestamp:re,conversationIdsMap:W,persist:se.persistObj,oldestReceivedMessageId:ue,latestReceivedMessageId:ce,maxLatestReceivedMessageId:!x||x<ce?ce:x,conversationIds:se.resultConversationIds});case 110:if(!ge){t.next=121;break}if(!M||!W[M]){t.next=121;break}return ie=A.find((function(e){return e.id===M})),de=(ie||{}).latest_message_id,t.next=116,(0,i.select)(d.messagesWithSourceSelector);case 116:if(fe=t.sent,le=fe.length?fe[fe.length-1].id:"",de===le){t.next=121;break}return t.next=121,(0,i.put)((0,d.fetchMessagesRequested)({conversation:ie,reset:!0}));case 121:return t.next=123,(0,i.put)(g(Q));case 123:if("latest"!==he){t.next=136;break}if(!u){t.next=132;break}if(pe=Y.nextTimestampNano,t.t0="0"!==pe,!t.t0){t.next=130;break}return t.next=130,(0,i.put)(_({direction:he,noPending:!0}));case 130:t.next=134;break;case 132:return t.next=134,(0,i.put)(_({direction:he,noPending:!0}));case 134:t.next=139;break;case 136:if(!(Q.conversationIds.length<=20)){t.next=139;break}return t.next=139,(0,i.put)(_({direction:"older",noPending:!0}));case 139:t.next=143;break;case 141:return t.next=143,(0,i.put)(g({direction:he,status:c.HttpStatus.SUCCEED,hasMore:"latest"===he,persist:I,oldestReceivedMessageId:b,latestReceivedMessageId:k,maxLatestReceivedMessageId:x,conversationIds:T,oldestTimestampNano:p,latestTimestampNano:h,maxLatestTimestampNano:m,shouldFetchByTimestamp:u,syncFetchException:ge?P+1:0}));case 143:t.next=148;break;case 145:if(C===c.HttpStatus.INIT_FAILED){t.next=148;break}return t.next=148,(0,i.put)(S({status:c.HttpStatus.SUCCEED}));case 148:t.next=154;break;case 150:return t.prev=150,t.t1=t.catch(29),t.next=154,(0,i.put)(S({status:j?c.HttpStatus.INIT_FAILED:c.HttpStatus.FAILED}));case 154:case"end":return t.stop()}}),l,this,[[29,150]])}function x(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.takeEvery)(_,k);case 2:case"end":return e.stop()}}),p,this)}t.default=(f(n={},g,(function(e,t){var r=t.payload,n=r.conversationIds,o=r.conversationIdsMap,s=void 0===o?{}:o,c=r.oldestReceivedMessageId,u=r.latestReceivedMessageId,i=r.direction,d=void 0===i?"reset":i,f=r.status,l=r.hasMore,p=r.latestTimestamp,v=void 0===p?-1:p,h=r.oldestTimestampNano,_=r.latestTimestampNano,g=r.persist,S=r.shouldFetchByTimestamp,m=r.maxLatestReceivedMessageId,b=r.maxLatestTimestampNano,y=r.syncFetchException,E=void 0===y?0:y,O=a({},e,{status:f,hasMore:l,persist:g,conversationIds:n,conversationIdsMap:"reset"===d?s:a({},e.conversationIdsMap,s),latestTimestamp:v>e.latestTimestamp?v:e.latestTimestamp,direction:"latest"===d?d:"older",maxLatestReceivedMessageId:m,maxLatestTimestampNano:b,syncFetchException:E});switch(d){case"reset":S?(O.latestTimestampNano=_,O.oldestTimestampNano=h):(O.oldestReceivedMessageId=c,O.latestReceivedMessageId=u);break;case"latest":S?O.latestTimestampNano=_>e.latestTimestampNano?_:e.latestTimestampNano:O.latestReceivedMessageId=u;break;case"older":S?O.oldestTimestampNano=h:O.oldestReceivedMessageId=c}return O})),f(n,S,(function(e,t){var r=t.payload.status;return a({},e,{status:r})})),f(n,m,(function(e,t){var r=t.payload.direction;return a({},e,{direction:r})})),f(n,b,(function(e,t){var r=t.payload,n=r.latestTimestampNano,o=r.oldestTimestampNano;return a({},e,{latestTimestampNano:n,oldestTimestampNano:o})})),n)}).call(this,r(8).t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.saveToStore=f;var n,a=r(2),o=(n=r(5))&&n.__esModule?n:{default:n},s=r(4),c=r(3),u=r(1),i=regeneratorRuntime.mark(f);function d(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function f(e,t,r,n,f){var l,p,v,h,_,g,S,m,b,y,E,O,R,k,x;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return l=(0,o.default)("conversations",e),i.t0=u.currentConversationSelector,i.next=4,(0,a.select)((function(e){return e}));case 4:return i.t1=i.sent,p=(0,i.t0)(i.t1),i.next=8,(0,a.select)((function(e){return e.entityReducer}));case 8:return v=i.sent,h=v.conversations,_=void 0===h?{}:h,g=v.shops,S=void 0===g?{}:g,m=[],p&&p.faking?(b=p.id,m=(0,c.getConversationIds)(t,l.result,n,b)):m=(0,c.getConversationIds)(t,l.result,n),y=m.length<s.persistLimit?null:[].concat(d(m)).splice(0,s.persistLimit),i.next=18,(0,a.put)((0,u.updateEntities)({entities:{persist:y}}));case 18:return i.next=20,(0,a.call)(c.updateOrReplaceAction,_,e,"conversations");case 20:if(!(E=f&&f.length)){i.next=26;break}return i.next=24,(0,a.call)(c.updateOrReplaceAction,S,f,"shops");case 24:return i.next=26,(0,a.put)((0,u.updateFetchedShopIds)({shopIds:f.map((function(e){return e.id}))}));case 26:return i.next=28,(0,a.put)((0,u.updateConversationListsHash)());case 28:if(!(O=(0,c.generatePersist)(y,r,t))||!O.changed){i.next=43;break}if(R=void 0,k=O.lastConversationId,"older"!==n&&"reset"!==n){i.next=36;break}R=l.entities.conversations[k],i.next=42;break;case 36:return i.t2=u.conversationsSelector,i.next=39,(0,a.select)((function(e){return e}));case 39:i.t3=i.sent,x=(0,i.t2)(i.t3),R=x.find((function(e){return e.id===k}));case 42:R&&(E?O.oldestReceivedMessageId=R.latest_message_id:O.oldestTimestampNano=R.last_msg_time_nano);case 43:return i.abrupt("return",{persistObj:O,resultConversationIds:m});case 44:case"end":return i.stop()}}),i,this)}},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.updateReadRequestData=t.markMessagesSucceed=t.markMessagesRequested=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.markMessagesRequestedSaga=_,t.watchMark=g;var o=r(0),s=r(2),c=r(3),u=r(1);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var d=regeneratorRuntime.mark(_),f=regeneratorRuntime.mark(g),l=(0,o.createActions)({MARK_MESSAGES_REQUESTED:function(e){return{conversationId:e.conversationId,isRead:e.isRead,latestMessageId:e.latestMessageId,shopId:e.shopId}},MARK_MESSAGES_SUCCEED:function(e){return{conversationId:e.conversationId,markType:e.markType}},UPDATE_READ_REQUEST_DATA:function(e){return{requestId:e.requestId,requestIds:e.requestIds,count:e.count}}}),p=l.markMessagesRequested,v=l.markMessagesSucceed,h=l.updateReadRequestData;function _(e){var t,r,n,o,i,f,l,p,_=e.payload,g=_.conversationId,S=_.isRead,m=_.latestMessageId,b=_.shopId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=Date.now()+"",r=S?"read":"unread",n=S?{last_read_message_id:m}:{},b&&(n.shop_id=b),e.t0=S,!e.t0){e.next=9;break}return e.next=9,(0,s.put)(h({requestId:t}));case 9:return e.next=11,(0,s.call)(c.fetch,{method:"PUT",parent:"conversations",parentId:g,resource:r,params:{request_id:t},payload:JSON.stringify(a({},n))});case 11:if(!S){e.next=29;break}return e.next=14,(0,s.select)((function(e){return e.conversationReducer}));case 14:return o=e.sent,i=o.conversationMark,f="socket"===i[g],e.next=19,(0,s.put)(v({conversationId:g,markType:f?"":"api"}));case 19:if(f){e.next=29;break}return e.next=22,(0,s.select)((0,u.getConversation)(g));case 22:if(l=e.sent,!(p=l.unread_count)){e.next=29;break}return e.next=27,(0,s.put)((0,u.updateRecord)({name:"conversations",id:g,record:{last_read_message_id:m,unread_count:0}}));case 27:return e.next=29,(0,s.put)((0,u.updateUnreadCount)({type:u.unreadCountActions.MARK_AS_READ,conversation:{id:g,shop_id:b,unread_count:p}}));case 29:e.next=35;break;case 31:return e.prev=31,e.t1=e.catch(0),e.next=35,(0,s.put)((0,u.showOperationFailureToastRequested)({error:e.t1}));case 35:case"end":return e.stop()}}),d,this,[[0,31]])}function g(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.takeEvery)(p,_);case 2:case"end":return e.stop()}}),f,this)}t.markMessagesRequested=p,t.markMessagesSucceed=v,t.updateReadRequestData=h,t.default=(i(n={},v,(function(e,t){var r=t.payload,n=r.conversationId,o=r.markType;return a({},e,{conversationMark:a({},e.conversationMark,i({},n,o))})})),i(n,h,(function(e,t){var r=t.payload,n=r.requestId,o=r.requestIds,s=r.count,c=a({},e);return n&&(c.readRequestIds=[n].concat(e.readRequestIds)),o&&(c.readRequestIds=o),s&&(c.missedReadNoticeCount=s),c})),n)},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.updateSearchParams=t.searchConversationsSucceeded=t.searchConversationsRequested=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.searchConversationsRequestedSaga=_,t.watchSearch=g;var o=r(0),s=r(2),c=r(1),u=r(4);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var d=regeneratorRuntime.mark(_),f=regeneratorRuntime.mark(g),l=(0,o.createActions)({SEARCH_CONVERSATIONS_REQUESTED:function(e){var t=e.keyword,r=void 0===t?"":t,n=e.shopId;return{keyword:r,shopId:void 0===n?"":n}},SEARCH_CONVERSATIONS_SUCCEEDED:function(e){return{results:e.results,searchStatus:e.searchStatus}},UPDATE_SEARCH_PARAMS:function(e){var t=e.keyword;return{keyword:void 0===t?"":t,searchStatus:e.searchStatus}}}),p=l.searchConversationsRequested,v=l.searchConversationsSucceeded,h=l.updateSearchParams;function _(e){var t,r,n,o,i,f=e.payload.keyword;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],r=f.trim(),e.next=4,(0,s.put)(h({keyword:r,searchStatus:u.HttpStatus.INIT_PENDING}));case 4:if(!r){e.next=14;break}return n=r.toLocaleLowerCase(),e.next=8,(0,s.select)((function(e){return e.entityReducer}));case 8:return o=e.sent,i=o.shops,e.next=12,(0,s.select)(c.conversationsSelector);case 12:e.sent.forEach((function(e){(e.to_name||"").toLocaleLowerCase().includes(n)&&!e.faking&&t.push(a({},e,{shop_name:(i[e.shop_id]||{}).name}))}));case 14:return e.next=16,(0,s.put)(v({results:t,searchStatus:u.HttpStatus.SUCCEED}));case 16:case"end":return e.stop()}}),d,this)}function g(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.takeLatest)(p,_);case 2:case"end":return e.stop()}}),f,this)}t.searchConversationsRequested=p,t.searchConversationsSucceeded=v,t.updateSearchParams=h,t.default=(i(n={},v,(function(e,t){var r=t.payload,n=r.results,o=r.searchStatus;return a({},e,{results:n,searchStatus:o})})),i(n,h,(function(e,t){var r=t.payload,n=r.keyword,o=r.searchStatus;return a({},e,{keyword:n,searchStatus:o})})),n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(102);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(103);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.allStickersArraySelector=t.stickerHttpStatusSelector=t.stickersSelector=t.packHttpStatusSelector=t.currentStickerPageSelector=t.currentStickerSelector=t.packsSelector=t.allStickersSelector=t.packHttpStatusSelectors=t.regionStickerSelectors=t.stickerReducerSelectors=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(7),o=r(6),s=r(1),c=r(5),u=t.stickerReducerSelectors=function(e){return e.stickerReducer},i=t.regionStickerSelectors=(0,o.createSelector)(u,s.currentConversationShopSelectors,(function(e,t){var r=t.country;return e[r=(r||"").toLowerCase()]||{}})),d=(t.packHttpStatusSelectors=(0,o.createSelector)(i,(function(e){return e.packHttpStatus||""})),t.allStickersSelector=(0,o.createSelector)(i,(function(e){return e.stickers||{}}))),f=t.packsSelector=(0,o.createSelector)(i,(function(e){return e.packs||[]})),l=t.currentStickerSelector=(0,o.createSelector)(i,(function(e){return e.currentSticker||""}));t.currentStickerPageSelector=(0,o.createSelector)(i,(function(e){return e.currentStickerPage||1})),t.packHttpStatusSelector=(0,o.createSelector)(i,(function(e){return e.packHttpStatus||""})),t.stickersSelector=(0,o.createSelector)(s.entitiesSelector,d,l,(function(e,t,r){if(!r)return[];var n=(t[r]||{}).stickerIds,o=void 0===n?[]:n;return(0,a.denormalize)(o,[c.stickerSchema],e)})),t.stickerHttpStatusSelector=(0,o.createSelector)(d,l,(function(e,t){if(!t)return"";var r=(e[t]||{}).status;return void 0===r?"":r})),t.allStickersArraySelector=(0,o.createSelector)(f,d,(function(e,t){return e.map((function(e){var r=t[e.sticker]||{};return n({},e,r)}))}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stickerReducer=t.watchStickerSagas=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(104);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o,s=r(0),c=(o=a)&&o.__esModule?o:{default:o};t.watchStickerSagas=[a.watchFetchSticker],t.stickerReducer=(0,s.handleActions)(n({},c.default),{})},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.fetchStickersRequested=t.updateFetchStickersRequestedStatus=t.updateFetchPacksRequestedStatus=t.fetchSingleStickerSucceeded=t.fetchSingleStickerRequested=t.updateCurrentSticker=t.selectSticker=t.initStickers=t.initPacks=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.fetchStickersRequestedSaga=w,t.watchFetchSticker=C;var o,s=r(0),c=r(2),u=r(3),i=r(4),d=(o=r(5))&&o.__esModule?o:{default:o},f=r(1);function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var p=regeneratorRuntime.mark(w),v=regeneratorRuntime.mark(I),h=regeneratorRuntime.mark(T),_=regeneratorRuntime.mark(C),g=(0,s.createActions)({INIT_PACKS:function(e){return{region:e.region,packs:e.packs,status:e.status}},INIT_STICKERS:function(e){return{region:e.region,sticker:e.sticker,icon:e.icon}},SELECT_STICKER:function(e){return{sticker:e.sticker,page:e.page}},UPDATE_CURRENT_STICKER:function(e){return{region:e.region,sticker:e.sticker,page:e.page}},FETCH_SINGLE_STICKER_REQUESTED:function(e){return{sticker:e.sticker}},FETCH_SINGLE_STICKER_SUCCEEDED:function(e){return{region:e.region,sticker:e.sticker,stickerIds:e.stickerIds,status:e.status}},UPDATE_FETCH_PACKS_REQUESTED_STATUS:function(e){return{region:e.region,status:e.status}},UPDATE_FETCH_STICKERS_REQUESTED_STATUS:function(e){return{region:e.region,sticker:e.sticker,status:e.status}},FETCH_STICKERS_REQUESTED:function(e){return{region:e.region}}}),S=g.initPacks,m=g.initStickers,b=g.selectSticker,y=g.updateCurrentSticker,E=g.fetchSingleStickerRequested,O=g.fetchSingleStickerSucceeded,R=g.updateFetchPacksRequestedStatus,k=g.updateFetchStickersRequestedStatus,x=g.fetchStickersRequested;function w(e){var t,r,n,a,o,s,d,l,v,h=e.payload.region;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,h){e.next=8;break}return e.next=4,(0,c.select)(f.currentConversationShopSelectors);case 4:t=e.sent,r=t.country,h=(void 0===r?"sg":r).toLowerCase();case 8:return e.next=10,(0,c.select)(f.packHttpStatusSelectors);case 10:if((n=e.sent)!==i.HttpStatus.INIT_PENDING&&n!==i.HttpStatus.SUCCEED){e.next=13;break}return e.abrupt("return",null);case 13:return e.next=15,(0,c.put)(R({region:h,status:i.HttpStatus.INIT_PENDING}));case 15:return e.next=17,(0,c.call)(u.fetch,{server:(0,i.stickersURI)(h),namespace:"",version:"",credentials:"omit",resource:"manifest",extension:"json"});case 17:return a=e.sent,o=a.packs,s=o.reduce((function(e,t){return e.concat(t.reg.includes(h.toUpperCase())?t.pid:[])}),[]),d=s.map((function(e){return(0,c.put)(m({region:h,sticker:e}))})),e.next=23,(0,c.all)(d);case 23:return l=s.map((function(e){return{id:e,icon:"https://"+(0,i.stickersURI)(h)+"/packs/"+e+"/icon@2x.png"}})),e.next=26,(0,c.put)(S({region:h,packs:l,status:i.HttpStatus.SUCCEED}));case 26:if(!(s.length>0)){e.next=30;break}return v=s[0],e.next=30,(0,c.put)(b({sticker:v}));case 30:e.next=36;break;case 32:return e.prev=32,e.t0=e.catch(0),e.next=36,(0,c.put)(R({region:h,status:i.HttpStatus.INIT_FAILED}));case 36:case"end":return e.stop()}}),p,this,[[0,32]])}function I(e){var t,r,n,a,o,s,l,p,h,_=e.payload.sticker;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.select)(f.currentConversationShopSelectors);case 2:return t=e.sent,r=t.country,n=(void 0===r?"sg":r).toLowerCase(),e.prev=6,e.next=9,(0,c.put)(k({region:n,sticker:_,status:i.HttpStatus.INIT_PENDING}));case 9:return e.next=11,(0,c.call)(u.fetch,{server:(0,i.stickersURI)(n),namespace:"",version:"",credentials:"omit",resource:"packs",id:_+"/"+_,extension:"json"});case 11:return a=e.sent,e.t0=f.currentUserSelector,e.next=15,(0,c.select)((function(e){return e}));case 15:return e.t1=e.sent,o=(0,e.t0)(e.t1),s=o.locale,l=a.locales.indexOf(s),p=_,a.stickers.forEach((function(e){e.src="https://"+(0,i.stickersURI)(n)+"/packs/"+p+"/"+e.sid+"@1x."+e.ext,e.locale=e.name[l],e.pid=p,e.id=e.pid+"_"+e.sid})),h=(0,d.default)("stickers",a.stickers),e.next=24,(0,c.put)((0,f.updateEntities)({entities:h.entities}));case 24:return e.next=26,(0,c.put)(O({region:n,sticker:_,stickerIds:h.result,status:i.HttpStatus.SUCCEED}));case 26:e.next=33;break;case 28:return e.prev=28,e.t2=e.catch(6),console.error(e.t2),e.next=33,(0,c.put)(k({region:n,sticker:_,status:i.HttpStatus.INIT_FAILED}));case 33:case"end":return e.stop()}}),v,this,[[6,28]])}function T(e){var t,r,n,a,o=e.payload,s=o.sticker,u=o.page;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,c.select)(f.currentConversationShopSelectors);case 3:return t=e.sent,r=t.country,n=(void 0===r?"sg":r).toLowerCase(),e.next=9,(0,c.put)(y({region:n,sticker:s,page:u}));case 9:return e.next=11,(0,c.select)(f.stickerHttpStatusSelector);case 11:if((a=e.sent)!==i.HttpStatus.INIT_PENDING&&a!==i.HttpStatus.SUCCEED){e.next=14;break}return e.abrupt("return",null);case 14:return e.next=16,(0,c.put)(E({sticker:s}));case 16:e.next=20;break;case 18:e.prev=18,e.t0=e.catch(0);case 20:case"end":return e.stop()}}),h,this,[[0,18]])}function C(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.takeEvery)(x,w);case 2:return e.next=4,(0,c.takeEvery)(E,I);case 4:return e.next=6,(0,c.takeEvery)(b,T);case 6:case"end":return e.stop()}}),_,this)}t.initPacks=S,t.initStickers=m,t.selectSticker=b,t.updateCurrentSticker=y,t.fetchSingleStickerRequested=E,t.fetchSingleStickerSucceeded=O,t.updateFetchPacksRequestedStatus=R,t.updateFetchStickersRequestedStatus=k,t.fetchStickersRequested=x,t.default=(l(n={},m,(function(e,t){var r=t.payload,n=r.region,o=r.sticker,s=r.icon,c=e[n]||{},u=c.stickers||{};return a({},e,l({},n,a({},c,{stickers:a({},u,l({},o,{icon:s,stickerIds:[],status:i.HttpStatus.NORMAL}))})))})),l(n,O,(function(e,t){var r=t.payload,n=r.region,o=r.sticker,s=r.stickerIds,c=r.status,u=e[n]||{},i=u.stickers||{},d=i[o]||{};return a({},e,l({},n,a({},u,{stickers:a({},i,l({},o,a({},d,{stickerIds:s,status:c})))})))})),l(n,k,(function(e,t){var r=t.payload,n=r.region,o=r.sticker,s=r.status,c=e[n]||{},u=c.stickers||{},i=u[o]||{};return a({},e,l({},n,a({},c,{stickers:a({},u,l({},o,a({},i,{status:s})))})))})),l(n,y,(function(e,t){var r=t.payload,n=r.region,o=r.sticker,s=r.page,c=void 0===s?1:s,u=e[n]||{};return a({},e,l({},n,a({},u,{currentSticker:o,currentStickerPage:c})))})),l(n,S,(function(e,t){var r=t.payload,n=r.region,o=r.packs,s=void 0===o?[]:o,c=r.status,u=e[n]||{};return a({},e,l({},n,a({},u,{packs:s,packHttpStatus:c})))})),l(n,R,(function(e,t){var r=t.payload,n=r.region,o=r.status,s=e[n]||{};return a({},e,l({},n,a({},s,{packHttpStatus:o})))})),n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(106);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(107);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.currentBuyerShopSelector=t.myShopSelector=t.fetchedShopIdsSelector=t.shopSelector=void 0;var n=r(7),a=r(6),o=r(1),s=r(5);t.shopSelector=function(e){return(0,a.createSelector)(o.entitiesSelector,(function(t){return(0,n.denormalize)(e,s.shopSchema,t)}))},t.fetchedShopIdsSelector=function(e){return e.shopReducer.fetchedShopIds},t.myShopSelector=(0,a.createSelector)(o.currentConversationSelector,(function(e){return e.shop||{}})),t.currentBuyerShopSelector=(0,a.createSelector)(o.currentBuyerShopIdSelector,o.entitiesSelector,(function(e,t){return(0,n.denormalize)(e,s.shopSchema,t)||{}}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(108);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(109);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchShopIdsActions=t.fetchShopsByIds=t.getShops=t.getPendingShopsCount=t.getShopUnreadCountByIds=t.updateFetchedShopIds=t.fetchShopAuthRequested=t.updateFetchShopsStatus=t.fetchShopsSucceed=t.fetchShopsRequested=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.fetchShopAuth=S;var a=r(0),o=r(2),s=r(3);function c(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var u,i,d,f=regeneratorRuntime.mark(S),l=(0,a.createActions)({FETCH_SHOPS_REQUESTED:function(e){var t=e.reset,r=void 0!==t&&t,n=e.systemLevel;return{reset:r,systemLevel:void 0!==n&&n}},FETCH_SHOPS_SUCCEED:function(e){return{pagination:e.pagination,result:e.result}},UPDATE_FETCH_SHOPS_STATUS:function(e){return{status:e.status}},FETCH_SHOP_AUTH_REQUESTED:function(e){return{shopId:e.shopId}},UPDATE_FETCHED_SHOP_IDS:function(e){return{shopIds:e.shopIds}}}),p=l.fetchShopsRequested,v=l.fetchShopsSucceed,h=l.updateFetchShopsStatus,_=l.fetchShopAuthRequested,g=l.updateFetchedShopIds;function S(e){var t,r=e.payload.shopId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,o.call)(s.fetch,{parent:"shop",parentId:r,resource:"auth"});case 3:return t=e.sent,e.abrupt("return",t);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{});case 10:case"end":return e.stop()}}),f,this,[[0,7]])}t.fetchShopsRequested=p,t.fetchShopsSucceed=v,t.updateFetchShopsStatus=h,t.fetchShopAuthRequested=_,t.updateFetchedShopIds=g,t.getShopUnreadCountByIds=function(e){return new Promise((function(t){(0,s.fetch)({parent:"conversation",resource:"unread-counts",params:{shop_ids:JSON.stringify(e)}}).then((function(e){var r=e["unread-counts"];t(void 0===r?[]:r)})).catch((function(){t([])}))}))},t.getPendingShopsCount=function(){return new Promise((function(e){(0,s.fetch)({resource:"shops",suffix:"pendings"}).then((function(t){var r=t.count;e(void 0===r?0:r)})).catch((function(){e(0)}))}))},t.getShops=function(){return new Promise((function(e){(0,s.fetch)({resource:"shops",params:{per_page:1,page:1}}).then((function(t){e(t)})).catch((function(t){e(t)}))}))},t.fetchShopsByIds=function(e){var t=e.shopIds;return new Promise((function(e){(0,s.fetch)({resource:"shops",params:{ids:JSON.stringify(t)}}).then((function(t){var r=t.shops;e(void 0===r?[]:r)})).catch((function(){e([])}))}))},t.fetchShopIdsActions=(d=function(e,t){var r=t.payload.shopIds,a=e.fetchedShopIds;return n({},e,{fetchedShopIds:[].concat(c(new Set(a.concat(r))))})},(i=g)in(u={})?Object.defineProperty(u,i,{value:d,enumerable:!0,configurable:!0,writable:!0}):u[i]=d,u)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showShop=i;var n,a=r(1),o=r(3),s=r(2),c=(n=r(5))&&n.__esModule?n:{default:n},u=regeneratorRuntime.mark(i);function i(e){var t,r,n,i=e.payload.shopId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,s.select)((0,a.shopSelector)(i));case 3:return t=e.sent,e.next=6,(0,s.call)(o.fetch,{resource:"shop",id:i,params:{need_cache:1,cache_expires:600}});case 6:return t=e.sent,r=(0,c.default)("shops",t),n=r.entities,e.next=10,(0,s.put)((0,a.updateEntities)({entities:n}));case 10:return e.next=12,(0,s.put)((0,a.updateFetchedShopIds)({shopIds:[t.id]}));case 12:return e.abrupt("return",t);case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",{});case 18:case"end":return e.stop()}}),u,this,[[0,15]])}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(111);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(15);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o=r(112);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toastSelector=function(e){return e.toastReducer.toast}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toastReducer=t.watchToastSagas=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(113);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o=r(16);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}));var s=r(114);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})}));var c=r(115);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})}));var u,i=r(0),d=(u=o)&&u.__esModule?u:{default:u};t.watchToastSagas=[o.watchSet,a.watchError,s.watchCopy],t.toastReducer=(0,i.handleActions)(n({},d.default),{toast:{type:"",message:"",show:!1}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showOperationFailureToastRequested=void 0,t.watchError=l;var n=r(0),a=r(2),o=r(11),s=r(15),c=r(16),u=regeneratorRuntime.mark(f),i=regeneratorRuntime.mark(l),d=(0,n.createActions)({SHOW_OPERATION_FAILURE_TOAST_REQUESTED:function(e){return{error:e.error}}}).showOperationFailureToastRequested;function f(e){var t,r=e.payload.error;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r instanceof o.CustomError||r instanceof o.Webview?r.handler():(0,s.getToastInformation)(!1,{type:"server-error-tips"}),e.next=4,(0,a.put)((0,c.setToastInformation)({toast:t}));case 4:case"end":return e.stop()}}),u,this)}function l(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.takeEvery)(d,f);case 2:case"end":return e.stop()}}),i,this)}t.showOperationFailureToastRequested=d},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.copySucceedFeedback=void 0,t.watchCopy=f;var n=r(0),a=r(2),o=r(16),s=r(15),c=regeneratorRuntime.mark(d),u=regeneratorRuntime.mark(f),i=(0,n.createActions)({COPY_SUCCEED_FEEDBACK:function(){return{}}}).copySucceedFeedback;function d(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.put)((0,o.setToastInformation)({toast:(0,s.getToastInformation)(!0,{message:e("common.successful_copied")})}));case 2:case"end":return t.stop()}}),c,this)}function f(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.takeEvery)(i,d);case 2:case"end":return e.stop()}}),u,this)}t.copySucceedFeedback=i}).call(this,r(8).t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.notifyToastRequested=void 0;var n=(0,r(0).createActions)({NOTIFY_TOAST_REQUESTED:function(e){return{toast:e.toast}}}).notifyToastRequested;t.notifyToastRequested=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(117);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o=r(118);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.messagesWithSourceSelector=t.messageSourceIdsSelector=t.messageSourceSelector=t.unreadMessageIdsSelector=t.unreadMessagesSelector=t.reverseMessagesSelector=t.messageOffersSelector=t.messagesSelector=t.entryPointSelector=t.messageHasNextSelector=t.hasMoreLatestMessageSelector=t.hasMoreOlderMessageSelector=t.failedMessageIdsSelector=t.sendingMessageIdsSelector=t.allMessageIdsSelector=t.conversationMessageIdsSelector=t.messageIdsSelector=t.getMessagesSelector=t.getMessageSelector=t.offlineMessagesSelector=t.messageIdsHashSelector=t.messageHttpStatusSelector=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(7),o=r(6),s=r(5),c=r(1),u=r(4),i=u.MessageTypes.MSG_TYPE_TEXT,d=u.MessageTypes.MSG_TYPE_ORDER,f=u.MessageTypes.MSG_TYPE_PRODUCT,l=u.MessageTypes.MSG_TYPE_OFFER,p=u.MessageTypes.MSG_TYPE_WEBVIEW,v=u.MessageTypes.MSG_TYPE_IMAGE,h=u.MessageTypes.MSG_TYPE_CART_REMINDER,_=u.MessageTypes.MSG_TYPE_FAQ_UNSUPPORTED,g=u.MessageTypes.MSG_TYPE_FAQ_LIVEAGENT_PROMPT,S=[d,f],m=(t.messageHttpStatusSelector=function(e){return e.messageReducer.status},t.messageIdsHashSelector=function(e){return e.messageReducer.messageIdsHash}),b=(t.offlineMessagesSelector=function(e){return e.messageReducer.offlineMessages},t.getMessageSelector=function(e){return(0,o.createSelector)(c.messageEntitiesSelector,(function(t){return(0,a.denormalize)(e,s.messageSchema,{messages:t})}))},t.getMessagesSelector=function(e){return(0,o.createSelector)(c.messageEntitiesSelector,(function(t){return(0,a.denormalize)(e,[s.messageSchema],{messages:t})}))},t.messageIdsSelector=(0,o.createSelector)(c.currentConversationIdSelector,m,(function(e,t){return t[e]||{all:[]}}))),y=(t.conversationMessageIdsSelector=function(e){return(0,o.createSelector)(m,(function(t){return t[e]||{all:[]}}))},t.allMessageIdsSelector=(0,o.createSelector)(b,(function(e){return e.all||[]}))),E=t.sendingMessageIdsSelector=(0,o.createSelector)(b,(function(e){return e.sending||[]})),O=t.failedMessageIdsSelector=(0,o.createSelector)(b,(function(e){return e.failed||[]})),R=(t.hasMoreOlderMessageSelector=(0,o.createSelector)(b,(function(e){return e.hasMoreOlderMessage})),t.hasMoreLatestMessageSelector=(0,o.createSelector)(b,(function(e){return e.hasMoreLatestMessage})),t.messageHasNextSelector=(0,o.createSelector)(b,(function(e){return e.hasNext})),t.entryPointSelector=function(e){return e.messageReducer.entryPoint},t.messagesSelector=(0,o.createSelector)(c.messageEntitiesSelector,y,(function(e,t){return(0,a.denormalize)(t,[s.messageSchema],{messages:e})||[]}))),k=t.messageOffersSelector=(0,o.createSelector)(c.entitiesSelector,R,(function(e,t){var r=t.filter((function(e){return e&&e.type===l})).map((function(e){return e.content.offer_id}));return(0,a.denormalize)(r,[s.offerSchema],e)})),x=t.reverseMessagesSelector=(0,o.createSelector)(R,(function(e){var t=Array.from(e),r=t.filter((function(e){return e&&e.isFaking})),n=t.filter((function(e){return e&&!e.isFaking}));return r.length&&n.unshift(r.shift()),n.reverse()})),w=t.unreadMessagesSelector=(0,o.createSelector)(c.currentConversationSelector,x,(function(e,t){if(!e)return[];var r=e.last_read_message_id;return t.filter((function(t){return t&&t.to_id!==e.to_id&&function(e,t){if(void 0===e||void 0===t)return!1;var r=e.length,n=t.length;if(r!==n)return r>n;for(var a=void 0,o=0;o<r;o++)parseInt(e[o])>parseInt(t[o])&&void 0===a&&(a=!0),parseInt(e[o])<parseInt(t[o])&&void 0===a&&(a=!1);return a}(t.id,r)}))})),I=(t.unreadMessageIdsSelector=(0,o.createSelector)(w,(function(e){return e.map((function(e){return e.id}))})),t.messageSourceSelector=(0,o.createSelector)(c.currentConversationSelector,c.isScChatSelector,x,(function(e,t,r){return e?r.filter((function(e){return e})).reduce((function(r,n){var a=n.type,o=n.to_id,s=n.source_type,c=n.source_content,u=n.content;if(S.includes(a)&&c){var i=a+"_id";if(u[i]===c[i])return r}if(a===l)return r;if(!s||e&&o===e.to_id&&t)return r;var p=r.lastSourceMessage,v=r.sourceList;if(!v.length)return{sourceList:v.concat(n),lastSourceMessage:n};if(s===f){var h=c.product_id,_=p.source_content&&p.source_content.product_id;if(!h||_===h)return r}else if(s===d){var g=c.order_id,m=p.source_content&&p.source_content.order_id;if(!g||[-1,0,m].includes(g))return r}return{sourceList:v.concat(n),lastSourceMessage:n}}),{sourceList:[],lastSourceMessage:null}).sourceList:[]}))),T=t.messageSourceIdsSelector=(0,o.createSelector)(I,(function(e){return e.map((function(e){return e.id}))}));t.messagesWithSourceSelector=(0,o.createSelector)(c.entitiesSelector,x,E,O,T,k,c.currentConversationSelector,(function(e,t,r,a,o,s,c){return c?t.filter((function(e){if(!e)return!1;var t=e.content,r=e.type;return!(![_,g].includes(r)&&(!t||t&&0===Object.keys(t).length))&&(!(r===i&&!e.content.text)||o.includes(e.id))})).map((function(t){var c=r.includes(t.id)?u.MSG_STATUS.SENDING:a.includes(t.id)?u.MSG_STATUS.FAILED:t.send_status?u.MSG_STATUS.SUCCEED:null,i=o.includes(t.id),d=Object.assign({},t,{send_status:c,hasMessageSource:i}),f=d,_=f.type,g=f.content,S=void 0===g?{}:g,m=f.textContent;switch(_){case l:var b=s.find((function(e){return e&&e.id===S.offer_id}));d=Object.assign({},d,{textContent:b});break;case h:var y=Array.isArray(m)&&m.length;d=Object.assign({},d,{isCartReminderDataLoad:y});break;case p:var E=(e["voucher_web"===S.type?"vouchers":(0,u.camelCase)(S.type)]||{})[S.id];E&&(d.content=n({},d.content,E,{type:d.content.type,fetchStatus:"string"==typeof E.fetchStatus?E.fetchStatus:d.content.fetchStatus}));break;case v:if(c!==u.MSG_STATUS.SENDING){var O=S.url,R=void 0===O?"":O;if((0,u.isVisitingShopeeCN)()&&R&&!R.includes(".shopeesz.com")){var k=new URL(R),x=k.host.split(".");d.content.url=k.protocol+"//s-cf-"+x[x.length-1]+".shopeesz.com"+k.pathname}break}}return d})):[]}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.messageReducer=t.watchMessageSagas=t.handleSensitiveUrl=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(119);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o=r(120);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}));var s=r(121);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})}));var c=r(17);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})}));var u=r(122);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})}));var i=r(123);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})}));var d=r(124);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}})}));var f=r(125);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})}));var l=r(126);Object.defineProperty(t,"handleSensitiveUrl",{enumerable:!0,get:function(){return l.handleSensitiveUrl}});var p=r(127);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}})}));var v=r(0),h=y(i),_=y(c),g=y(d),S=y(r(128)),m=y(o),b=y(p);function y(e){return e&&e.__esModule?e:{default:e}}t.watchMessageSagas=[i.watchFetchMessage,c.watchSend,s.watchResend,d.watchReceive,l.watchHandle,f.watchTranslate,u.watchPopulate,o.watchOffline,a.watchEvaluation,d.watchOldConversationMessageQueue,d.watchNewConversationMessageQueue],t.messageReducer=(0,v.handleActions)(n({},h.default,_.default,g.default,S.default,m.default,b.default),{status:"",messageIdsHash:{},offlineMessages:{},entryPoint:{}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluationRequested=void 0,t.showMyRateCard=l,t.showRateCard=p,t.watchEvaluation=_;var n=r(0),a=r(3),o=r(2),s=r(4),c=r(1),u=regeneratorRuntime.mark(l),i=regeneratorRuntime.mark(p),d=regeneratorRuntime.mark(h),f=regeneratorRuntime.mark(_);function l(e,t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,o.select)((0,c.rateCardSelector)(t));case 3:if((n=e.sent)&&"failed"!==n.fetchStatus&&n.status!==s.EvaluationStatus.Unrated){e.next=8;break}return e.next=7,(0,o.call)(a.fetch,{parent:"rating_cards",parentId:t,resource:"get",params:r});case 7:n=e.sent;case 8:return e.abrupt("return",n);case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",{id:t,fetchStatus:"failed"});case 14:case"end":return e.stop()}}),u,this,[[0,11]])}function p(e){var t,r,n,s,u,d,f,p=e.ids,v=e.shopId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Array.isArray(p)?p:[p],r={},"0"!==v&&(r.shop_id=v),e.next=5,(0,o.select)(c.isSubAccountSelector);case 5:return n=e.sent,e.next=8,(0,o.select)(c.currentUserShopIdSelector);case 8:if(e.sent===parseInt(v)||n){e.next=18;break}return s=[],t.forEach((function(e){return s.push((0,o.call)(l,v,e,r))})),e.next=14,(0,o.all)(s);case 14:return u=e.sent,e.abrupt("return",u);case 18:return e.prev=18,d="rating_cards",r.ids="["+t.join(",")+"]",e.next=23,(0,o.call)(a.fetch,{resource:d,params:r});case 23:return f=e.sent,e.abrupt("return",f[d]||[]);case 27:return e.prev=27,e.t0=e.catch(18),e.abrupt("return",[]);case 30:case"end":return e.stop()}}),i,this,[[18,27]])}var v=(0,n.createActions)({EVALUATION_REQUESTED:function(e){var t=e.id,r=e.shopId,n=e.grade,a=e.reason;return{id:t,shopId:r,grade:n,reason:void 0===a?[]:a}}}).evaluationRequested;function h(e){var t,r,n,u=e.payload,i=u.id,f=u.shopId,l=u.grade,p=u.reason;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={grade:l,reason:p},f&&(t.shop_id=f),e.next=5,(0,o.call)(a.fetch,{method:"PUT",parent:"rating_cards",parentId:i,resource:"evaluate",payload:JSON.stringify(t)});case 5:return e.next=7,(0,o.put)((0,c.updateRecord)({name:"rateCards",id:i,record:{grade:l,status:s.EvaluationStatus.Rated}}));case 7:e.next=17;break;case 9:return e.prev=9,e.t0=e.catch(0),r=Math.random(),e.t0.message&&e.t0.message.error_code&&((n=e.t0.message.error_code)===s.EvaluationErrorCode.Rated&&(r=s.EvaluationStatus.Rated),n===s.EvaluationErrorCode.Expired&&(r=s.EvaluationStatus.Expired)),e.next=15,(0,o.put)((0,c.updateRecord)({name:"rateCards",id:i,record:{status:r}}));case 15:return e.next=17,(0,o.put)((0,c.showOperationFailureToastRequested)({error:e.t0}));case 17:case"end":return e.stop()}}),d,this,[[0,9]])}function _(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.takeLatest)(v,h);case 2:case"end":return e.stop()}}),f,this)}t.evaluationRequested=v},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.resendOfflineMessagesOnceSucceed=t.resendOfflineMessagesOnce=t.resetMessagesFailedByOffline=t.sendMessagesFailedByOffline=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var s,c=e[Symbol.iterator]();!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};t.updateResendConversationMessage=E,t.watchOffline=O;var s=r(0),c=r(2),u=r(10),i=r(17),d=r(1);function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var p=regeneratorRuntime.mark(y),v=regeneratorRuntime.mark(E),h=regeneratorRuntime.mark(O),_=(0,s.createActions)({SEND_MESSAGES_FAILED_BY_OFFLINE:function(e){return{conversationId:e.conversationId,requestIds:e.requestIds}},RESET_MESSAGES_FAILED_BY_OFFLINE:function(){return{}},RESEND_OFFLINE_MESSAGES_ONCE:function(){return{}},RESEND_OFFLINE_MESSAGES_ONCE_SUCCEED:function(e){return{conversationId:e.conversationId,messageIds:e.messageIds}}}),g=_.sendMessagesFailedByOffline,S=_.resetMessagesFailedByOffline,m=_.resendOfflineMessagesOnce,b=_.resendOfflineMessagesOnceSucceed;function y(){var e,t,r,n,a,s,u,f,l,v,h,_,g,m,b,y,E=this;return regeneratorRuntime.wrap((function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,(0,c.select)(d.offlineMessagesSelector);case 2:e=p.sent,t=Object.entries(e),r=[],n=regeneratorRuntime.mark((function e(t){var n,a,s,u,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o(t,2),a=n[0],s=n[1],e.next=3,(0,c.select)((0,d.getMessagesSelector)(s));case 3:u=e.sent,i=s.map((function(e,t){return{conversationId:a,requestIds:[e],messages:[u[t]]}})).filter((function(e){return e.messages[0]})),r=r.concat(i);case 6:case"end":return e.stop()}}),e,E)})),a=!0,s=!1,u=void 0,p.prev=9,f=t[Symbol.iterator]();case 11:if(a=(l=f.next()).done){p.next=17;break}return v=l.value,p.delegateYield(n(v),"t0",14);case 14:a=!0,p.next=11;break;case 17:p.next=23;break;case 19:p.prev=19,p.t1=p.catch(9),s=!0,u=p.t1;case 23:p.prev=23,p.prev=24,!a&&f.return&&f.return();case 26:if(p.prev=26,!s){p.next=29;break}throw u;case 29:return p.finish(26);case 30:return p.finish(23);case 31:h=!0,_=!1,g=void 0,p.prev=34,m=r[Symbol.iterator]();case 36:if(h=(b=m.next()).done){p.next=45;break}return y=b.value,p.next=40,(0,i.sendMessages)(y);case 40:return p.next=42,(0,c.delay)(400);case 42:h=!0,p.next=36;break;case 45:p.next=51;break;case 47:p.prev=47,p.t2=p.catch(34),_=!0,g=p.t2;case 51:p.prev=51,p.prev=52,!h&&m.return&&m.return();case 54:if(p.prev=54,!_){p.next=57;break}throw g;case 57:return p.finish(54);case 58:return p.finish(51);case 59:return p.next=61,(0,c.put)(S());case 61:case"end":return p.stop()}}),p,this,[[9,19,23,31],[24,,26,30],[34,47,51,59],[52,,54,58]])}function E(e){var t=e.conversationId,r=e.messageIds;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.put)(b({conversationId:t,messageIds:r}));case 2:case"end":return e.stop()}}),v,this)}function O(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.takeEvery)(m,y);case 2:case"end":return e.stop()}}),h,this)}t.sendMessagesFailedByOffline=g,t.resetMessagesFailedByOffline=S,t.resendOfflineMessagesOnce=m,t.resendOfflineMessagesOnceSucceed=b,window.addEventListener("judge-online",(function(){u.store.dispatch(m())})),t.default=(f(n={},g,(function(e,t){var r=t.payload,n=r.conversationId,o=r.requestIds,s=e.offlineMessages,c=(s[n]||[]).concat(o);return a({},e,{offlineMessages:a({},s,f({},n,[].concat(l(new Set(c)))))})})),f(n,S,(function(e){return a({},e,{offlineMessages:{}})})),f(n,b,(function(e,t){var r=t.payload,n=r.conversationId,o=r.messageIds,s=e.messageIdsHash,c=s[n]||{},u=(c.all||[]).filter((function(e){return!o.includes(e)})),i=(c.failed||[]).filter((function(e){return!o.includes(e)})),d=(c.sending||[]).filter((function(e){return!o.includes(e)}));return a({},e,{messageIdsHash:a({},s,f({},n,a({},c,{all:u,failed:i,sending:d})))})})),n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resendMessageRequested=void 0,t.watchResend=d;var n=r(0),a=r(2),o=r(17),s=regeneratorRuntime.mark(i),c=regeneratorRuntime.mark(d),u=(0,n.createActions)({RESEND_MESSAGE_REQUESTED:function(e){return{conversationId:e.conversationId,message:e.message}}}).resendMessageRequested;function i(e){var t=e.payload,r=t.conversationId,n=t.message;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.sendMessages)({conversationId:r,requestIds:[n.request_id],messages:[n]});case 2:case"end":return e.stop()}}),s,this)}function d(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.takeEvery)(u,i);case 2:case"end":return e.stop()}}),c,this)}t.resendMessageRequested=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.populateMessageRequested=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.getPopulateContent=p,t.watchPopulate=h;var a=r(0),o=r(2),s=r(4),c=r(1),u=r(12),i=regeneratorRuntime.mark(p),d=regeneratorRuntime.mark(v),f=regeneratorRuntime.mark(h),l=(0,a.createActions)({POPULATE_MESSAGE_REQUESTED:function(e){return{message:e.message}}}).populateMessageRequested;function p(e,t){var r,n,a,u,d,f,l;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:r=void 0,n=t.id,a=t.shopId,u=t.creatorId,d=t.cartItems,f=t.faqMessageIds,i.t0=e,i.next="product"===i.t0?5:"order"===i.t0?9:"offer"===i.t0?13:"shop"===i.t0?17:"shops"===i.t0?21:i.t0===s.MessageTypes.MSG_TYPE_RATE_CARDS?25:i.t0===s.MessageTypes.MSG_TYPE_VOUCHER_WEB?29:i.t0===s.MessageTypes.MSG_TYPE_FEED_STORY?33:i.t0===s.MessageTypes.MSG_TYPE_VOUCHER?37:i.t0===s.MessageTypes.MSG_TYPE_CART_REMINDER?42:i.t0===s.MessageTypes.MSG_TYPE_ORDER_REVIEW_REMINDER?46:i.t0===s.MessageTypes.MSG_TYPE_FAQ_HISTORY?50:54;break;case 5:return i.next=7,(0,o.call)(c.showProduct,{payload:{productId:n,shopId:a}});case 7:return r=i.sent,i.abrupt("break",54);case 9:return i.next=11,(0,o.call)(c.showOrder,{payload:{orderId:n,shopId:a}});case 11:return r=i.sent,i.abrupt("break",54);case 13:return i.next=15,(0,o.call)(c.showOffer,{payload:{offerId:n,shopId:a}});case 15:return r=i.sent,i.abrupt("break",54);case 17:return i.next=19,(0,o.call)(c.showShop,{payload:{shopId:a}});case 19:return r=i.sent,i.abrupt("break",54);case 21:return i.next=23,(0,o.call)(c.showShop,{payload:{shopId:t}});case 23:return r=i.sent,i.abrupt("break",54);case 25:return i.next=27,(0,o.call)(c.showRateCard,{shopId:a,ids:n});case 27:return r=i.sent,i.abrupt("break",54);case 29:return i.next=31,(0,o.call)(c.showVoucher,{shopId:a,ids:n});case 31:return r=i.sent,i.abrupt("break",54);case 33:return i.next=35,(0,o.call)(c.showFeedStory,{payload:{id:n,creatorId:u}});case 35:return r=i.sent,i.abrupt("break",54);case 37:return i.next=39,(0,o.call)(c.showVoucher,{shopId:a,ids:Array.isArray(n)?n:[n]});case 39:return l=i.sent,r=l[0],i.abrupt("break",54);case 42:return i.next=44,(0,o.call)(c.showCartReminder,{id:n,cartItems:d});case 44:return r=i.sent,i.abrupt("break",54);case 46:return i.next=48,(0,o.call)(c.showUnrateOrder,{payload:{orderId:n,shopId:a}});case 48:return r=i.sent,i.abrupt("break",54);case 50:return i.next=52,(0,o.call)(c.showFaqHistory,{payload:{ids:f.slice(0,3),id:n}});case 52:return r=i.sent,i.abrupt("break",54);case 54:return i.abrupt("return",{type:e,content:r});case 55:case"end":return i.stop()}}),i,this)}function v(e){var t,r,a=e.payload.message;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.put)((0,c.updateRecord)({name:"messages",id:a.id,record:{fetchStatus:""}}));case 2:return e.next=4,(0,o.select)(c.isSubAccountSelector);case 4:return t=e.sent,e.next=7,(0,o.select)(c.currentUserShopIdSelector);case 7:return r=e.sent,e.next=10,(0,o.call)(u.populateMessageWithSourceAndContent,[a],r,t);case 10:return e.next=12,(0,o.put)((0,c.updateRecord)({name:"messages",id:a.id,record:n({},a)}));case 12:case"end":return e.stop()}}),d,this)}function h(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.takeEvery)(l,v);case 2:case"end":return e.stop()}}),f,this)}t.populateMessageRequested=l},function(e,t,r){"use strict";(function(e){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.updateFetchMessagesRequestedStatus=t.fetchMessagesSucceeded=t.fetchMessagesRequested=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.fetchMessagesRequestedSaga=y,t.watchFetchMessage=E;var o=r(0),s=r(2),c=r(1),u=r(12),i=r(3),d=r(4);function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var l=regeneratorRuntime.mark(b),p=regeneratorRuntime.mark(y),v=regeneratorRuntime.mark(E),h=(0,o.createActions)({FETCH_MESSAGES_REQUESTED:function(e){return{conversation:e.conversation,reset:e.reset,direction:e.direction,messageId:e.messageId,cachedLatestId:e.cachedLatestId,cachedOldestId:e.cachedOldestId,source:e.source}},FETCH_MESSAGES_SUCCEEDED:function(e){return{conversationId:e.conversationId,messageIds:e.messageIds,limit:e.limit,persist:e.persist,status:e.status,messageRequestIds:e.messageRequestIds,direction:e.direction,reset:e.reset,cachedOldestId:e.cachedOldestId}},UPDATE_FETCH_MESSAGES_REQUESTED_STATUS:function(e){return{status:e.status}}}),_=h.fetchMessagesRequested,g=h.fetchMessagesSucceeded,S=h.updateFetchMessagesRequestedStatus;t.fetchMessagesRequested=_,t.fetchMessagesSucceeded=g,t.updateFetchMessagesRequestedStatus=S;var m=function(t){var r=t.conversationId,n=t.shopId,o=t.offset,s=t.limit,c=void 0===s?20:s,u=t.direction,d=void 0===u?"older":u,f=(t.source,{shop_id:n,offset:o,limit:"around"===d?Math.ceil(c/2):c,direction:d});return new Promise((function(t,n){(0,i.fetch)({parent:"conversations",parentId:r,resource:"messages",params:f}).then((function(r){var n=r.messages,o=(void 0===n?[]:n).map((function(t){var r=t.type,n=t.status;return"text"===r&&"censored_blacklist"===n?a({},t,{errorCode:43,send_status:2,content:{text:e("common.blacklist.replaced_text")}}):t}));t({messages:o,limit:c})})).catch((function(e){n(e)}))}))};function b(e,t){var r,n,a,o,u,i;return regeneratorRuntime.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,(0,s.select)((0,c.getConversation)(e));case 2:if(r=d.sent,a=(n=r||{}).latestMessageStatus,o=n.latestMessage,u=void 0===o?{}:o,!a){d.next=9;break}if(i=t.map((function(e){return e.request_id})),!u.id||!i.includes(u.id)){d.next=9;break}return d.next=9,(0,s.put)((0,c.updateRecord)({name:"conversations",id:e,record:{latestMessage:{},latestMessageStatus:""}}));case 9:case"end":return d.stop()}}),l,this)}function y(e){var t,r,n,a,o,f,l,v,h,y,E,O,R,k,x,w,I,T,C,P,M,j,A=e.payload,N=A.conversation,D=A.reset,U=A.direction,L=A.messageId,q=A.cachedOldestId,F=A.cachedLatestId,G=A.source;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,s.select)((function(e){return e.conversationReducer}));case 3:return t=e.sent,r=t.persist,e.next=7,(0,s.select)(c.currentUserShopIdSelector);case 7:return n=e.sent,e.next=10,(0,s.select)(c.isSubAccountSelector);case 10:return a=e.sent,o=N.id,f=N.shop_id,e.next=14,(0,s.select)((function(e){return e.messageReducer}));case 14:if(l=e.sent,v=l.messageIdsHash,h=v[o]||{},y=void 0,E=void 0,!D||"around"===U){e.next=26;break}y=0,U="older",E=!0,q=h.oldestMessageId,e.next=39;break;case 26:e.t0=U,e.next="older"===e.t0?29:"latest"===e.t0?32:"around"===e.t0?35:38;break;case 29:return y=h.oldestMessageId,E=h.hasMoreOlderMessage,e.abrupt("break",39);case 32:return y=h.latestMessageId,E=h.hasMoreLatestMessage,e.abrupt("break",39);case 35:return y=L,E=!0,e.abrupt("break",39);case 38:return e.abrupt("break",39);case 39:if(E){e.next=47;break}return e.next=42,(0,s.select)(c.messageHttpStatusSelector);case 42:if(!e.sent.includes("failed")){e.next=46;break}return e.next=46,(0,s.put)(S({status:d.HttpStatus.SUCCEED}));case 46:return e.abrupt("return");case 47:return e.next=49,(0,s.put)(S({status:D||"around"===U?d.HttpStatus.INIT_PENDING:d.HttpStatus.PENDING}));case 49:return e.next=51,(0,s.call)(m,{conversationId:o,shopId:f,offset:y,direction:U,source:G});case 51:if(O=e.sent,R=O.messages,k=O.limit,e.t1=D,!e.t1){e.next=58;break}return e.next=58,(0,s.fork)(b,o,R);case 58:return R.sort((function(e,t){return t.id-e.id})),e.next=61,(0,s.call)(u.populateMessageWithSourceAndContent,R,n,a);case 61:return e.next=63,(0,s.select)(c.messagesWithSourceSelector);case 63:return x=e.sent,e.next=66,(0,s.call)(i.updateOrReplaceAction,x,R,"messages");case 66:return w=R.map((function(e){return e.id})),I=new Map,T=R.reduce((function(e,t){var r=t.request_id,n=t.id;return e.has(r)||e.set(r,n),e}),I),C={reset:D,limit:k,direction:U,messageIds:w,conversationId:o,persist:r,status:d.HttpStatus.SUCCEED,messageRequestIds:T},P=!1,(M=F||(h.all||[])[0])&&(D||F)&&(j=w[w.length-1]||y,M&&(0,d.greaterThan)(j,M)?(P=!0,F=F||M):C.cachedOldestId=q),e.next=75,(0,s.put)(g(C));case 75:if(!P){e.next=78;break}return e.next=78,(0,s.put)(_({direction:"older",conversation:N,cachedLatestId:F,cachedOldestId:q||0}));case 78:e.next=84;break;case 80:return e.prev=80,e.t2=e.catch(0),e.next=84,(0,s.put)(S({status:D?d.HttpStatus.INIT_FAILED:d.HttpStatus.FAILED}));case 84:case"end":return e.stop()}}),p,this,[[0,80]])}function E(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.takeEvery)(_,y);case 2:case"end":return e.stop()}}),v,this)}t.default=(f(n={},g,(function(e,t){var r=t.payload,n=r.limit,o=r.status,s=r.conversationId,c=r.messageIds,i=r.persist,d=r.messageRequestIds,l=r.direction,p=r.reset,v=r.cachedOldestId,h=e.messageIdsHash,_=h[s]||{},g={};switch(l){case"older":g.oldestMessageId=v||c[c.length-1],g.hasMoreOlderMessage=c.length>=n;break;case"latest":g.latestMessageId=c[0],g.hasMoreLatestMessage=c.length>=n;break;case"around":g.oldestMessageId=c[c.length-1],g.latestMessageId=c[0],g.hasMoreOlderMessage=!0,g.hasMoreLatestMessage=!0,_={}}p&&"around"!==l&&(g.hasMoreLatestMessage=!1);var S=(_.all||[]).map((function(e){return d.has(e)?d.get(e):e})),m=_.failed||[];return a({},e,{status:o,messageIdsHash:a({},h,f({},s,a({},_,{all:(0,u.handleIds)(S,c,p,l),failed:m.filter((function(e){return!d.has(e)}))},g))),persist:i})})),f(n,S,(function(e,t){var r=t.payload.status;return a({},e,{status:r})})),f(n,c.updateCurrentConversationMode,(function(e,t){var r=t.payload,n=r.mode,o=r.conversationId,s=e.messageIdsHash;return n?a({},e):a({},e,{messageIdsHash:a({},s,f({},o,{}))})})),n)}).call(this,r(8).t)},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.resetConversationQueue=t.resetOldConversationQueue=t.resetNewConversationQueue=t.updateNewMessageFlag=t.receiveMessageSucceeded=t.receiveMessageRequested=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.watchNewConversationMessageQueue=j,t.watchOldConversationMessageQueue=A,t.handleCurrentConversationChange=D,t.watchReceive=U;var o,s=r(0),c=r(2),u=(o=r(5))&&o.__esModule?o:{default:o},i=r(1),d=r(4),f=r(12);function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var p=regeneratorRuntime.mark(P),v=regeneratorRuntime.mark(M),h=regeneratorRuntime.mark(j),_=regeneratorRuntime.mark(A),g=regeneratorRuntime.mark(D),S=regeneratorRuntime.mark(U),m=d.MessageTypes.MSG_TYPE_OFFER,b=(0,s.createActions)({RECEIVE_MESSAGE_REQUESTED:function(e){return{message:e.message}},RECEIVE_MESSAGE_SUCCEEDED:function(e){return{conversationId:e.conversationId,message:e.message}},UPDATE_NEW_MESSAGE_FLAG:function(e){return{flag:e.flag}},RESET_NEW_CONVERSATION_QUEUE:function(){return{}},RESET_OLD_CONVERSATION_QUEUE:function(){return{}},RESET_CONVERSATION_QUEUE:function(){return{}}}),y=b.receiveMessageRequested,E=b.receiveMessageSucceeded,O=b.updateNewMessageFlag,R=b.resetNewConversationQueue,k=b.resetOldConversationQueue,x=b.resetConversationQueue;t.receiveMessageRequested=y,t.receiveMessageSucceeded=E,t.updateNewMessageFlag=O,t.resetNewConversationQueue=R,t.resetOldConversationQueue=k,t.resetConversationQueue=x;var w=2e3,I=2e3,T=[],C=[];function P(e){var t,r,n,o,s,u,d,f,l,v,h;return regeneratorRuntime.wrap((function(p){for(;;)switch(p.prev=p.next){case 0:return t=e.content,r=e.from_id,n=e.send_by_yourself,o=e.conversation_id,u=(s=t||{}).offer_id,d=s.model_id,f=s.shop_id,l=s.product_id,v=[],h={},p.next=6,(0,c.select)((0,i.relatedOfferIdsSelector)(o,d,u,l));case 6:return p.sent.forEach((function(e){var t=e.id;h[t]=a({},e,{status:"cancelled"}),n||v.push((0,c.call)(handleOfferResultChanged,{shopId:f,buyerId:r,offerId:t,type:"remove"}))})),v.push((0,c.put)((0,i.batchUpdateRecord)({name:"offers",records:h}))),p.next=11,(0,c.all)(v);case 11:case"end":return p.stop()}}),p,this)}function M(e){var t,r,n,o,s,d,l,p,h,_,g,S,b,y,O,R,k,x,w,I,M,j,A,N,D,U,L,q,F,G,H,V,B,W,Q,Y,K,J,z=e.payload.message;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=z.id,r=z.type,n=z.request_id,z.from_shop_id,z.to_shop_id,o=z.conversation_id,s=z.send_by_yourself,d=z.content,l=z.created_at,e.next=3,(0,c.select)(i.isSubAccountSelector);case 3:return p=e.sent,e.next=6,(0,c.select)((function(e){return e.conversationReducer}));case 6:return h=e.sent,_=h.conversationIdsMap,g=h.currentConversationId,S=h.currentConversationCanRead,e.next=12,(0,c.select)((0,i.getConversation)(o));case 12:if(b=e.sent,y=b.id&&b.faking,_&&_[o.toString()]||y){e.next=19;break}T.push(z),e.next=115;break;case 19:if(r!==m){e.next=23;break}return e.next=23,(0,c.call)(P,z);case 23:if(O=g===o,R=(0,f.getChatBotParams)(z,{updateMaxGeneralOptionHideTime:s}),k=(0,i.getCrmPreviewParams)(z),!O){e.next=114;break}if(!s){e.next=85;break}return e.next=30,(0,c.select)(i.messagesWithSourceSelector);case 30:x=e.sent,w=!1,I=!1,M=!1,j=!0,A=!1,N=void 0,e.prev=37,D=x[Symbol.iterator]();case 39:if(j=(U=D.next()).done){e.next=50;break}if(L=U.value,q=L.id,F=L.retryRequestId,I=q===n,M=F===n,!((w=q===t)||I||M)){e.next=47;break}return e.abrupt("break",50);case 47:j=!0,e.next=39;break;case 50:e.next=56;break;case 52:e.prev=52,e.t0=e.catch(37),A=!0,N=e.t0;case 56:e.prev=56,e.prev=57,!j&&D.return&&D.return();case 59:if(e.prev=59,!A){e.next=62;break}throw N;case 62:return e.finish(59);case 63:return e.finish(56);case 64:if(w){e.next=83;break}if(!I&&!M){e.next=70;break}return e.next=68,(0,c.call)(i.handleSendSucceededMessages,[z],o);case 68:e.next=83;break;case 70:return e.next=72,(0,c.select)(i.currentUserSelector)||{};case 72:return G=e.sent,H=G.shop_id,e.next=76,(0,c.call)(f.populateMessageWithSourceAndContent,[z],H,p,!0);case 76:return V=(0,u.default)("messages",z),e.next=79,(0,c.put)((0,i.updateEntities)({entities:V.entities}));case 79:return e.next=81,(0,c.put)((0,i.updateRecord)({name:"conversations",id:o,record:a({latest_message_id:t,latest_message_type:r,latest_message_content:d,last_message_time:l,latestMessage:{},latestMessageStatus:""},R,k)}));case 81:return e.next=83,(0,c.put)(E({conversationId:o,message:z}));case 83:e.next=106;break;case 85:return e.next=87,(0,c.select)(i.currentUserSelector)||{};case 87:return B=e.sent,W=B.shop_id,e.next=91,(0,c.select)(i.currentConversationSelector);case 91:return Q=e.sent,e.next=94,(0,c.call)(f.populateMessageWithSourceAndContent,[z],W,p,!0);case 94:return Y=(0,u.default)("messages",z),e.next=97,(0,c.put)((0,i.updateEntities)({entities:Y.entities}));case 97:if(K=Q.unread_count,J=S?K:K+1,0!==K||S){e.next=102;break}return e.next=102,(0,c.put)((0,i.updateUnreadCount)({type:i.unreadCountActions.RECEIVE_UNREADABLE_MESSAGE,conversation:Q}));case 102:return e.next=104,(0,c.put)((0,i.updateRecord)({name:"conversations",id:o,record:a({latest_message_id:t,latest_message_type:r,latest_message_content:d,last_message_time:l,unread_count:J,latestMessage:{},latestMessageStatus:""},R,k)}));case 104:return e.next=106,(0,c.put)(E({conversationId:o,message:z}));case 106:if(!y){e.next=109;break}return e.next=109,(0,c.put)((0,i.fetchConversationsRequested)({direction:"latest"}));case 109:if(s||!S){e.next=112;break}return e.next=112,(0,c.put)((0,i.markMessagesRequested)({conversationId:o,isRead:!0,latestMessageId:t,shopId:b.shop_id}));case 112:e.next=115;break;case 114:C.push(z);case 115:case"end":return e.stop()}}),v,this,[[37,52,56,64],[57,,59,63]])}function j(){var e,t;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=3,(0,c.delay)(w);case 3:if(e=T.length){r.next=8;break}w=8e3===w?w:2*w,r.next=21;break;case 8:return t=T.splice(0,e).sort((function(e,t){return e.created_timestamp-t.created_timestamp})),w=2e3,r.next=12,(0,c.select)((function(e){return e.conversationReducer}));case 12:if(!(r.sent.latestTimestamp<=t[0].created_timestamp)){r.next=21;break}return r.next=17,(0,c.put)((0,i.fetchConversationsRequested)({direction:"latest"}));case 17:return r.next=19,(0,c.take)(i.fetchConversationsSucceeded);case 19:return r.next=21,(0,c.put)((0,i.updateUnreadCount)({type:i.unreadCountActions.REFRESH_TOTAL_UNREAD_CONVERSATION_COUNT}));case 21:r.next=0;break;case 23:case"end":return r.stop()}}),h,this)}function A(){var e,t=this;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=3,(0,c.delay)(I);case 3:if(e=C.length){r.next=8;break}I=8e3===I?I:2*I,r.next=9;break;case 8:return r.delegateYield(regeneratorRuntime.mark((function r(){var n,o,s,u,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,c.put)((0,i.updateFetchConversationsDirection)({direction:"latest"}));case 2:return n=C.splice(0,e),I=2e3,o=Array.from(new Set(n.map((function(e){return e.conversation_id})))),t.next=7,(0,c.select)((0,i.getConversations)(o));case 7:return s=t.sent,u={},d=0,n.forEach((function(e){var t=e.id,r=e.type,n=e.content,o=e.created_at,c=e.conversation_id,l=e.send_by_yourself,p=(0,f.getChatBotParams)(e,{updateMaxGeneralOptionHideTime:l}),v=(0,i.getCrmPreviewParams)(e),h=a({latest_message_id:t,latest_message_type:r,latest_message_content:n,last_message_time:o},p,v),_=u[c];if(_)t>_.latest_message_id?u[c]=a({},_,h,{unread_count:l?_.unread_count:_.unread_count+1}):u[c]=a({},_,{unread_count:l?_.unread_count:_.unread_count+1});else{var g=s.find((function(e){return e.id===c}))||{},S=g.unread_count,m=void 0===S?0:S;g.shop_id,u[c]=a({},h,{latestMessage:{},latestMessageStatus:"",unread_count:l?m:m+1}),l||0!==m||(d+=1)}})),t.next=13,(0,c.put)((0,i.batchUpdateRecord)({name:"conversations",records:u,checkProp:"latest_message_id"}));case 13:return t.next=15,(0,c.put)((0,i.updateUnreadCount)({type:i.unreadCountActions.MESSAGE_QUEUE_UPDATE,messageQueueUpdate:{totalIncrease:d}}));case 15:case"end":return t.stop()}}),r,t)}))(),"t0",9);case 9:r.next=0;break;case 11:case"end":return r.stop()}}),_,this)}function N(){var e=T.length,t=C.length;e&&T.splice(0,e),t&&C.splice(0,t)}function D(e){var t,r,n,o,s,u,d,l,p,v,h;return regeneratorRuntime.wrap((function(_){for(;;)switch(_.prev=_.next){case 0:if(!(t=C.filter((function(t){return t.conversation_id===e}))).length){_.next=12;break}return t.forEach((function(e){var t=C.findIndex((function(t){return t.id===e.id}));C.splice(t,1)})),r=t.sort((function(e,t){return t.latest_message_id-e.latest_message_id})),n=r[0],o=n.id,s=n.type,u=n.content,d=n.created_at,l=n.send_by_yourself,p=(0,f.getChatBotParams)(n,{updateMaxGeneralOptionHideTime:l}),v=(0,i.getCrmPreviewParams)(n),h=a({latest_message_id:o,latest_message_type:s,latest_message_content:u,last_message_time:d,latestMessage:{},latestMessageStatus:""},p,v),_.next=11,(0,c.put)((0,i.updateRecord)({name:"conversations",id:e,record:h}));case 11:return _.abrupt("return",o);case 12:return _.abrupt("return",null);case 13:case"end":return _.stop()}}),g,this)}function U(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.takeEvery)(y,M);case 2:return e.next=4,(0,c.takeEvery)(x,N);case 4:case"end":return e.stop()}}),S,this)}t.default=(l(n={},E,(function(e,t){var r,n=t.payload,o=n.conversationId,s=n.message,c=s.id,u=s.request_id,i=e.messageIdsHash,d=i[o]||{},f=d.all||[],p=d.sending||[];return r=f.includes(c)?f:[c].concat(f).filter((function(e){return e!==u})),a({},e,{messageIdsHash:a({},i,l({},o,a({},d,{all:r,sending:p.filter((function(e){return!p.includes(u)}))})))})})),l(n,O,(function(e,t){var r=t.payload.flag;return a({},e,{newMessageFlag:r})})),n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changeTranslateStatus=t.translateMessagesRequested=void 0,t.watchTranslate=g;var n=r(0),a=r(2),o=r(3),s=r(1),c=r(4),u=regeneratorRuntime.mark(h),i=regeneratorRuntime.mark(_),d=regeneratorRuntime.mark(g),f=(0,n.createActions)({TRANSLATE_MESSAGES_REQUESTED:function(e){return{messageId:e.messageId,text:e.text,toUserId:e.toUserId,shopId:e.shopId,from:e.from}},CHANGE_TRANSLATE_STATUS:function(e){return{messageId:e.messageId,status:e.status}}}),l=f.translateMessagesRequested,p=f.changeTranslateStatus;t.translateMessagesRequested=l,t.changeTranslateStatus=p;var v=function(e,t,r,n){var o="failed"!==n?t:{translateStatus:c.TranslationStatus.FAILED,content:{text:r,translation:{text:"",manual:n}}};return(0,a.put)((0,s.updateRecord)({name:"messages",id:e,record:o}))};function h(e){var t,r,n,s=e.payload,i=s.messageId,d=s.text,f=s.toUserId,l=s.shopId,p=s.from;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={translateStatus:c.TranslationStatus.PENDING},e.next=4,v(i,t);case 4:return e.next=6,(0,a.call)(o.fetch,{method:"POST",resource:"messages",suffix:"translate",payload:JSON.stringify({text:d,from:p,to_user_id:f,shop_id:l})});case 6:if(!(r=e.sent).text){e.next=13;break}return n={translateStatus:c.TranslationStatus.SUCCEED,content:{text:d,translation:r}},e.next=11,v(i,n);case 11:e.next=15;break;case 13:return e.next=15,v(i,null,d,"failed");case 15:e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(0),e.next=21,v(i,null,d,"failed");case 21:case"end":return e.stop()}}),u,this,[[0,17]])}function _(e){var t,r=e.payload,n=r.messageId,a=r.status;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={translateStatus:a},e.next=3,v(n,t);case 3:case"end":return e.stop()}}),i,this)}function g(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.takeEvery)(l,h);case 2:return e.next=4,(0,a.takeEvery)(p,_);case 4:case"end":return e.stop()}}),d,this)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleSensitiveUrl=void 0,t.watchHandle=f;var n=r(0),a=r(2),o=r(1),s=r(10),c=regeneratorRuntime.mark(d),u=regeneratorRuntime.mark(f),i=(0,n.createActions)({HANDLE_SENSITIVE_URL:function(e){return{href:e.href}}}).handleSensitiveUrl;function d(e){var t=e.payload.href;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.put)((0,o.showModal)({type:"CONFIRM_MODAL",title:{key:"common.navigation.cofirm_titile"},actions:{cancel:{label:{key:"common.cancel"},handler:function(){s.store.dispatch((0,o.closeModal)())}},confirm:{label:{key:"common.navigation.confirm"},handler:function(){s.store.dispatch((0,o.closeModal)()),window.open(t,"_blank")}}},additions:{content:{key:"common.navigation.cofirm_content"},modalStyle:{width:"352px"},contentStyle:{paddingTop:"8px",paddingBottom:"13px"}}}));case 2:case"end":return e.stop()}}),c,this)}function f(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.takeEvery)(i,d);case 2:case"end":return e.stop()}}),u,this)}t.handleSensitiveUrl=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setEntryPoint=void 0;var n,a,o,s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=(0,r(0).createActions)({SET_ENTRY_POINT:function(e){return{type:e.type,conversationId:e.conversationId}}}).setEntryPoint;t.setEntryPoint=c,t.default=(o=function(e,t){var r=t.payload;return s({},e,{entryPoint:r})},(a=c)in(n={})?Object.defineProperty(n,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[a]=o,n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a,o,s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=r(1);t.default=(n={},o=function(e,t){var r=t.payload.conversationId,n=e.messageIdsHash;return delete n[r],s({},e,{messageIdsHash:s({},n)})},(a=c.deleteConversationSucceeded)in n?Object.defineProperty(n,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[a]=o,n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(130);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(132);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.messageShortcutGroupReducer=t.watchMessageShortcutGroupSagas=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(131);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o,s=r(0),c=(o=a)&&o.__esModule?o:{default:o};t.watchMessageShortcutGroupSagas=[a.watchFetch],t.messageShortcutGroupReducer=(0,s.handleActions)(n({},c.default),{currentGroupType:1})},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.setCurrentGroupId=t.setCurrentGroupType=t.fetchMessageShortcutsGroupSucceeded=t.updateFetchMessageShortcutsGroupStatus=t.fetchMessageShortcutsGroupRequested=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.watchFetch=m;var o=r(0),s=r(2),c=r(3),u=r(4);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var d=regeneratorRuntime.mark(S),f=regeneratorRuntime.mark(m),l=(0,o.createActions)({FETCH_MESSAGE_SHORTCUTS_GROUP_REQUESTED:function(e){var t=e.shopId,r=e.groupType;return{shopId:t,groupType:void 0===r?1:r}},UPDATE_FETCH_MESSAGE_SHORTCUTS_GROUP_STATUS:function(e){return{groupType:e.groupType,status:e.status}},FETCH_MESSAGE_SHORTCUTS_GROUP_SUCCEEDED:function(e){return{groupType:e.groupType,groups:e.groups,status:e.status}},SET_CURRENT_GROUP_TYPE:function(e){return{currentGroupType:e.currentGroupType}},SET_CURRENT_GROUP_ID:function(e){return{groupType:e.groupType,currentGroupId:e.currentGroupId}}}),p=l.fetchMessageShortcutsGroupRequested,v=l.updateFetchMessageShortcutsGroupStatus,h=l.fetchMessageShortcutsGroupSucceeded,_=l.setCurrentGroupType,g=l.setCurrentGroupId;function S(e){var t,r,n,a,o=e.payload,i=o.shopId,f=o.groupType;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,s.put)(v({groupType:f,status:u.HttpStatus.INIT_PENDING}));case 3:return e.next=5,(0,c.fetch)({parent:"message_shortcuts",resource:"groups",params:{shop_id:i,group_type:f}});case 5:return t=e.sent,r=t.groups,n=(void 0===r?[]:r).filter((function(e){return"enabled"===e.state})),e.next=11,(0,s.put)(h({groupType:f,groups:n,status:u.HttpStatus.SUCCEED}));case 11:if(!(a=n?n[0]:null)){e.next=15;break}return e.next=15,(0,s.put)(g({groupType:f,currentGroupId:a.id}));case 15:e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(0),e.next=21,(0,s.put)(v({groupType:f,status:u.HttpStatus.INIT_FAILED}));case 21:case"end":return e.stop()}}),d,this,[[0,17]])}function m(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.takeEvery)(p,S);case 2:case"end":return e.stop()}}),f,this)}t.fetchMessageShortcutsGroupRequested=p,t.updateFetchMessageShortcutsGroupStatus=v,t.fetchMessageShortcutsGroupSucceeded=h,t.setCurrentGroupType=_,t.setCurrentGroupId=g,t.default=(i(n={},h,(function(e,t){var r=t.payload,n=r.groupType,o=r.groups,s=r.status;return a({},e,i({},n,{groups:o,status:s}))})),i(n,v,(function(e,t){var r=t.payload,n=r.groupType,o=r.status,s=e[n];return a({},e,i({},n,a({},s,{status:o})))})),i(n,_,(function(e,t){var r=t.payload.currentGroupType;return a({},e,{currentGroupType:r})})),i(n,g,(function(e,t){var r=t.payload,n=r.groupType,o=r.currentGroupId,s=e[n];return a({},e,i({},n,a({},s,{currentGroupId:o})))})),n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.currentAllMessageShortcutsSelector=t.teamMessageShortcutsSelector=t.personalMessageShortcutsSelector=t.messageShortcutsSelector=t.currentGroupIdSelector=t.messageShortcutHttpStatusSelector=t.messageShortcutGroupContentSelector=t.currentGroupTypeSelector=t.messageShortcutGroupSelector=void 0;var n=r(6),a=r(4);function o(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var s=t.messageShortcutGroupSelector=function(e){return e.messageShortcutGroupReducer},c=t.currentGroupTypeSelector=function(e){return e.messageShortcutGroupReducer.currentGroupType},u=t.messageShortcutGroupContentSelector=(0,n.createSelector)(s,c,(function(e,t){return e[t]||{groups:[],status:""}})),i=(t.messageShortcutHttpStatusSelector=(0,n.createSelector)(u,(function(e){return e.status})),t.currentGroupIdSelector=(0,n.createSelector)(u,(function(e){return e.currentGroupId})),t.messageShortcutsSelector=(0,n.createSelector)(u,(function(e){var t=e.groups,r=void 0===t?[]:t,n=e.currentGroupId,a=(r.find((function(e){return e.id===n}))||{}).message_shortcuts;return void 0===a?[]:a})),t.personalMessageShortcutsSelector=(0,n.createSelector)(s,(function(e){var t=(e[a.messageShortcutGroupType.PERSONAL]||{groups:[]}).groups;return(void 0===t?[]:t).reduce((function(e,t){var r=t.message_shortcuts,n=void 0===r?[]:r;return e.concat(n)}),[])}))),d=t.teamMessageShortcutsSelector=(0,n.createSelector)(s,(function(e){var t=(e[a.messageShortcutGroupType.TEAM]||{groups:[]}).groups;return(void 0===t?[]:t).reduce((function(e,t){var r=t.message_shortcuts,n=void 0===r?[]:r;return e.concat(n)}),[])}));t.currentAllMessageShortcutsSelector=(0,n.createSelector)(i,d,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[].concat(o(e),o(t))}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(134);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(135);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.distributionAccountStatusSelector=t.legacyMessageShortcutsCountSelector=t.messageShortcutsStatusSelector=t.messageTimeStyleSelector=t.autoTranslation=t.settingsTimestampSelector=t.settingsFetchStatusSelector=t.settingsStatusSelector=t.settingsNeedForceUpdateSelectors=t.settingsSelector=void 0;var n=r(6),a=t.settingsSelector=function(e){return e.settingsReducer.settings};t.settingsNeedForceUpdateSelectors=function(e){return e.settingsReducer.needForceUpdate},t.settingsStatusSelector=function(e){return e.settingsReducer.status},t.settingsFetchStatusSelector=function(e){return e.settingsReducer.fetchStatus},t.settingsTimestampSelector=function(e){return e.settingsReducer.timestamp||0},t.autoTranslation=(0,n.createSelector)(a,(function(e){return e.auto_translation_status||""})),t.messageTimeStyleSelector=(0,n.createSelector)(a,(function(e){return e.show_msg_time||"enabled"})),t.messageShortcutsStatusSelector=(0,n.createSelector)(a,(function(e){return e.message_shortcuts_status||""})),t.legacyMessageShortcutsCountSelector=(0,n.createSelector)(a,(function(e){return e.legacy_message_shortcuts_count||0})),t.distributionAccountStatusSelector=(0,n.createSelector)(a,(function(e){return e.distribution_account_status||"enabled"}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.settingsReducer=t.watchSettingsSagas=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(136);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o,s=r(0),c=(o=a)&&o.__esModule?o:{default:o};t.watchSettingsSagas=[a.watchFetchSetting],t.settingsReducer=(0,s.handleActions)(n({},c.default),{settings:{},fetchStatus:""})},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.fetchSettingsStatus=t.fetchSettingsSucceeded=t.fetchSettingsRequested=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.fetchSettings=g,t.watchFetchSetting=S;var o=r(0),s=r(2),c=r(3),u=r(4),i=r(1);function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var f=regeneratorRuntime.mark(g),l=regeneratorRuntime.mark(S),p=(0,o.createActions)({FETCH_SETTINGS_REQUESTED:function(){return{}},FETCH_SETTINGS_SUCCEEDED:function(e){return{settings:e.settings,fetchStatus:e.fetchStatus,timestamp:e.timestamp,needForceUpdate:e.needForceUpdate}},FETCH_SETTINGS_STATUS:function(e){return{fetchStatus:e.fetchStatus}}}),v=p.fetchSettingsRequested,h=p.fetchSettingsSucceeded,_=p.fetchSettingsStatus;function g(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,s.put)(_({fetchStatus:u.HttpStatus.PENDING}));case 3:return t.next=5,(0,s.select)(i.settingsNeedForceUpdateSelectors);case 5:return t.sent,t.next=8,(0,s.call)(c.fetch,{parent:"user",resource:"setting",params:{}});case 8:return e=t.sent,t.next=11,(0,s.put)(h({settings:e,fetchStatus:u.HttpStatus.SUCCEED,timestamp:Date.now(),needForceUpdate:!1}));case 11:return t.abrupt("return",e);case 14:return t.prev=14,t.t0=t.catch(0),t.next=18,(0,s.put)(_({fetchStatus:u.HttpStatus.FAILED}));case 18:return t.abrupt("return",{});case 19:case"end":return t.stop()}}),f,this,[[0,14]])}function S(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.takeLatest)([v],g);case 2:case"end":return e.stop()}}),l,this)}t.fetchSettingsRequested=v,t.fetchSettingsSucceeded=h,t.fetchSettingsStatus=_,t.default=(d(n={},h,(function(e,t){var r=t.payload,n=r.settings,o=r.fetchStatus,s=r.timestamp,c=r.needForceUpdate;return a({},e,{settings:n,fetchStatus:o,timestamp:s,needForceUpdate:c})})),d(n,_,(function(e,t){var r=t.payload.fetchStatus;return a({},e,{fetchStatus:r})})),n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateConversationListsHash=t.handle401ErrorRequested=void 0;var n=r(0),a=(0,n.createActions)({HANDLE_401_ERROR_REQUESTED:function(e){return{resource:e.resource}}}).handle401ErrorRequested;t.handle401ErrorRequested=a;var o=(0,n.createActions)({UPDATE_CONVERSATION_LISTS_HASH:function(){return{}}}).updateConversationListsHash;t.updateConversationListsHash=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(139);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(142);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.watchVoucherSagas=void 0;var n=r(140);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(141);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})),r(0),t.watchVoucherSagas=[n.watchClaimVoucher]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.claimVoucherRequested=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.watchClaimVoucher=l;var a=r(0),o=r(2),s=r(1),c=r(3),u=regeneratorRuntime.mark(f),i=regeneratorRuntime.mark(l),d=(0,a.createActions)({CLAIM_VOUCHER_REQUESTED:function(e){return{shopId:e.shopId,voucherId:e.voucherId,voucherCode:e.voucherCode,messageId:e.messageId,isWebview:e.isWebview,source:e.source}}}).claimVoucherRequested;function f(e){var t,r,a,i,d,f,l=e.payload,p=l.shopId,v=l.voucherId,h=l.voucherCode,_=l.messageId,g=l.isWebview,S=l.source;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.select)((0,s.getMessageSelector)(_));case 2:return t=e.sent,r=t.textContent,e.prev=4,e.next=7,(0,o.call)(c.fetch,{ssl:!0,method:"PUT",resource:"vouchers",suffix:"claim",payload:JSON.stringify({shop_id:p,voucher_code:h,source:S,id:v})});case 7:return e.next=9,(0,o.put)((0,s.updateRecord)({name:"vouchers",id:v,record:{claimed:!0}}));case 9:if(g){e.next=12;break}return e.next=12,(0,o.put)((0,s.updateRecord)({name:"messages",id:_,record:{textContent:n({},r,{claimed:!0})}}));case 12:return a=(0,s.getToastInformation)(!0,{type:"claim-voucher"}),e.next=15,(0,o.put)((0,s.setToastInformation)({toast:a}));case 15:e.next=40;break;case 17:if(e.prev=17,e.t0=e.catch(4),!(i=e.t0.message&&e.t0.message.error_code)){e.next=37;break}d=void 0,e.t1=i,e.next="voucher_expired"===e.t1?25:"voucher_stock_out"===e.t1?27:"voucher_already_claimed"===e.t1?29:31;break;case 25:return d={status:"finished"},e.abrupt("break",31);case 27:return d={stock_out:!0},e.abrupt("break",31);case 29:return d={claimed:!0},e.abrupt("break",31);case 31:if(!d){e.next=37;break}return e.next=34,(0,o.put)((0,s.updateRecord)({name:"vouchers",id:v,record:n({},d)}));case 34:if(g){e.next=37;break}return e.next=37,(0,o.put)((0,s.updateRecord)({name:"messages",id:_,record:{textContent:n({},r,d)}}));case 37:return f=(0,s.getToastInformation)(!1,{type:"claim-voucher"}),e.next=40,(0,o.put)((0,s.setToastInformation)({toast:f}));case 40:case"end":return e.stop()}}),u,this,[[4,17]])}function l(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.takeLatest)(d,f);case 2:case"end":return e.stop()}}),i,this)}t.claimVoucherRequested=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showVoucher=i;var n,a=r(1),o=r(2),s=(n=r(5))&&n.__esModule?n:{default:n},c=r(3),u=regeneratorRuntime.mark(i);function i(e){var t,r,n,i,d,f,l,p=e.shopId,v=e.ids;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,v=v.map((function(e){return parseInt(e)})),e.next=4,(0,o.select)(a.currentUserIdSelector);case 4:return t=e.sent,e.next=7,(0,o.select)(a.isSubAccountSelector);case 7:return r=e.sent,n="vouchers_by_ids",e.next=11,(0,o.call)(c.fetch,{ssl:!0,parent:"vouchers",resource:n,params:{ids:JSON.stringify(v),shop_id:p,buyer_id:r?0:t}});case 11:if(i=e.sent,!(d=i[n])||!d.length){e.next=21;break}return d.forEach((function(e){return e.fetchStatus="done"})),f=(0,s.default)("vouchers",d),l=f.entities,e.next=18,(0,o.put)((0,a.updateEntities)({entities:l}));case 18:return e.abrupt("return",d);case 21:return e.abrupt("return",v.map((function(e){return{id:e,fetchStatus:""}})));case 22:e.next=27;break;case 24:return e.prev=24,e.t0=e.catch(0),e.abrupt("return",v.map((function(e){return{id:e,fetchStatus:""}})));case 27:case"end":return e.stop()}}),u,this,[[0,24]])}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.voucherSelector=t.vouchersSelector=t.voucherHttpStatusSelector=t.voucherIdsSelector=void 0;var n=r(7),a=r(6),o=r(1),s=r(5),c=t.voucherIdsSelector=function(e){return e.voucherReducer.voucherIds};t.voucherHttpStatusSelector=function(e){return e.voucherReducer.status},t.vouchersSelector=(0,a.createSelector)(o.voucherEntitiesSelector,c,(function(e,t){return((0,n.denormalize)(t,[s.vouchersSchema],{vouchers:e})||[]).filter((function(e){return e}))})),t.voucherSelector=function(e){return(0,a.createSelector)(o.voucherEntitiesSelector,(function(t){return(0,n.denormalize)(e,s.vouchersSchema,{vouchers:t})||{}}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(144);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(145);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})),t.showProduct=f;var o,s=r(2),c=r(3),u=(o=r(5))&&o.__esModule?o:{default:o},i=r(1),d=regeneratorRuntime.mark(f);function f(e){var t,r,n,o=e.payload,f=o.productId,l=o.shopId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,s.call)(c.fetch,{resource:"products",id:f,params:{shop_id:l,need_cache:1,cache_expires:600},cleaner:a.productCleaner});case 3:return t=e.sent,r=(0,u.default)("products",t),n=r.entities,e.next=7,(0,s.put)((0,i.updateEntities)({entities:n}));case 7:return e.abrupt("return",t);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",{});case 13:case"end":return e.stop()}}),d,this,[[0,10]])}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.productsSelector=void 0;var n=r(6),a=r(1),o=r(5),s=r(7);t.productsSelector=function(e){return(0,n.createSelector)(a.productEntitiesSelector,(function(t){return(0,s.denormalize)(e,[o.productSchema],{products:t})}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.productCleaner=void 0;var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var s,c=e[Symbol.iterator]();!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(4),s=(t.productCleaner=function(e,t){return a({},e,s(e,t))},function(e,t){var r=e.original_prices,a=e.actual_prices,s=r.map((function(r){return(0,o.formatPrice)(r,e.country,{},t)})),c=n(s,2),u=c[0],i=c[1],d=a.map((function(r){return(0,o.formatPrice)(r,e.country,{},t)})),f=n(d,2),l=f[0],p=f[1],v=u===i?u:u+" - "+i,h=l===p?l:l+" - "+p;return{original_price_string:v===h?"":v,actual_price_string:h,storedTimestamp:Date.now()}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(147);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showOrder=f,t.showUnrateOrder=l;var n,a=(n=r(5))&&n.__esModule?n:{default:n},o=r(3),s=r(148),c=r(2),u=r(1),i=regeneratorRuntime.mark(f),d=regeneratorRuntime.mark(l);function f(e){var t,r,n,d,f=e.payload,l=f.orderId,p=f.shopId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,c.call)(o.fetch,{resource:"order",id:l,params:{shop_id:p}});case 3:return t=e.sent,e.next=6,(0,c.select)((0,s.orderSelector)(l));case 6:return(r=e.sent)&&r.status&&(t.status=r.status),n=(0,a.default)("orders",t),d=n.entities,e.next=11,(0,c.put)((0,u.updateEntities)({entities:d}));case 11:return e.abrupt("return",t);case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",{});case 17:case"end":return e.stop()}}),i,this,[[0,14]])}function l(e){var t,r,n,i,f=e.payload,l=f.orderId,p=f.shopId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,c.select)((0,s.orderSelector)(l));case 3:if(!(t=e.sent)){e.next=6;break}return e.abrupt("return",t);case 6:return e.next=8,(0,c.call)(o.fetch,{resource:"order",id:l,params:{shop_id:p}});case 8:return r=e.sent,t&&t.status&&(r.status=t.status),n=(0,a.default)("orders",r),i=n.entities,e.next=13,(0,c.put)((0,u.updateEntities)({entities:i}));case 13:return e.abrupt("return",r);case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",{});case 19:case"end":return e.stop()}}),d,this,[[0,16]])}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.orderSelector=void 0;var n=r(6),a=r(5),o=r(1),s=r(7);t.orderSelector=function(e){return(0,n.createSelector)(o.orderEntitiesSelector,(function(t){return(0,s.denormalize)(e,a.orderSchema,{orders:t})}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(150);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(151);Object.defineProperty(t,"showFaqHistory",{enumerable:!0,get:function(){return n.showFaqHistory}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showFaqHistory=c;var n=r(1),a=r(3),o=r(2),s=regeneratorRuntime.mark(c);function c(e){var t,r,c,u,i=e.payload,d=i.ids,f=i.id;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,o.select)(n.currentConversationSelector);case 3:return t=e.sent,r=t.shop_id,e.next=7,(0,o.call)(a.fetch,{parent:"conversation",resource:"messages",params:{ids:"["+d.join(",")+"]",shop_id:r}});case 7:return c=e.sent,u=c.messages,e.abrupt("return",{id:f,messages:u});case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",{id:f,error:!0});case 15:case"end":return e.stop()}}),s,this,[[0,12]])}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showCartReminder=s;var n=r(3),a=r(2),o=regeneratorRuntime.mark(s);function s(e){var t,r,s,c=e.id,u=e.cartItems;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,a.call)(n.fetch,{parent:"product",resource:"get",method:"POST",payload:JSON.stringify({items:u.slice(0,4)})});case 3:return t=e.sent,r=t.get,s=void 0===r?[]:r,e.abrupt("return",{id:c,result:s});case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",{id:c,fetchStatus:"failed"});case 12:case"end":return e.stop()}}),o,this,[[0,9]])}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(154);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(155);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.feedStorySelector=void 0;var n=r(7),a=r(6),o=r(1),s=r(5);t.feedStorySelector=function(e){return(0,a.createSelector)(o.entitiesSelector,(function(t){return(0,n.denormalize)(e,s.feedStorySchema,t)}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showFeedStory=i;var n,a=(n=r(5))&&n.__esModule?n:{default:n},o=r(3),s=r(2),c=r(1),u=regeneratorRuntime.mark(i);function i(e){var t,r,n,i,d,f,l=e.payload,p=l.id,v=l.creatorId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.select)(c.currentConversationSelector);case 2:return t=e.sent,r=t.shop_id,e.prev=4,e.next=7,(0,s.call)(o.fetch,{parent:"feed",resource:"stories",params:{ids:JSON.stringify([p]),creator:v,shop_id:r,need_cache:1,cache_expire:1800}});case 7:return n=e.sent,i=n.stories[0],d=(0,a.default)("feedStories",i),f=d.entities,e.next=12,(0,s.put)((0,c.updateEntities)({entities:f}));case 12:return e.abrupt("return",i);case 15:return e.prev=15,e.t0=e.catch(4),e.abrupt("return",{});case 18:case"end":return e.stop()}}),u,this,[[4,15]])}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(157);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rateCardSelector=void 0;var n=r(7),a=r(6),o=r(5),s=r(1);t.rateCardSelector=function(e){return(0,a.createSelector)(s.rateCardEntitiesSelector,(function(t){return(0,n.denormalize)(e,o.rateCardsSchema,{rateCards:t})}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(159);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(160);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.currentBuyerOffersSelector=t.currentOfferPaginationSelector=t.currentOffersFetchResultSelector=t.offerFetchResultSelector=t.offerSelector=t.relatedOfferIdsSelector=t.offersSelector=t.currentPendingOffersCountSelector=t.pendingOffersCountSelector=t.offerHttpStatusSelector=void 0;var n=r(6),a=r(1),o=r(7),s=r(5),c={currentPage:0,perPage:20,total:0,hasMore:!0},u=(t.offerHttpStatusSelector=function(e){return e.offerReducer.status},t.pendingOffersCountSelector=function(e){return e.offerReducer.pendingOffersCount}),i=(t.currentPendingOffersCountSelector=(0,n.createSelector)(a.currentConversationSelector,u,(function(e,t){return t[e.shop_id+"_"+e.to_id]||0})),t.offersSelector=(0,n.createSelector)(a.entitiesSelector,(function(e){return e.offers||{}}))),d=(t.relatedOfferIdsSelector=function(e,t,r,a){return(0,n.createSelector)(i,(function(n){return Object.values(n).filter((function(n){return n.product_id===a&&n.model_id===t&&n.conversation_id===e&&n.id!==r&&"pending"===n.status}))}))},t.offerSelector=function(e){return(0,n.createSelector)(a.entitiesSelector,(function(t){return(0,o.denormalize)(e,s.offerSchema,t)}))},t.offerFetchResultSelector=function(e){return e.offerReducer.fetchResult});t.currentOffersFetchResultSelector=function(e,t){return(0,n.createSelector)(d,(function(r){return r[e+"_"+t]||{pagination:c,result:[]}}))},t.currentOfferPaginationSelector=(0,n.createSelector)(d,a.currentConversationSelector,(function(e,t){var r=e[t.shop_id+"_"+t.to_id];return r?r.pagination:c})),t.currentBuyerOffersSelector=(0,n.createSelector)(d,a.currentConversationSelector,a.entitiesSelector,(function(e,t,r){var n=e[t.shop_id+"_"+t.to_id];if(!n)return[];var a=n.result||[];return(0,o.denormalize)(a,[s.offerSchema],r).filter((function(e){return e}))}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.offerReducer=t.watchOfferSagas=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(161);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o=r(162);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}));var s=r(163);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})}));var c,u=r(0),i=(c=a)&&c.__esModule?c:{default:c};t.watchOfferSagas=[a.watchFetchOffer,o.watchReply],t.offerReducer=(0,u.handleActions)(n({},i.default),{status:"",fetchResult:{},pendingOffersCount:{},pendingOfferIdsHash:{}})},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.getPendingOffersCountSucceed=t.getPendingOffersCountRequested=t.updateFetchOffersRequestedStatus=t.fetchOffersSucceed=t.fetchOffersRequested=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.fetchOffers=E,t.getPendingOffersCount=O,t.watchFetchOffer=R;var o,s=r(0),c=r(2),u=r(1),i=(o=r(5))&&o.__esModule?o:{default:o},d=r(3),f=r(4);function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var p=regeneratorRuntime.mark(E),v=regeneratorRuntime.mark(O),h=regeneratorRuntime.mark(R),_=(0,s.createActions)({FETCH_OFFERS_REQUESTED:function(e){return{shopId:e.shopId,buyerId:e.buyerId,reset:e.reset}},FETCH_OFFERS_SUCCEED:function(e){var t=e.shopId,r=e.buyerId,n=e.pagination,a=e.result,o=e.status;return{shopId:t,buyerId:r,pagination:n,result:a,status:void 0===o?f.HttpStatus.SUCCEED:o}},UPDATE_FETCH_OFFERS_REQUESTED_STATUS:function(e){return{status:e.status}},GET_PENDING_OFFERS_COUNT_REQUESTED:function(e){return{shopId:e.shopId,buyerId:e.buyerId}},GET_PENDING_OFFERS_COUNT_SUCCEED:function(e){return{shopId:e.shopId,buyerId:e.buyerId,count:e.count}}}),g=_.fetchOffersRequested,S=_.fetchOffersSucceed,m=_.updateFetchOffersRequestedStatus,b=_.getPendingOffersCountRequested,y=_.getPendingOffersCountSucceed;function E(e){var t,r,n,o,s,l,v,h,_,g,b,y,E,O,R,k,x,w,I,T,C,P,M,j=e.payload,A=j.shopId,N=j.buyerId,D=j.reset;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t={},r=[],D){e.next=9;break}return e.next=6,(0,c.select)((0,u.currentOffersFetchResultSelector)(A,N));case 6:n=e.sent,t=n.pagination,r=n.result;case 9:if(s=(o=t).currentPage,l=void 0===s?0:s,v=o.perPage,h=void 0===v?10:v,void 0!==(_=o.hasMore)&&!_){e.next=53;break}if(!D){e.next=16;break}return e.next=14,(0,c.put)(S({shopId:A,buyerId:N,result:r,pagination:t,status:f.HttpStatus.INIT_PENDING}));case 14:e.next=18;break;case 16:return e.next=18,(0,c.put)(m({status:f.HttpStatus.PENDING}));case 18:return b={page:g=D?1:l+1,per_page:h,buyer_id:N,shop_id:A},e.next=22,(0,c.call)(d.fetch,{ssl:!0,resource:"offer",suffix:"given",params:b});case 22:if(y=e.sent,E=y.total,O=y.offer,k=null,x=null,!(w=(R=void 0===O?[]:O).length)){e.next=49;break}return R=R.map((function(e){return a({},e,{product:e.product_id})})),I=Array.from(new Set(R.map((function(e){return e.product_id})))),e.prev=32,e.next=35,(0,c.call)(u.showProducts,{payload:{productIds:I,shopId:A}});case 35:e.next=42;break;case 37:return e.prev=37,e.t0=e.catch(32),T=I.map((function(e){return(0,c.call)(u.showProduct,{payload:{productId:e,shopId:A}})})),e.next=42,(0,c.all)(T);case 42:return C=(0,i.default)("offers",R),P=C.entities,M=C.result,e.next=45,(0,c.put)((0,u.updateEntities)({entities:P}));case 45:k={currentPage:g,perPage:h,total:E,hasMore:w>=h},x=D?M:r.concat(M),e.next=51;break;case 49:k={currentPage:g,perPage:h,total:E,hasMore:!1},x=r;case 51:return e.next=53,(0,c.put)(S({shopId:A,buyerId:N,result:x,status:f.HttpStatus.SUCCEED,pagination:k}));case 53:e.next=59;break;case 55:return e.prev=55,e.t1=e.catch(0),e.next=59,(0,c.put)(m({status:D?f.HttpStatus.INIT_FAILED:f.HttpStatus.FAILED}));case 59:case"end":return e.stop()}}),p,this,[[0,55],[32,37]])}function O(e){var t,r,n=e.payload,a=n.shopId,o=n.buyerId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,c.call)(d.fetch,{parent:"offer",resource:"count",params:{shop_id:a,buyer_id:o}});case 3:return t=e.sent,r=t.pending_count,e.next=7,(0,c.put)(y({shopId:a,buyerId:o,count:r}));case 7:e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(0),e.next=13,(0,c.put)(y({shopId:a,buyerId:o,count:0}));case 13:case"end":return e.stop()}}),v,this,[[0,9]])}function R(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.takeEvery)(g,E);case 2:return e.next=4,(0,c.takeEvery)(b,O);case 4:case"end":return e.stop()}}),h,this)}t.fetchOffersRequested=g,t.fetchOffersSucceed=S,t.updateFetchOffersRequestedStatus=m,t.getPendingOffersCountRequested=b,t.getPendingOffersCountSucceed=y,t.default=(l(n={},S,(function(e,t){var r=t.payload,n=r.shopId,o=r.buyerId,s=r.pagination,c=r.result,u=r.status,i=n+"_"+o;return a({},e,{status:u,fetchResult:a({},e.fetchResult,l({},i,{pagination:s,result:c}))})})),l(n,m,(function(e,t){var r=t.payload.status;return a({},e,{status:r})})),l(n,y,(function(e,t){var r=t.payload,n=r.shopId,o=r.buyerId,s=r.count,c=n+"_"+o;return a({},e,{pendingOffersCount:a({},e.pendingOffersCount,l({},c,s))})})),n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.replyOfferRequested=void 0,t.watchReply=f;var n=r(0),a=r(2),o=r(3),s=(r(4),r(1)),c=regeneratorRuntime.mark(d),u=regeneratorRuntime.mark(f),i=(0,n.createActions)({REPLY_OFFER_REQUESTED:function(e){return{offerId:e.offerId,shopId:e.shopId,isAccept:e.isAccept,messageId:e.messageId}}}).replyOfferRequested;function d(e){var t,r=e.payload,n=r.offerId,u=r.shopId,i=r.isAccept,d=r.messageId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,a.select)(s.currentConversationSelector);case 3:if("closed"===e.sent.status){e.next=10;break}return t={status:i?"accepted":"rejected",shop_id:u},d&&(t.message_id=d),e.next=10,(0,a.call)(o.fetch,{method:"PUT",resource:"offers",id:n,suffix:"reply",payload:JSON.stringify(t)});case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(0),e.next=16,(0,a.put)((0,s.showOperationFailureToastRequested)({error:e.t0}));case 16:case"end":return e.stop()}}),c,this,[[0,12]])}function f(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.takeEvery)(i,d);case 2:case"end":return e.stop()}}),u,this)}t.replyOfferRequested=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.showOffer=d;var a,o=(a=r(5))&&a.__esModule?a:{default:a},s=r(3),c=r(1),u=r(2),i=regeneratorRuntime.mark(d);function d(e){var t,r,a,d,f=e.payload,l=f.offerId,p=f.shopId;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,u.select)((0,c.offerSelector)(l));case 3:if(!(t=e.sent)){e.next=6;break}return e.abrupt("return",t);case 6:return e.next=8,(0,u.call)(s.fetch,{resource:"offers",id:l,params:{shop_id:p}});case 8:return t=e.sent,r=n({},t,{product:t.product_id}),a=(0,o.default)("offers",r),d=a.entities,e.next=13,(0,u.put)((0,c.updateEntities)({entities:d}));case 13:return e.abrupt("return",r);case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",{});case 19:case"end":return e.stop()}}),i,this,[[0,16]])}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(165);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(166);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showLoadingSucceeded=void 0;var n=(0,r(0).createActions)({SHOW_LOADING_SUCCEEDED:function(e){var t=e.loading;return{loading:void 0!==t&&t}}}).showLoadingSucceeded;t.showLoadingSucceeded=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reduxReset=void 0;var n=(0,r(0).createActions)({REDUX_RESET:function(){return{}}}).reduxReset;t.reduxReset=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(169);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var a=r(172);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})),Object.defineProperty(t,"draftReducer",{enumerable:!0,get:function(){return(e=n,e&&e.__esModule?e:{default:e}).default;var e}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(170);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o=r(171);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}));var s=r(0),c=i(a),u=i(o);function i(e){return e&&e.__esModule?e:{default:e}}t.default=(0,s.handleActions)(n({},u.default,c.default),{draftHash:{}})},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.batchRemoveDraft=t.removeAllDraft=t.removeSingleDraft=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=(0,r(0).createActions)({REMOVE_SINGLE_DRAFT:function(e){return{conversationId:e.conversationId}},REMOVE_ALL_DRAFT:function(){return{}},BATCH_REMOVE_DRAFT:function(e){return{conversationIds:e.conversationIds}}}),c=s.removeSingleDraft,u=s.removeAllDraft,i=s.batchRemoveDraft;t.removeSingleDraft=c,t.removeAllDraft=u,t.batchRemoveDraft=i,t.default=(o(n={},c,(function(e,t){var r=t.payload.conversationId,n=a({},e.draftHash);return delete n[r],a({},e,{draftHash:n})})),o(n,u,(function(e){return a({},e,{draftHash:{}})})),o(n,i,(function(e,t){var r=t.payload.conversationIds,n=void 0===r?[]:r,o=a({},e.draftHash);return n.forEach((function(e){delete o[e]})),a({},e,{draftHash:o})})),n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.saveDraft=void 0;var n,a,o,s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=(0,r(0).createActions)({SAVE_DRAFT:function(e){return{conversationId:e.conversationId,draft:e.draft}}}).saveDraft;t.saveDraft=c,t.default=(o=function(e,t){var r=t.payload,n=r.conversationId,a=r.draft,o=e.draftHash;return o[n]=a,s({},e,{draftHash:o})},(a=c)in(n={})?Object.defineProperty(n,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[a]=o,n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.currentDraftSelector=t.draftHashSelector=void 0;var n=r(6),a=r(1),o=t.draftHashSelector=function(e){return e.draftReducer.draftHash};t.currentDraftSelector=(0,n.createSelector)(a.currentConversationIdSelector,o,(function(e,t){return t[e]}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.watchSocketSagas=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(174);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}));var o=r(25);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}));var s=r(26);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})}));var c=r(177);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})}));var u=v(a),i=v(s),d=v(o),f=r(178),l=r(179),p=r(0);function v(e){return e&&e.__esModule?e:{default:e}}t.watchSocketSagas=[a.watchFeedback,l.watchHeartBeatEmit,o.watchChannel,f.watchCSChatChannel,f.watchCSChatReconnect,c.watchSCRedirect],t.default=(0,p.handleActions)(n({},u.default,i.default,d.default),{feedback:null,reconnectFlag:!1,noticesCount:0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.feedbackSucceeded=t.feedbackRequested=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.watchFeedback=h;var a,o,s,c=r(0),u=r(2),i=regeneratorRuntime.mark(v),d=regeneratorRuntime.mark(h),f=(0,c.createActions)({FEEDBACK_REQUESTED:function(e){return{feedback:e.feedback}},FEEDBACK_SUCCEEDED:function(e){return{feedback:e.feedback}}}),l=f.feedbackRequested,p=f.feedbackSucceeded;function v(e){var t=e.payload.feedback;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.put)(p({feedback:t}));case 2:return e.next=4,(0,u.delay)(2500);case 4:return e.next=6,(0,u.put)(p({feedback:void 0}));case 6:case"end":return e.stop()}}),i,this)}function h(){var e,t,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,u.actionChannel)(l);case 2:e=n.sent;case 3:return n.next=6,(0,u.take)(e);case 6:return t=n.sent,r=t.payload,n.next=10,(0,u.call)(v,{payload:r});case 10:n.next=3;break;case 12:case"end":return n.stop()}}),d,this)}t.feedbackRequested=l,t.feedbackSucceeded=p,t.default=(s=function(e,t){var r=t.payload.feedback;return n({},e,{feedback:r})},(o=p)in(a={})?Object.defineProperty(a,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[o]=s,a)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUpdateAction=void 0,t.handleSubscribe=p;var n=r(1),a=r(3),o=r(4),s=r(2),c=r(22),u=r(176),i=regeneratorRuntime.mark(l),d=regeneratorRuntime.mark(p),f=t.getUpdateAction=function(e,t){var r=t.conversation,a=t.read,o=t.pinned,s=t.offer,c=t.status,u=t.userId,i=t.flag,d=t.cardId,f=void 0,l=void 0;switch(e){case"conversations":f=i?{flag:i}:c?{status:c}:a?{last_read_message_id:r.latest_message_id,unread_count:0}:{unread_count:r.unread_count+1},void 0!==o&&(f={pinned:o}),l=r.id;break;case"offers":f={status:c},l=s.id;break;case"users":f={distribution_status:c},l=u;break;case"rateCards":f={status:c},l=d}return(0,n.updateRecord)({name:e,id:l,record:f})};function l(e){var t,r,n;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,o.getItem)(e);case 2:(t=s.sent)&&(r=new Date,n=r-t,(0,a.collectAsyncTask)(a.ReportPoint.MESSAGE_SOCKET,n),(0,o.removeItem)(e));case 4:case"end":return s.stop()}}),i,this)}function p(e){var t,r,o,i,p,v,h,_,g,S,m,b,y,E,O,R,k,x,w,I,T,C,P,M,j,A,N,D,U,L,q,F,G,H,V,B,W,Q,Y,K,J,z,X,Z,$,ee,te=e.type,re=e.payload;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.select)(n.currentUserIdSelector);case 2:return t=e.sent,e.next=5,(0,s.select)(n.currentConversationIdSelector);case 5:if(r=e.sent,"notification"!==te){e.next=237;break}if(o=re.type,i=re.content,p=i.shop_id,v=i.request_id,h=i.conversation_id,_=i.conversation_ids,g=void 0===_?[]:_,S=i.offer_id,m=i.status,b=i.flag,y=i.card_id,E=re.user_id,O=void 0,R=void 0,!h){e.next=19;break}return e.next=12,(0,s.select)(n.conversationsSelector);case 12:if(e.t1=function(e){return e.id===h},e.t0=e.sent.find(e.t1),e.t0){e.next=16;break}e.t0=null;case 16:O=e.t0,e.next=26;break;case 19:if(!S){e.next=26;break}return e.t2=n.offersSelector,e.next=23,(0,s.select)((function(e){return e}));case 23:e.t3=e.sent,e.t4=S,R=(0,e.t2)(e.t3)[e.t4];case 26:return k=O&&t===E,e.next=29,(0,s.select)(n.filterSelector);case 29:x=e.sent,w="Unread"===x,e.t5=o,e.next=e.t5===u.notificationTypes.MARK_AS_READ?34:e.t5===u.notificationTypes.MARK_AS_UNREAD?63:e.t5===u.notificationTypes.DELETE_CONVERSATION?83:e.t5===u.notificationTypes.UPDATE_OFFER_STATUS?103:e.t5===u.notificationTypes.UPDATE_CONVERSATION?107:e.t5===u.notificationTypes.UPDATE_USER_STATUS?128:e.t5===u.notificationTypes.UPDATE_CONVERSATION_FLAG?133:e.t5===u.notificationTypes.FORCE_LOGOUT?138:e.t5===u.notificationTypes.UPDATE_RATING_CARD_STATUS?141:e.t5===u.notificationTypes.PIN_CONVERSATION?144:e.t5===u.notificationTypes.UNPIN_CONVERSATION?147:e.t5===u.notificationTypes.MASS_READ?153:e.t5===u.notificationTypes.MASS_UNREAD?163:e.t5===u.notificationTypes.MASS_PIN?173:e.t5===u.notificationTypes.MASS_UNPIN?179:e.t5===u.notificationTypes.MASS_ACTIVATE?185:e.t5===u.notificationTypes.MASS_CLOSE?223:235;break;case 34:if(!k){e.next=62;break}return e.next=37,(0,s.select)((function(e){return e.conversationReducer}));case 37:return I=e.sent,T=I.conversationMark,C="api"===T[h],e.next=42,(0,s.put)((0,n.markMessagesSucceed)({conversationId:h,markType:C?"":"socket"}));case 42:return e.next=44,(0,s.select)(n.readRequestIdsSelector);case 44:if(P=e.sent,-1===(M=P.findIndex((function(e){return e===v})))){e.next=55;break}return(0,a.collectAsyncTask)(a.ReportPoint.READ_SOCKET,Date.now()-v),e.next=50,(0,s.select)(n.missedReadNoticeCountSelector);case 50:return j=e.sent,M>0&&(j+=M),P=P.slice(M+1),e.next=55,(0,s.put)((0,n.updateReadRequestData)({requestIds:P,count:j}));case 55:if(C){e.next=62;break}if(!O.unread_count){e.next=62;break}return e.next=60,(0,s.put)(f("conversations",{conversation:O,read:!0}));case 60:return e.next=62,(0,s.put)((0,n.updateUnreadCount)({type:n.unreadCountActions.MARK_AS_READ,conversation:O}));case 62:return e.abrupt("break",235);case 63:if(!w){e.next=74;break}return e.t7=n.conversationsSelector,e.next=67,(0,s.select)((function(e){return e}));case 67:if(e.t8=e.sent,e.t9=function(e){return e.id===h},e.t6=(0,e.t7)(e.t8).find(e.t9),e.t6){e.next=72;break}e.t6=null;case 72:O=e.t6,k=O&&t===E;case 74:if(e.t10=k&&0===O.unread_count,!e.t10){e.next=78;break}return e.next=78,(0,s.put)(f("conversations",{conversation:O,read:!1}));case 78:if(e.t11=k,!e.t11){e.next=82;break}return e.next=82,(0,s.put)((0,n.updateUnreadCount)({type:n.unreadCountActions.MARK_AS_UNREAD,conversation:O}));case 82:return e.abrupt("break",235);case 83:if(!k){e.next=96;break}return e.next=86,(0,s.put)((0,n.removeSingleDraft)({conversationId:h}));case 86:return e.next=88,(0,s.put)((0,c.deleteConversationSucceeded)({conversationId:h}));case 88:return e.next=90,(0,s.put)((0,n.deleteRecord)({name:"conversations",id:h}));case 90:return e.next=92,(0,s.select)(n.conversationIdsSelector);case 92:if(!(e.sent.length<20)){e.next=96;break}return e.next=96,(0,s.put)((0,n.fetchConversationsRequested)({direction:"older"}));case 96:if(A=O,e.t12=A,!e.t12){e.next=102;break}return e.next=102,(0,s.put)((0,n.updateUnreadCount)({type:n.unreadCountActions.DELETE_CONVERSATION,conversation:O}));case 102:return e.abrupt("break",235);case 103:if(!R||!m||"pending"===m){e.next=106;break}return e.next=106,(0,s.put)(f("offers",{offer:R,status:m}));case 106:return e.abrupt("break",235);case 107:if(!k){e.next=127;break}return N=O.shop_id,e.next=111,(0,s.put)(f("conversations",{conversation:O,status:m}));case 111:if("closed"!==m){e.next=120;break}return e.next=114,(0,s.put)((0,n.removeSingleDraft)({conversationId:h}));case 114:return e.next=116,(0,s.put)((0,n.updateUnreadCount)({type:n.unreadCountActions.CLOSE_CONVERSATION,conversation:O}));case 116:return e.next=118,(0,s.put)(f("conversations",{conversation:O,read:!0}));case 118:e.next=127;break;case 120:if("activated"!==m){e.next=127;break}if(!(D=r===h)){e.next=125;break}return e.next=125,(0,s.put)((0,n.fetchMessagesRequested)({conversation:O,reset:!0}));case 125:return e.next=127,(0,s.put)((0,n.getConversationDetailRequested)({conversationId:h,shopId:N,needRead:D}));case 127:return e.abrupt("break",235);case 128:if(e.t13=t===E,!e.t13){e.next=132;break}return e.next=132,(0,s.put)(f("users",{userId:E,status:m}));case 132:return e.abrupt("break",235);case 133:if(e.t14=k,!e.t14){e.next=137;break}return e.next=137,(0,s.put)(f("conversations",{conversation:O,flag:b}));case 137:return e.abrupt("break",235);case 138:return e.next=140,(0,s.call)(n.logoutHandler);case 140:return e.abrupt("break",235);case 141:return e.next=143,(0,s.put)(f("rateCards",{cardId:y,status:m}));case 143:return e.abrupt("break",235);case 144:return e.next=146,(0,s.put)(f("conversations",{conversation:O,pinned:!0}));case 146:return e.abrupt("break",235);case 147:return e.next=149,(0,s.put)(f("conversations",{conversation:O,pinned:!1}));case 149:if(r!==h||"Pinned"!==x){e.next=152;break}return e.next=152,(0,s.put)((0,n.resetConversationRequested)());case 152:return e.abrupt("break",235);case 153:if(!(U=g.length)){e.next=162;break}return L={},g.forEach((function(e){L[e]={unread_count:0}})),e.next=159,(0,s.put)((0,n.batchUpdateRecord)({name:"conversations",records:L}));case 159:return q=Object.assign({},{count:U,type:n.unreadCountActions.MASS_READ},p?{shopId:p}:{}),e.next=162,(0,s.put)((0,n.updateUnreadCount)(q));case 162:return e.abrupt("break",235);case 163:if(F=g.length,!g.length){e.next=172;break}return G={},g.forEach((function(e){G[e]={unread_count:1}})),e.next=169,(0,s.put)((0,n.batchUpdateRecord)({name:"conversations",records:G}));case 169:return H=Object.assign({},{count:F,type:n.unreadCountActions.MASS_UNREAD},p?{shopId:p}:{}),e.next=172,(0,s.put)((0,n.updateUnreadCount)(H));case 172:return e.abrupt("break",235);case 173:if(!g.length){e.next=178;break}return V={},g.forEach((function(e){V[e]={pinned:!0}})),e.next=178,(0,s.put)((0,n.batchUpdateRecord)({name:"conversations",records:V}));case 178:return e.abrupt("break",235);case 179:if(!g.length){e.next=184;break}return B={},g.forEach((function(e){B[e]={pinned:!1}})),e.next=184,(0,s.put)((0,n.batchUpdateRecord)({name:"conversations",records:B}));case 184:return e.abrupt("break",235);case 185:return e.next=187,(0,s.put)((0,n.fetchConversationsRequested)({direction:"latest"}));case 187:if(!g.length){e.next=222;break}W={},Q=!0,Y=!1,K=void 0,e.prev=193,J=g[Symbol.iterator]();case 195:if(Q=(z=J.next()).done){e.next=204;break}if(X=z.value,W[X]={status:"actived"},r!==X){e.next=201;break}return e.next=201,(0,s.put)((0,n.fetchMessagesRequested)({conersation:{id:r,shop_id:p},reset:!0}));case 201:Q=!0,e.next=195;break;case 204:e.next=210;break;case 206:e.prev=206,e.t15=e.catch(193),Y=!0,K=e.t15;case 210:e.prev=210,e.prev=211,!Q&&J.return&&J.return();case 213:if(e.prev=213,!Y){e.next=216;break}throw K;case 216:return e.finish(213);case 217:return e.finish(210);case 218:return e.next=220,(0,s.put)((0,n.batchUpdateRecord)({name:"conversations",records:W}));case 220:return e.next=222,(0,s.call)(handleNotifyBatchConversation);case 222:return e.abrupt("break",235);case 223:if(!(Z=g.length)){e.next=234;break}return $={},g.forEach((function(e){$[e]={status:"closed",unread_count:0}})),e.next=229,(0,s.put)((0,n.batchUpdateRecord)({name:"conversations",records:$}));case 229:return ee=Object.assign({},{count:Z,type:n.unreadCountActions.MASS_CLOSE},p?{shopId:p}:{}),e.next=232,(0,s.put)((0,n.updateUnreadCount)(ee));case 232:return e.next=234,(0,s.put)((0,n.batchRemoveDraft)({conversationIds:g}));case 234:return e.abrupt("break",235);case 235:e.next=242;break;case 237:if("message"!==te){e.next=242;break}return e.next=240,(0,s.spawn)(l,re.request_id);case 240:return e.next=242,(0,s.put)((0,n.receiveMessageRequested)({message:re}));case 242:case"end":return e.stop()}}),d,this,[[193,206,210,218],[211,,213,217]])}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.notificationTypes={MARK_AS_READ:"mark_as_read",MARK_AS_UNREAD:"mark_as_unread",DELETE_CONVERSATION:"delete_conversation",UPDATE_OFFER_STATUS:"update_offer_status",UPDATE_CONVERSATION:"update_conversation",UPDATE_USER_STATUS:"update_user_status",UPDATE_CONVERSATION_FLAG:"update_conversation_flag",FORCE_LOGOUT:"force_logout",UPDATE_RATING_CARD_STATUS:"update_rating_card_status",PULL_NOTIFICATION:"pull_notification",PIN_CONVERSATION:"pin_conversation",UNPIN_CONVERSATION:"unpin_conversation",MASS_READ:"mass_read",MASS_UNREAD:"mass_unread",MASS_PIN:"mass_pin",MASS_UNPIN:"mass_unpin",MASS_CLOSE:"mass_close",MASS_ACTIVATE:"mass_activate"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.redirectConversationRequested=void 0,t.watchSCRedirect=h;var n,a=r(0),o=(r(18),r(1)),s=r(2),c=r(3),u=(n=r(5))&&n.__esModule?n:{default:n},i=r(23),d=r(4),f=regeneratorRuntime.mark(v),l=regeneratorRuntime.mark(h),p=(0,a.createActions)({REDIRECT_CONVERSATION_REQUESTED:function(e){var t=e.userId,r=e.shopId,n=e.orderId,a=e.productId,o=e.message;return{userId:t,shopId:r,orderId:n,productId:a,message:void 0===o?"":o,entryPointType:e.entryPointType}}}).redirectConversationRequested;function v(e){var t,r,n,a,l,p,v,h,_=e.payload,g=_.userId,S=_.shopId,m=_.orderId,b=_.productId,y=_.message,E=_.entryPointType;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.select)(o.conversationIdsSelector);case 2:return t=e.sent,e.next=5,(0,s.call)(c.fetch,{method:"POST",resource:"conversation",suffix:"redirection",payload:JSON.stringify({user_id:parseInt(g),shop_id:S})});case 5:if(r=e.sent,n=r.id,a=r.faking,l=r.latest_message_id,!E){e.next=10;break}return e.next=10,(0,s.put)((0,o.setEntryPoint)({type:E,conversationId:n}));case 10:if(!(p=a||!t.includes(n))){e.next=17;break}return v=(0,u.default)("conversations",r),e.next=15,(0,s.put)((0,o.updateEntities)({entities:v.entities}));case 15:return e.next=17,(0,s.put)((0,i.fakeConversationSucceeded)({conversationId:n}));case 17:if(!y){e.next=20;break}return e.next=20,(0,s.put)((0,o.saveDraft)({draft:y,conversationId:n}));case 20:return e.next=22,(0,s.select)(o.currentConversationIdSelector);case 22:if(e.sent===n&&!p){e.next=26;break}return e.next=26,(0,s.put)((0,o.showConversationRequested)({conversation:r,refresh:!0,read:!p||!!l}));case 26:return e.next=28,(0,s.put)((0,o.updateChatWindowStatus)({shouldShowWindow:!0}));case 28:return e.next=30,(0,s.put)((0,o.updateConversationDetailStatus)({shouldShowConversationDetail:!0}));case 30:return h={userId:g,shopId:S,orderId:m,productId:b,conversationId:r.id},e.next=33,(0,s.call)(d.setItem,"mini-sc_redirect",h);case 33:return e.next=35,(0,s.put)((0,o.sendMessagesRequested)({conversationId:r.id,conversationUserId:g,messages:[{type:"text",content:{text:""},isFaking:!0}],isFakingSource:!0}));case 35:case"end":return e.stop()}}),f,this)}function h(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.takeEvery)(p,v);case 2:case"end":return e.stop()}}),l,this)}t.redirectConversationRequested=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.watchCSChatChannel=p,t.watchCSChatReconnect=v;var n=r(18),a=r(2),o=r(3),s=r(4),c=regeneratorRuntime.mark(l),u=regeneratorRuntime.mark(p),i=regeneratorRuntime.mark(v),d=!1,f=function(e){return(0,n.eventChannel)((function(t){return o.isCSSocketShared?e.on("message",(function(e){var r=e.data,n=r.worker_event,a=r.payload;n&&t({event:n,payload:void 0===a?{}:a})})):Object.values(s.network).forEach((function(r){e.on(r,(function(){return t({event:r})}))})),function(){}}))};function l(e){var t=e.event;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=14;break}e.t0=t,e.next=e.t0===s.network.CONNECT?4:e.t0===s.network.DISCONNECT?6:14;break;case 4:return(0,o.loginCSSocket)(),e.abrupt("break",14);case 6:if(d){e.next=12;break}return e.next=9,(0,a.delay)(3e3);case 9:o.csSocket.connect(),e.next=13;break;case 12:d=!1;case 13:return e.abrupt("break",14);case 14:case"end":return e.stop()}}),c,this)}function p(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.call)(f,o.csSocket);case 2:return e=t.sent,t.next=5,(0,a.takeEvery)(e,l);case 5:case"end":return t.stop()}}),u,this)}function v(){var e,t,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e=null,t=void 0,t="mini-session";case 3:return r=60*Math.floor(10*Math.random()+20)*1e3,n.next=7,(0,a.delay)(r);case 7:if(n.t0=!e,!n.t0){n.next=12;break}return n.next=11,(0,s.getItem)(t);case 11:e=n.sent;case 12:if(!e||!e.user||"seller"!==e.user.type){n.next=19;break}if(!o.csSocket){n.next=19;break}return d=!0,o.csSocket.close(),n.next=18,(0,a.delay)(1e3);case 18:o.csSocket.connect();case 19:n.next=3;break;case 21:case"end":return n.stop()}}),i,this)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.watchHeartBeatEmit=i;var n=r(4),a=r(2),o=r(3),s=r(25),c=r(1),u=regeneratorRuntime.mark(i);function i(){var e,t,r,i;return regeneratorRuntime.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:e=null,t=void 0,t="mini-session";case 3:return u.next=6,(0,a.delay)(6e4);case 6:if(u.t0=!e,!u.t0){u.next=11;break}return u.next=10,(0,n.getItem)(t);case 10:e=u.sent;case 11:return u.next=13,(0,a.select)(c.noticesCountSelector);case 13:return r=u.sent,u.next=16,(0,a.select)(c.missedReadNoticeCountSelector);case 16:if(i=u.sent,!e||!e.token){u.next=23;break}return(0,o.heartbeat)({noticesCount:r,readMissedCount:i}),u.next=21,(0,a.put)((0,c.updateReadRequestData)({count:0}));case 21:return u.next=23,(0,a.put)((0,s.updateNoticesCount)({type:"reset"}));case 23:u.next=3;break;case 25:case"end":return u.stop()}}),u,this)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.feedbackSelector=function(e){return e.socketReducer.feedback},t.reconnectFlagSelector=function(e){return e.socketReducer.reconnectFlag},t.noticesCountSelector=function(e){return e.socketReducer.noticesCount}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(182);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(183);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateOfflineReplyRequested=void 0;var n=(0,r(0).createActions)({UPDATE_OFFLINE_REPLY_REQUESTED:function(e){return{params:e}}}).updateOfflineReplyRequested;t.updateOfflineReplyRequested=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(185);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(186);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.saveFaqStatusAndGreeting=void 0;var n=(0,r(0).createActions)({SAVE_FAQ_STATUS_AND_GREETING:function(e){return{faqStatus:e.faqStatus,greetingContent:e.greetingContent,handleResult:e.handleResult,linked:e.linked}}}).saveFaqStatusAndGreeting;t.saveFaqStatusAndGreeting=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(188);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(189);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchNotificationUnreadCountRequested=void 0;var n=(0,r(0).createActions)({FETCH_NOTIFICATION_UNREAD_COUNT_REQUESTED:function(){return{}}}).fetchNotificationUnreadCountRequested;t.fetchNotificationUnreadCountRequested=n},function(e,t,r){"use strict";function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function a(e,t,r,n,a,o,s){try{var c=e[o](s),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,a)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var s=e.apply(t,r);function c(e){a(s,n,o,c,u,"next",e)}function u(e){a(s,n,o,c,u,"throw",e)}c(void 0)}))}}r.r(t),r.d(t,"createTrackingV3SdkWithConversion",(function(){return D})),r.d(t,"createTrackingV3Sdk",(function(){return U})),r.d(t,"TrackingV3Sdk",(function(){return N}));var s=r(9),c=r.n(s),u=["SPC_U","SPC_F","SPC_T_ID","SPC_T_IV"];function i(e){var t={};if("function"==typeof e)for(var r=e(),n=0,a=u;n<a.length;n++){var o=a[n];t[o]=r[o]}return t}var d=r(27),f=[],l=function(){function e(e,t){var r=this;this.context=e,this.methodName=t,this.originalMethodReference=e[t],this.methodChain=[],this.boundMethodChain=[],this.wrappedMethod=function(){var e=r.boundMethodChain[r.boundMethodChain.length-1];return e.apply(void 0,arguments)},e[t]=this.wrappedMethod}e.add=function(e,t,r){(function(e,t){var r=p(e,t);return r||(r=new l(e,t),f.push(r)),r})(e,t).add(r)},e.remove=function(e,t,r){var n=p(e,t);n&&n.remove(r)};var t=e.prototype;return t.add=function(e){this.methodChain.push(e),this.rebindMethodChain()},t.remove=function(e){var t=this.methodChain.indexOf(e);t>-1&&(this.methodChain.splice(t,1),this.methodChain.length>0?this.rebindMethodChain():this.destory())},t.rebindMethodChain=function(){this.boundMethodChain=[];for(var e,t=0;e=this.methodChain[t];t++){var r=this.boundMethodChain[t-1]||this.originalMethodReference.bind(this.context);this.boundMethodChain.push(e(r))}},t.destory=function(){var e=f.indexOf(this);e>-1&&(f.splice(e,-1),this.context[this.methodName]=this.originalMethodReference)},e}();function p(e,t){return f.filter((function(r){return r.context===e&&r.methodName===t}))[0]}var v=function(){function e(){}var t,r=e.prototype;return r.upgrade=function(t,r){if(r.oldVersion<e.DATABASE_VERSION&&(t.objectStoreNames.contains(e.OBJECT_STORE_EVENTS_V1)&&t.deleteObjectStore(e.OBJECT_STORE_EVENTS_V1),t.objectStoreNames.contains(e.OBJECT_STORE_SESSIONS_V1)&&t.deleteObjectStore(e.OBJECT_STORE_SESSIONS_V1)),!t.objectStoreNames.contains(e.OBJECT_STORE_EVENTS)){var n=t.createObjectStore(e.OBJECT_STORE_EVENTS,{autoIncrement:!0});n.createIndex(e.INDEX_EVENTS_FETCHED,e.INDEX_EVENTS_FETCHED,{unique:!1}),n.createIndex(e.INDEX_EVENT_TIMESTAMP,e.INDEX_EVENT_TIMESTAMP,{unique:!1})}t.objectStoreNames.contains(e.OBJECT_STORE_SESSIONS)||t.createObjectStore(e.OBJECT_STORE_SESSIONS)},r.init=(t=o(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.openDB(e.DATABASE_NAME,e.DATABASE_VERSION);case 3:return this.idb=t.sent,t.abrupt("return",!0);case 7:return t.prev=7,t.t0=t.catch(0),console.warn("[IndexedDBStorage]",t.t0),t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(){return t.apply(this,arguments)}),r.openDB=function(t,r){var n=this;return new Promise((function(a,o){var s=self.window.indexedDB.open(t,r);s.onblocked=function(){console.warn("[IndexedDBStorage] Upgrade is blocked since connection to old version exists.")},s.onerror=function(e){try{e.preventDefault()}catch(e){}o(e)},s.onsuccess=function(t){var r=t.target.result;r.objectStoreNames.contains(e.OBJECT_STORE_EVENTS)&&r.objectStoreNames.contains(e.OBJECT_STORE_SESSIONS)?(r.onerror=function(e){console.warn("[IndexedDBStorage]",e.target.errorCode)},r.onversionchange=function(){r.close(),console.warn("[IndexedDBStorage] A new version of indexedDB is ready.")},a(r)):o("Required ObjectStore cannot be found.")},s.onupgradeneeded=function(e){var t=e.target.result;try{n.upgrade(t,e)}catch(e){o(e)}}}))},r.addEvent=function(t){var r=this;return new Promise((function(n,a){var o=r.idb.transaction(e.OBJECT_STORE_EVENTS,"readwrite");o.oncomplete=function(){n(!0)},o.onerror=function(e){a(e)},o.onabort=function(e){a(e)},o.objectStore(e.OBJECT_STORE_EVENTS).add({data:JSON.stringify(t),timestamp:Date.now(),fetched:"f"})}))},r.getEvents=function(t){var r=this,a=[],o=[];return new Promise((function(s,c){var u=r.idb.transaction(e.OBJECT_STORE_EVENTS,"readwrite");u.oncomplete=function(){s({keys:a,data:o})},u.onerror=function(e){c(e)},u.onabort=function(e){c(e)};var i=IDBKeyRange.only("f");u.objectStore(e.OBJECT_STORE_EVENTS).index(e.INDEX_EVENTS_FETCHED).openCursor(i).onsuccess=function(e){var r=e.target.result;r&&(a.push(r.primaryKey),o.push(JSON.parse(r.value.data)),r.update(n({},r.value,{fetched:"t"})),(-1===t||t-- >1)&&r.continue())}}))},r.resetEvents=function(t,r){var a=this;return!t||t.length<=0?Promise.resolve(!0):new Promise((function(r,o){var s=a.idb.transaction(e.OBJECT_STORE_EVENTS,"readwrite");s.oncomplete=function(){r(!0)},s.onerror=function(e){o(e)},s.onabort=function(e){o(e)};var c=IDBKeyRange.bound(t[0],t[t.length-1]);s.objectStore(e.OBJECT_STORE_EVENTS).openCursor(c).onsuccess=function(e){var t=e.target.result;t&&(t.update(n({},t.value,{fetched:"f"})),t.continue())}}))},r.removeEvents=function(t){var r=this;return!t||t.length<=0?Promise.resolve(!0):new Promise((function(n,a){var o=r.idb.transaction(e.OBJECT_STORE_EVENTS,"readwrite");o.oncomplete=function(){n(!0)},o.onerror=function(e){a(e)},o.onabort=function(e){a(e)};var s=IDBKeyRange.bound(t[0],t[t.length-1]);o.objectStore(e.OBJECT_STORE_EVENTS).delete(s)}))},r.getSession=function(t){var r=this;return new Promise((function(n,a){var o={},s=r.idb.transaction(e.OBJECT_STORE_SESSIONS,"readwrite");s.oncomplete=function(){n(o)},s.onerror=function(e){a(e)},s.onabort=function(e){a(e)};var c=s.objectStore(e.OBJECT_STORE_SESSIONS);c.get(e.KEY_SESSION).onsuccess=function(r){o=t(r.target.result),c.put(o,e.KEY_SESSION)}}))},r.getCurrentSessionId=function(){var t=this;return new Promise((function(r,n){var a={},o=t.idb.transaction(e.OBJECT_STORE_SESSIONS,"readwrite");o.oncomplete=function(){r(a.sessionId)},o.onerror=function(e){n(e)},o.onabort=function(e){n(e)},o.objectStore(e.OBJECT_STORE_SESSIONS).get(e.KEY_SESSION).onsuccess=function(e){a=e.target.result}}))},r.removeExpiredEvents=function(){var t=this;return new Promise((function(r,n){var a=t.idb.transaction(e.OBJECT_STORE_EVENTS,"readwrite");a.oncomplete=function(){r(!0)},a.onerror=function(e){n(e)},a.onabort=function(e){n(e)};var o=IDBKeyRange.upperBound(Date.now()-e.RETENTION);a.objectStore(e.OBJECT_STORE_EVENTS).index(e.INDEX_EVENT_TIMESTAMP).openCursor(o).onsuccess=function(e){var t=e.target.result;t&&(t.delete(),t.continue())}}))},e}();v.DATABASE_NAME="data-tracking",v.DATABASE_VERSION=3,v.OBJECT_STORE_EVENTS_V1="events",v.OBJECT_STORE_EVENTS="events_v2",v.OBJECT_STORE_SESSIONS_V1="sessions",v.OBJECT_STORE_SESSIONS="session_v2",v.INDEX_EVENTS_FETCHED="fetched",v.INDEX_EVENT_TIMESTAMP="timestamp",v.KEY_SESSION="current_session",v.RETENTION=1728e5;var h=function(){function e(e,t){this.storage=e,this.storageKey=t}var t=e.prototype;return t.get=function(){return this.storage.get(this.storageKey)||[]},t.set=function(e){return e=e||[],this.storage.set(this.storageKey,e)},t.enqueue=function(e){var t=this.get();t.push(e),this.set(t)},t.batchDequeue=function(e){var t=this.get(),r=t.slice(0,e),n=t.slice(e);return this.set(n),r},t.putBackBatchToQueue=function(e){return this.set(e.concat(this.get()))},e}(),_=function(){function e(){var t=this;e.supportsLocalStorage()?this.storage={get:function(e){var t=self.window.localStorage.getItem(e);return t?JSON.parse(t):void 0},set:function(e,t){var r=JSON.stringify(t);self.window.localStorage.setItem(e,r)}}:(this.backStore={},this.storage={get:function(e){return t.backStore[e]},set:function(e,r){t.backStore[e]=r}}),this.queue=new h(this.storage,e.QUEUE_STORAGE_KEY)}e.supportsLocalStorage=function(){if(!self.window)return!1;try{return self.window.localStorage.setItem(e.CHECK_STORAGE_KEY,e.CHECK_STORAGE_KEY),self.window.localStorage.removeItem(e.CHECK_STORAGE_KEY),!0}catch(e){return!1}};var t=e.prototype;return t.addEvent=function(e){return this.queue.enqueue(e),Promise.resolve(!0)},t.getEvents=function(e){var t=-1===e?this.queue.get():this.queue.batchDequeue(e);return Promise.resolve({data:t})},t.resetEvents=function(e,t){return this.queue.putBackBatchToQueue(t),Promise.resolve(!0)},t.removeEvents=function(e){return Promise.resolve(!0)},t.getSession=function(t){var r=this.storage.get(e.SESSION_STORAGE_KEY);return r=t(r=r&&"sessionId"in r&&"sequenceId"in r&&"timestamp"in r?r:null),this.storage.set(e.SESSION_STORAGE_KEY,r),Promise.resolve(r)},t.getCurrentSessionId=function(){var t=this.storage.get(e.SESSION_STORAGE_KEY),r=t&&"sessionId"in t?t.sessionId:c()();return Promise.resolve(r)},e}();_.QUEUE_STORAGE_KEY="bi-tracking::events",_.SESSION_STORAGE_KEY="bi-tracking::session",_.CHECK_STORAGE_KEY="bi-tracking::check";var g=null,S=function(){function e(){}return e.initIndexedDB=function(){var e=o(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!self.window||!self.window.indexedDB){e.next=8;break}return t=new v,e.next=4,t.init();case 4:if(!e.sent){e.next=8;break}try{t.removeExpiredEvents()}catch(e){console.warn("[TrackerStorage]",e)}return e.abrupt("return",t);case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.get=(t=o(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(g){t.next=5;break}return t.next=3,e.initIndexedDB();case 3:(g=t.sent)||(g=new _);case 5:return t.abrupt("return",g);case 6:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)}),e;var t}(),m="",b="",y=function(){function e(){}return e.getSession=(t=o(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S.get();case 2:return r=t.sent,t.next=5,r.getSession((function(t){var r=Date.now();return null==t||r-t.timestamp>e.SESSION_DURATION?t={sessionId:c()(),timestamp:r,sequenceId:0}:(t.sequenceId+=1,t.timestamp=r),t}));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)}),e.GetSessionId=function(){var e=o(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.get();case 2:return t=e.sent,e.next=5,t.getCurrentSessionId();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.setLatestEventId=function(e){m=e},e.getLatestEventId=function(){return m},e.setLatestViewPageType=function(e){b=e},e.getLatestViewPageType=function(){return b},e;var t}();function E(e){var t={},r=(e=e||"").indexOf("?");if(-1!==r){var n=e.substring(r+1);(n=n.split("#")[0]).split("&").forEach((function(e){if(e){var r=e.indexOf("="),n=r>-1?e.substring(0,r):e,a=r>-1?decodeURIComponent(e.substring(r+1)):"";t[n]=a}}))}return t}function O(e){return Object.keys(e).length<=0}function R(e,t){return!!e&&e.split("/")[2]===t}function k(e){var t={};return e.hasOwnProperty("affiliate_trackid")&&(t.affiliate_trackid=e.affiliate_trackid),e.hasOwnProperty("utm_source")&&(t.utm_source=e.utm_source),e.hasOwnProperty("utm_medium")&&(t.utm_medium=e.utm_medium),e.hasOwnProperty("utm_campaign")&&(t.utm_campaign=e.utm_campaign),e.hasOwnProperty("utm_term")&&(t.utm_term=e.utm_term),e.hasOwnProperty("utm_content")&&(t.utm_content=e.utm_content),t}function x(e){var t={};return e.hasOwnProperty("event_source")&&(t.event_source=e.event_source),t}function w(e){if(!self.document||!self.location)return null;var t=null;try{t=E(self.location.href)}catch(e){console.warn("[getParams]",e)}if(!t||O(t))return null;var r={},n=R(self.document.referrer,self.location.hostname);return(e&&n||!e)&&(r=x(t)),e&&!n&&(r=k(t)),O(r)?null:r}function I(e){if(e.hash&&e.hash.startsWith("#/")){var t=e.hash.lastIndexOf("#");return 0===t?e.hash.substring(1):e.hash.substring(1,t)}return e.pathname}function T(){return location.pathname+location.hash+location.search}function C(){return location.host+location.pathname+location.hash}y.SESSION_DURATION=18e5;var P=function(){function e(e){if(self.window&&self.window.addEventListener){var t={shouldTrackHistoryChange:this.shouldTrackHistoryChange,trackReplaceState:!1};this.opts=n({},t,e),this.path=T(),this.pathname=I(location),this.eventId=c()(),y.setLatestEventId(this.eventId),this.pushStateOverride=this.pushStateOverride.bind(this),this.replaceStateOverride=this.replaceStateOverride.bind(this),this.handlePopState=this.handlePopState.bind(this),this.handleHashChange=this.handleHashChange.bind(this),this.handleLoad=this.handleLoad.bind(this),self.history&&self.history.pushState?(l.add(history,"pushState",this.pushStateOverride),l.add(history,"replaceState",this.replaceStateOverride),window.addEventListener("popstate",this.handlePopState)):window.addEventListener("hashchange",this.handleHashChange),this.handleLoad()}else console.warn("[AutoTracker]","not work unsupporting browser")}var t,r=e.prototype;return r.pushStateOverride=function(e){var t=this;return function(){e.apply(void 0,arguments),t.handleHistoryChange(!0)}},r.replaceStateOverride=function(e){var t=this;return function(){e.apply(void 0,arguments),t.handleHistoryChange(!1)}},r.handlePopState=function(){this.handleHistoryChange(!0)},r.handleHashChange=function(){this.handleHistoryChange(!0)},r.handleLoad=function(){var e=this,t={isOnload:!0,referrer:self.document.referrer,eventId:this.eventId,href:self.location.href,hostname:self.location.hostname,pathname:this.pathname,absolutePath:C()};setTimeout((function(){try{e.sendPageview(t)}catch(e){console.warn("[AutoTracker]",e)}}),300)},r.sendPageview=(t=o(regeneratorRuntime.mark((function e(t){var r,a,o,s,c,u,i,d,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.getSession();case 2:return r=e.sent,a=Date.now(),o=E(t.href),s={auto_mapped_view:y.getLatestViewPageType(),auto_refer:t.referrer,auto_pathname:t.pathname,auto_url:t.href,start_time:a},O(o)||(s.param_string=JSON.stringify(o)),c=R(t.referrer,t.hostname),(t.isOnload&&c||!t.isOnload)&&!O(u=x(o))&&(s=n({},s,u)),t.isOnload&&!c&&!O(i=k(o))&&(s=n({},s,i)),d={civ_id:t.eventId,info:{auto_view_id:"browser-abs|"+t.absolutePath,data:{auto_pv_common:s},operation:"auto_view",usage_id:0},sequence_id:r.sequenceId,session_id:r.sessionId,timestamp:a,type:"v3"},e.next=13,S.get();case 13:return f=e.sent,e.next=16,f.addEvent(d);case 16:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)}),r.shouldTrackHistoryChange=function(e,t){return!(!e||!t)},r.handleHistoryChange=function(e){var t,r=this,n=this.path,a=this.pathname,o=T(),s=I(location);if(n!==o&&this.opts.shouldTrackHistoryChange.call(this,o,n)&&(this.path=o,this.pathname=s,e||this.opts.trackReplaceState)){this.eventId=c()(),t=function(){y.setLatestEventId(r.eventId)},"function"==typeof requestIdleCallback?requestIdleCallback((function(){return t()})):t();var u={isOnload:!1,referrer:a,eventId:this.eventId,href:self.location.href,hostname:self.location.hostname,pathname:this.pathname,absolutePath:C()};setTimeout((function(){try{r.sendPageview(u)}catch(e){console.warn("[AutoTracker]",e)}}),300)}},e}(),M=function(){function e(t){this.backoff=e.BACKOFF_PERIOD,this.isSyncing=!1,this.makePromise=t,this.sync=this.sync.bind(this)}return e.prototype.sync=(t=o(regeneratorRuntime.mark((function t(){var r,n,a,o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.isSyncing){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,S.get();case 5:return r=t.sent,t.next=8,r.getEvents(-1);case 8:if(!((n=t.sent).data.length<=0)){t.next=11;break}return t.abrupt("return");case 11:return this.isSyncing=!0,t.next=14,this.makePromise(n.data).catch((function(e){console.warn("[Sender]",e)}));case 14:if(!(a=t.sent)||200!==a.status){t.next=22;break}return t.next=18,r.removeEvents(n.keys);case 18:this.backoff=e.BACKOFF_PERIOD,this.isSyncing=!1,t.next=26;break;case 22:return t.next=24,r.resetEvents(n.keys,n.data);case 24:this.backoff*=2,setTimeout((function(){o.isSyncing=!1,o.sync()}),this.backoff);case 26:t.next=32;break;case 28:t.prev=28,t.t0=t.catch(0),console.warn("[Sender]",t.t0),this.isSyncing=!1;case 32:case"end":return t.stop()}}),t,this,[[0,28]])}))),function(){return t.apply(this,arguments)}),e;var t}();M.BACKOFF_PERIOD=200;var j=function(){function e(t){this.syncPeriod=e.SYNC_PERIOD,this.isSyncing=!1,this.makePromise=t,this.sync=this.sync.bind(this),this.syncWhenIdle=this.syncWhenIdle.bind(this),this.setSyncThreadId=this.setSyncThreadId.bind(this),this.syncThreadId=setInterval(this.syncWhenIdle,this.syncPeriod)}var t=e.prototype;return t.setSyncThreadId=function(){this.syncThreadId&&clearInterval(this.syncThreadId),this.syncThreadId=setInterval(this.syncWhenIdle,this.syncPeriod)},t.syncWhenIdle=function(){window&&window.requestIdleCallback?window.requestIdleCallback(this.sync,{timeout:1e3}):this.sync()},t.sync=function(){var t=o(regeneratorRuntime.mark((function t(){var r,n,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.isSyncing){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,S.get();case 5:return r=t.sent,t.next=8,r.getEvents(e.BATCH_SIZE);case 8:if(!((n=t.sent).data.length<=0)){t.next=11;break}return t.abrupt("return");case 11:return this.isSyncing=!0,t.next=14,this.makePromise(n.data).catch((function(e){console.warn("[SenderWithInterval]",e)}));case 14:if(!(a=t.sent)||200!==a.status){t.next=21;break}return t.next=18,r.removeEvents(n.keys);case 18:this.syncPeriod>e.SYNC_PERIOD&&(this.syncPeriod=e.SYNC_PERIOD,this.setSyncThreadId()),t.next=25;break;case 21:return t.next=23,r.resetEvents(n.keys,n.data);case 23:this.syncPeriod*=2,this.setSyncThreadId();case 25:this.isSyncing=!1,t.next=32;break;case 28:t.prev=28,t.t0=t.catch(0),console.warn("[SenderWithInterval]",t.t0),this.isSyncing=!1;case 32:case"end":return t.stop()}}),t,this,[[0,28]])})));return function(){return t.apply(this,arguments)}}(),e}();j.SYNC_PERIOD=2e3,j.BATCH_SIZE=20;var A=n({},d.a,{liveish:""}),N=function(){function e(e){var t,r;this.options=e,this.endpoint=e.endpoint||(t=e.env.toLowerCase(),r=e.locale.toLowerCase(),"https://c-api-bit."+A[t]+"shopeemobile.com/"+r+"/tr"),this.pageId=c()(),this.isOnload=!0,void 0===e.appId&&(this.options.appId=0),(void 0===e.enableAutoTrack||e.enableAutoTrack)&&(this.autoTracker=new P),e.sendEventByInterval?this.sender=new j(this.post.bind(this)):this.sender=new M(this.post.bind(this))}var t,r,a=e.prototype;return a.updatePageId=function(){this.pageId=c()()},a.track=function(e,t){console.warn("[TrackingV3SDK] TrackingV3SDK.track is deprecated"),this.sync({data:{type:e,timestamp:Date.now(),info:t}})},a.sync=(r=o(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.data,e.prev=1,e.next=4,this.preProcess(r);case 4:return n=e.sent,e.next=7,S.get();case 7:return a=e.sent,e.next=10,a.addEvent(n);case 10:if(this.options.sendEventByInterval){e.next=13;break}return e.next=13,this.sender.sync();case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),console.warn("[TrackingV3SDK]",e.t0);case 18:case"end":return e.stop()}}),e,this,[[1,15]])}))),function(e){return r.apply(this,arguments)}),a.post=function(){var e=o(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.convertEvents(t);case 2:if(!((r=e.sent).length>0)){e.next=8;break}return e.next=6,this.addMeta(r);case 6:return n=e.sent,e.abrupt("return",this.options.fetch(this.endpoint,{method:"POST",headers:{"X-SPC-DF":n.uuid},body:JSON.stringify(n)}));case 8:return e.abrupt("return",Promise.resolve());case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.addMeta=(t=o(regeneratorRuntime.mark((function e(t){var r,a,o,s,c,u,d,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.options,a=r.platform,o=r.ua,s=r.source,c=r.meta,u=r.getCookies,!(d=i(u)).SPC_F){e.next=6;break}e.t0=d.SPC_F,e.next=9;break;case 6:return e.next=8,y.GetSessionId();case 8:e.t0=e.sent;case 9:return f=e.t0,e.abrupt("return",{uuid:f,events:t,meta:n({},c,{platform:a,ua:o,source:s,locale:this.options.locale.toLowerCase(),cookies:d,userid:d.SPC_U&&"-"!==d.SPC_U?parseInt(d.SPC_U,10):null,pageid:this.pageId,app_id:this.options.appId})});case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)}),a.convertEvents=function(){var e=o(regeneratorRuntime.mark((function e(t){var r,n,a,o,s,c,u,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.options.v2ToV3ConverterPromise;case 2:r=e.sent,n=[],a=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s){e.next=6;break}if(!(c>=o.length)){e.next=3;break}return e.abrupt("return","break");case 3:u=o[c++],e.next=10;break;case 6:if(!(c=o.next()).done){e.next=9;break}return e.abrupt("return","break");case 9:u=c.value;case 10:return t=u,e.next=13,r(t);case 13:e.sent.forEach((function(e){e.error||(i.postProcess(t,e),n.push(e))}));case 15:case"end":return e.stop()}}),e)})),o=t,s=Array.isArray(o),c=0,o=s?o:o[Symbol.iterator]();case 6:return e.delegateYield(a(),"t0",7);case 7:if("break"!==e.t0){e.next=10;break}return e.abrupt("break",12);case 10:e.next=6;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.preProcess=function(){var e=o(regeneratorRuntime.mark((function e(t){var r,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y.getLatestEventId(),a=this.options.preProcess(this,t),e.next=4,y.getSession();case 4:return o=e.sent,a=n({},a,{session_id:o.sessionId,sequence_id:o.sequenceId,civ_id:r}),"v3"===t.type?t.info&&"view"===t.info.operation&&(s=t.info.page_type||"",y.setLatestViewPageType(s),a.params=w(this.isOnload),this.isOnload=!1):"pageState"===t.type&&t.info&&(c=t.info.pageType||"",y.setLatestViewPageType(c),a.params=w(this.isOnload),this.isOnload=!1),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.postProcess=function(e,t){if(t.info&&void 0===t.info.usage_id&&(t.info.usage_id=0),t.session_id=e.session_id,t.sequence_id=e.sequence_id,t.civ_id=e.civ_id,t.info&&"auto_view"===t.info.operation&&this.options.matchRoutes){var r=this.options.matchRoutes,a=r(t.info.data.auto_pv_common.auto_pathname);a&&(t.info.auto_view_id="browser|"+a);var o=t.info.data.auto_pv_common.auto_refer;if(o&&o.startsWith("/")){var s=r(o);s&&(t.info.data.auto_pv_common.auto_refer="browser|"+s)}}if(e.params&&t.info.data){var c=t.info.data.view_common||{};c=n({},c,e.params),t.info.data.view_common=c}return t},e}();function D(e){return new N(n({},e,{preProcess:function(t,r){return{type:r.type,timestamp:r.timestamp,info:r.info,source:e.source,pageId:t.pageId}}}))}function U(e){return new N(n({},e,{v2ToV3ConverterPromise:function(e){return[e]},preProcess:function(e,t){return t}}))}}]))}}]);
//# sourceMappingURL=vendors~8004e7d2.1813982a8e8c28785536.js.map